{
  "{\"filename\":\"/app/index.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "./DBConn",
            "imported": [
              "getAllProducts",
              "getProductsByType",
              "getProductByID",
              "getProductPrice",
              "getProductDesc",
              "getProductsByName",
              "getProductByNameVar",
              "checkUser",
              "createUser"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "getAllProducts",
                "local": "getAllProducts"
              },
              {
                "kind": "named",
                "imported": "getProductsByType",
                "local": "getProductsByType"
              },
              {
                "kind": "named",
                "imported": "getProductByID",
                "local": "getProductByID"
              },
              {
                "kind": "named",
                "imported": "getProductPrice",
                "local": "getProductPrice"
              },
              {
                "kind": "named",
                "imported": "getProductDesc",
                "local": "getProductDesc"
              },
              {
                "kind": "named",
                "imported": "getProductsByName",
                "local": "getProductsByName"
              },
              {
                "kind": "named",
                "imported": "getProductByNameVar",
                "local": "getProductByNameVar"
              },
              {
                "kind": "named",
                "imported": "checkUser",
                "local": "checkUser"
              },
              {
                "kind": "named",
                "imported": "createUser",
                "local": "createUser"
              }
            ]
          },
          {
            "source": "./fbhelper",
            "imported": [
              "getName",
              "getProductDetails"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "getName",
                "local": "getName"
              },
              {
                "kind": "named",
                "imported": "getProductDetails",
                "local": "getProductDetails"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/index.js",
      "filenameRelative": "/app/index.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "index.js",
      "sourceFileName": "index.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "index"
    },
    "ignored": false,
    "code": "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\n\nvar _DBConn = require(\"./DBConn\");\n\nvar _fbhelper = require(\"./fbhelper\");\n\nvar express = require(\"express\"),\n    bodyParser = require(\"body-parser\"),\n    app = express().use(bodyParser.json()); // creates express http server\nvar request = require(\"request\");\nvar dotenv = require('dotenv');\nvar crypto = require('crypto');\nvar mongoose = require('mongoose');\ndotenv.config();\n\n// Get page access token\nvar PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Setup to connect to DB\nvar DB_PASSWORD = process.env.DB_PASSWORD;\nmongoose.connect('mongodb+srv://mongoadmin:' + DB_PASSWORD + '@fb-hack-chatbot-cevnk.mongodb.net/fbmsg', { useNewUrlParser: true, useCreateIndex: true, useFindAndModify: false }).then(function () {\n  return console.log(\"DB Connection successful\");\n});\nmongoose.Promise = global.Promise;\n\n// Get page access token\nvar FB_APP_SECRET = process.env.FB_APP_SECRET;\nvar appsecret_proof = crypto.createHmac('sha256', FB_APP_SECRET).update(PAGE_ACCESS_TOKEN).digest('hex');\n\n// Sets server port and logs message on success\napp.listen(3000, function () {\n  return console.log(\"webhook is listening\");\n});\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", function (req, res) {\n  var VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  var mode = req.query[\"hub.mode\"];\n  var token = req.query[\"hub.verify_token\"];\n  var challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// For testing endpoints\napp.get(\"/test\", function (req, res) {\n  var body = req.body;\n  // getAllProducts().then(function(products){\n  // console.log(products);\n  // });\n  // getProductByType(\"Baker\").then(function(products){\n  // console.log(products);\n  // });\n  // getProductByID('3060724697352196').then(function(prod){\n  // console.log(prod);\n  // });\n  // getProductPrice('3060724697352196').then(function(price){\n  // console.log(price);\n  // });\n  // getProductDesc('3060724697352196').then(function(description){\n  // console.log(description);\n  // });\n  // getProductsByName('Earl Grey Sunflower Seeds Cookies').then(function(prod){\n  // console.log(prod);\n  // });\n  // getProductByNameVar('Earl Grey Sunflower Seeds Cookies','Gift box').then(function(prod){\n  //     console.log(prod);\n  // });\n  res.status(200).send(\"Success\");\n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", function (req, res) {\n  var body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function (entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      var webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      var sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        if (webhook_event.message.quick_reply) {\n          handlePostback(sender_psid, webhook_event.message.quick_reply);\n        } else {\n          handleMessage(sender_psid, webhook_event.message);\n        }\n\n        (0, _fbhelper.getName)(PAGE_ACCESS_TOKEN, sender_psid, function (response) {\n          (0, _DBConn.checkUser)(sender_psid, response).then(function (user) {\n            if (user.length == 0) {\n              (0, _DBConn.createUser)(sender_psid, response);\n            }\n          });\n        });\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\nvar defaultResponse = generateResponseFromMessage(\"We could not understand your message. Kindly rephrase your message and send us again.\");\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", function (req, res) {\n  var VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  var mode = req.query[\"hub.mode\"];\n  var token = req.query[\"hub.verify_token\"];\n  var challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Handles messages events\nasync function handleMessage(sender_psid, received_message) {\n  var response = void 0;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(\"Received message: \\\"\" + received_message.text + \"\\\"\");\n\n    response = await processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  var response = void 0;\n\n  // Get the payload for the postback\n  var payload = received_postback.payload;\n  console.log(\"Received postback: \\\"\" + payload + \"\\\"\");\n\n  var postback_intent = payload.split(\" \")[0];\n  var postback_content = payload.substring(payload.indexOf(\" \") + 1, payload.length);\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\"What would you like to know about our \" + postback_content + \"?\");\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [{\n            type: \"postback\",\n            title: \"Pay\",\n            payload: \"paid\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [{\n            type: \"postback\",\n            title: \"View Receipt\",\n            payload: \"receipt_view\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  var request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request({\n    uri: \"https://graph.facebook.com/v2.6/me/messages\",\n    qs: { access_token: PAGE_ACCESS_TOKEN },\n    method: \"POST\",\n    json: request_body\n  }, function (err, res, body) {\n    if (!err) {\n      console.log(\"Message sent!\");\n    } else {\n      console.error(\"Unable to send message:\" + err);\n    }\n  });\n}\n\n// Process text message and returns response object to handleMessage()\nasync function processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  var entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  Object.keys(entities).forEach(function (key) {\n    console.log(\"Entity: \" + key);\n    console.log(entities[key]);\n  });\n\n  // Check greeting\n  var is_greeting = entities[\"greetings\"] != null && entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  var intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    var intent_parts = intent[\"value\"].split(\"_\");\n    var intent_category = intent_parts[0];\n    var intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    var response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        var product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"].filter(function (obj) {\n            return obj[\"confidence\"] > 0.5;\n          }).map(function (obj) {\n            return obj[\"value\"];\n          });\n        }\n\n        response = await generateRecommendationsResponse(product_types);\n        console.log(response);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"attribute\"]) {\n            var product = entities[\"product\"][0];\n            var attribute = entities[\"attribute\"][0];\n            // TODO: Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          var messages = {\n            profit: \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer: \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(function (entity) {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\"Your latest order is <status>.\");\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\");\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\"It is a flat fee of $2 for every order.\");\n          } else {\n            response = generateResponseFromMessage(\"We deliver islandwide. The average delivery time takes 5-7 working days.\");\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          var product_name = entities[\"product\"][0][\"value\"];\n          var quantity = entities[\"number\"] ? entities[\"number\"][0][\"value\"] : 1;\n          response = generateAddCartResponse(sender_psid, product_name, quantity);\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\"Hi there! Welcome to MINDS. How can I help you?\");\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nasync function generateRecommendationsResponse(product_types) {\n  // TODO: Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  var products = void 0;\n\n  if (product_types.length === 0) {\n    products = await (0, _DBConn.getAllProducts)();\n  } else {\n    console.log(product_types[0]);\n    products = await (0, _DBConn.getProductsByType)(product_types[0]);\n  }\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"title\"],\n            subtitle: \"$\" + product[\"price\"],\n            image_url: product[\"image_link\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Learn More\",\n              payload: \"enquiry_product \" + product[\"title\"]\n            }, {\n              type: \"postback\",\n              title: \"Add to Cart\",\n              payload: \"cart_add \" + product[\"title\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: \"Added \" + quantity + \" \" + product_name + \" to cart.\",\n    quick_replies: [{\n      content_type: \"text\",\n      title: \"View Cart\",\n      payload: \"cart_view\"\n    }, {\n      content_type: \"text\",\n      title: \"Checkout\",\n      payload: \"checkout\"\n    }]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"name\"],\n            subtitle: \"Qty: \" + product[\"quantity\"] + \" ($\" + product[\"price\"] + \" each)\",\n            image_url: product[\"url\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Add 1\",\n              payload: \"cart_add \" + product[\"name\"]\n            }, {\n              type: \"postback\",\n              title: \"Remove All\",\n              payload: \"cart_remove \" + product[\"name\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<CUSTOMER_NAME>\", // Mandatory field\n        order_number: \"<ORDER_NUMBER>\", // Mandatory field\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        order_url: \"\",\n        address: {\n          street_1: \"9 Straits View\", // Mandatory field\n          city: \"Singapore\",\n          postal_code: \"018937\",\n          state: \"SG\",\n          country: \"SG\"\n        },\n        summary: {\n          subtotal: 10,\n          shipping_cost: 5,\n          total_tax: 2,\n          total_cost: 15\n        },\n        elements: products.map(function (product) {\n          return {\n            title: \"\" + product[\"name\"],\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return defaultResponse;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYm9keVBhcnNlciIsImFwcCIsInVzZSIsImpzb24iLCJyZXF1ZXN0IiwiZG90ZW52IiwiY3J5cHRvIiwibW9uZ29vc2UiLCJjb25maWciLCJQQUdFX0FDQ0VTU19UT0tFTiIsInByb2Nlc3MiLCJlbnYiLCJEQl9QQVNTV09SRCIsImNvbm5lY3QiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VDcmVhdGVJbmRleCIsInVzZUZpbmRBbmRNb2RpZnkiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsIlByb21pc2UiLCJnbG9iYWwiLCJGQl9BUFBfU0VDUkVUIiwiYXBwc2VjcmV0X3Byb29mIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsImxpc3RlbiIsImdldCIsInJlcSIsInJlcyIsIlZFUklGWV9UT0tFTiIsIm1vZGUiLCJxdWVyeSIsInRva2VuIiwiY2hhbGxlbmdlIiwic3RhdHVzIiwic2VuZCIsInNlbmRTdGF0dXMiLCJib2R5IiwicG9zdCIsIm9iamVjdCIsImVudHJ5IiwiZm9yRWFjaCIsIndlYmhvb2tfZXZlbnQiLCJtZXNzYWdpbmciLCJzZW5kZXJfcHNpZCIsInNlbmRlciIsImlkIiwibWVzc2FnZSIsInF1aWNrX3JlcGx5IiwiaGFuZGxlUG9zdGJhY2siLCJoYW5kbGVNZXNzYWdlIiwicmVzcG9uc2UiLCJ1c2VyIiwibGVuZ3RoIiwicG9zdGJhY2siLCJkZWZhdWx0UmVzcG9uc2UiLCJnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UiLCJyZWNlaXZlZF9tZXNzYWdlIiwidGV4dCIsInByb2Nlc3NNZXNzYWdlIiwiY2FsbFNlbmRBUEkiLCJyZWNlaXZlZF9wb3N0YmFjayIsInBheWxvYWQiLCJwb3N0YmFja19pbnRlbnQiLCJzcGxpdCIsInBvc3RiYWNrX2NvbnRlbnQiLCJzdWJzdHJpbmciLCJpbmRleE9mIiwiZ2VuZXJhdGVBZGRDYXJ0UmVzcG9uc2UiLCJnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2UiLCJhdHRhY2htZW50IiwidHlwZSIsInRlbXBsYXRlX3R5cGUiLCJidXR0b25zIiwidGl0bGUiLCJnZW5lcmF0ZVJlY2VpcHRSZXNwb25zZSIsInJlcXVlc3RfYm9keSIsInJlY2lwaWVudCIsInVyaSIsInFzIiwiYWNjZXNzX3Rva2VuIiwibWV0aG9kIiwiZXJyIiwiZXJyb3IiLCJlbnRpdGllcyIsIm5scCIsIk9iamVjdCIsImtleXMiLCJrZXkiLCJpc19ncmVldGluZyIsImludGVudCIsImludGVudF9wYXJ0cyIsImludGVudF9jYXRlZ29yeSIsImludGVudF9zdWJjYXRlZ29yeSIsInByb2R1Y3RfdHlwZXMiLCJmaWx0ZXIiLCJvYmoiLCJtYXAiLCJnZW5lcmF0ZVJlY29tbWVuZGF0aW9uc1Jlc3BvbnNlIiwicHJvZHVjdCIsImF0dHJpYnV0ZSIsImdlbmVyYXRlUHJvZHVjdEVucXVpcnlSZXNwb25zZSIsIm1lc3NhZ2VzIiwicHJvZml0IiwibWFudWZhY3R1cmVyIiwicHJvZHVjdHMiLCJlbnRpdHkiLCJwcm9kdWN0X25hbWUiLCJxdWFudGl0eSIsImVsZW1lbnRzIiwic3VidGl0bGUiLCJpbWFnZV91cmwiLCJxdWlja19yZXBsaWVzIiwiY29udGVudF90eXBlIiwibmFtZSIsInByaWNlIiwidXJsIiwicmVjaXBpZW50X25hbWUiLCJvcmRlcl9udW1iZXIiLCJjdXJyZW5jeSIsInBheW1lbnRfbWV0aG9kIiwib3JkZXJfdXJsIiwiYWRkcmVzcyIsInN0cmVldF8xIiwiY2l0eSIsInBvc3RhbF9jb2RlIiwic3RhdGUiLCJjb3VudHJ5Iiwic3VtbWFyeSIsInN1YnRvdGFsIiwic2hpcHBpbmdfY29zdCIsInRvdGFsX3RheCIsInRvdGFsX2Nvc3QiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFrQkE7O0FBQ0E7O0FBbEJBLElBQU1BLFVBQVVDLFFBQVEsU0FBUixDQUFoQjtBQUFBLElBQ0VDLGFBQWFELFFBQVEsYUFBUixDQURmO0FB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Z0JBREgsRUFDcUI7QUFDNUJDLGdCQUFNLFdBRkM7QUFHUEMsdUJBQWEsUUFITjtBQUlQQyxpQkFBTyxJQUpBO0FBS1BDLG1CQUFTO0FBTEYsU0FQRjtBQWNQQyxpQkFBUztBQUNQQyxvQkFBVSxFQURIO0FBRVBDLHlCQUFlLENBRlI7QUFHUEMscUJBQVcsQ0FISjtBQUlQQyxzQkFBWTtBQUpMLFNBZEY7QUFvQlB2QixrQkFBVUosU0FBU1IsR0FBVCxDQUFhLG1CQUFXO0FBQ2hDLGlCQUFPO0FBQ0x2Qix3QkFBVXlCLFFBQVEsTUFBUixDQURMO0FBRUxXLHNCQUFVLEVBRkw7QUFHTEYsc0JBQVVULFFBQVEsVUFBUixDQUhMO0FBSUxnQixtQkFBT2hCLFFBQVEsT0FBUixDQUpGO0FBS0xvQixzQkFBVSxLQUxMO0FBTUxSLHVCQUFXWixRQUFRLEtBQVI7QUFOTixXQUFQO0FBUUQsU0FUUztBQXBCSDtBQUZDO0FBREMsR0FBZjs7QUFxQ0EsU0FBT2hELFFBQVA7QUFDRDs7QUFFRDtBQUNBLFNBQVNrRCw4QkFBVCxDQUF3Q0YsT0FBeEMsRUFBaURDLFNBQWpELEVBQTREO0FBQzFEO0FBQ0EsU0FBTzdDLGVBQVA7QUFDRCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZVJvb3QiOiIvYXBwIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9nZXR0aW5nLXN0YXJ0ZWQvd2ViaG9vay1zZXR1cC9cbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5mYWNlYm9vay5jb20vZG9jcy9tZXNzZW5nZXItcGxhdGZvcm0vZ2V0dGluZy1zdGFydGVkL2FwcC1zZXR1cFxuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9nZXR0aW5nLXN0YXJ0ZWQvcXVpY2stc3RhcnRcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIEltcG9ydHMgZGVwZW5kZW5jaWVzIGFuZCBzZXQgdXAgaHR0cCBzZXJ2ZXJcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKFwiZXhwcmVzc1wiKSxcbiAgYm9keVBhcnNlciA9IHJlcXVpcmUoXCJib2R5LXBhcnNlclwiKSxcbiAgYXBwID0gZXhwcmVzcygpLnVzZShib2R5UGFyc2VyLmpzb24oKSk7IC8vIGNyZWF0ZXMgZXhwcmVzcyBodHRwIHNlcnZlclxuY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoXCJyZXF1ZXN0XCIpO1xuY29uc3QgZG90ZW52ID0gcmVxdWlyZSgnZG90ZW52Jyk7XG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcbmRvdGVudi5jb25maWcoKTtcblxuLy8gR2V0IHBhZ2UgYWNjZXNzIHRva2VuXG5jb25zdCBQQUdFX0FDQ0VTU19UT0tFTiA9IHByb2Nlc3MuZW52LlBBR0VfQUNDRVNTX1RPS0VOO1xuXG4vLyBTZXR1cCB0byBjb25uZWN0IHRvIERCXG5jb25zdCBEQl9QQVNTV09SRCA9IHByb2Nlc3MuZW52LkRCX1BBU1NXT1JEO1xubW9uZ29vc2UuY29ubmVjdCgnbW9uZ29kYitzcnY6Ly9tb25nb2FkbWluOicrIERCX1BBU1NXT1JEICsnQGZiLWhhY2stY2hhdGJvdC1jZXZuay5tb25nb2RiLm5ldC9mYm1zZycse3VzZU5ld1VybFBhcnNlcjogdHJ1ZSx1c2VDcmVhdGVJbmRleDogdHJ1ZSwgdXNlRmluZEFuZE1vZGlmeTogZmFsc2V9KS50aGVuKCgpID0+IGNvbnNvbGUubG9nKFwiREIgQ29ubmVjdGlvbiBzdWNjZXNzZnVsXCIpKTtcbm1vbmdvb3NlLlByb21pc2UgPSBnbG9iYWwuUHJvbWlzZTtcblxuaW1wb3J0IHsgZ2V0QWxsUHJvZHVjdHMsIGdldFByb2R1Y3RzQnlUeXBlLCBnZXRQcm9kdWN0QnlJRCwgZ2V0UHJvZHVjdFByaWNlLCBnZXRQcm9kdWN0RGVzYywgZ2V0UHJvZHVjdHNCeU5hbWUsIGdldFByb2R1Y3RCeU5hbWVWYXIsIGNoZWNrVXNlciwgY3JlYXRlVXNlciB9IGZyb20gJy4vREJDb25uJztcbmltcG9ydCB7IGdldE5hbWUsIGdldFByb2R1Y3REZXRhaWxzIH0gZnJvbSAnLi9mYmhlbHBlcic7XG5cbi8vIEdldCBwYWdlIGFjY2VzcyB0b2tlblxuY29uc3QgRkJfQVBQX1NFQ1JFVCA9IHByb2Nlc3MuZW52LkZCX0FQUF9TRUNSRVQ7XG5jb25zdCBhcHBzZWNyZXRfcHJvb2YgPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhMjU2JyxGQl9BUFBfU0VDUkVUKS51cGRhdGUoUEFHRV9BQ0NFU1NfVE9LRU4pLmRpZ2VzdCgnaGV4JylcblxuLy8gU2V0cyBzZXJ2ZXIgcG9ydCBhbmQgbG9ncyBtZXNzYWdlIG9uIHN1Y2Nlc3NcbmFwcC5saXN0ZW4oMzAwMCwgKCkgPT4gY29uc29sZS5sb2coXCJ3ZWJob29rIGlzIGxpc3RlbmluZ1wiKSk7XG5cbi8vIEFkZHMgc3VwcG9ydCBmb3IgR0VUIHJlcXVlc3RzIHRvIG91ciB3ZWJob29rXG5hcHAuZ2V0KFwiL3dlYmhvb2tcIiwgKHJlcSwgcmVzKSA9PiB7XG4gIGxldCBWRVJJRllfVE9LRU4gPSBwcm9jZXNzLmVudi5WRVJJRllfVE9LRU47XG5cbiAgLy8gUGFyc2UgdGhlIHF1ZXJ5IHBhcmFtc1xuICBsZXQgbW9kZSA9IHJlcS5xdWVyeVtcImh1Yi5tb2RlXCJdO1xuICBsZXQgdG9rZW4gPSByZXEucXVlcnlbXCJodWIudmVyaWZ5X3Rva2VuXCJdO1xuICBsZXQgY2hhbGxlbmdlID0gcmVxLnF1ZXJ5W1wiaHViLmNoYWxsZW5nZVwiXTtcblxuICAvLyBDaGVja3MgaWYgYSB0b2tlbiBhbmQgbW9kZSBpcyBpbiB0aGUgcXVlcnkgc3RyaW5nIG9mIHRoZSByZXF1ZXN0XG4gIGlmIChtb2RlICYmIHRva2VuKSB7XG4gICAgLy8gQ2hlY2tzIHRoZSBtb2RlIGFuZCB0b2tlbiBzZW50IGlzIGNvcnJlY3RcbiAgICBpZiAobW9kZSA9PT0gXCJzdWJzY3JpYmVcIiAmJiB0b2tlbiA9PT0gVkVSSUZZX1RPS0VOKSB7XG4gICAgICAvLyBSZXNwb25kcyB3aXRoIHRoZSBjaGFsbGVuZ2UgdG9rZW4gZnJvbSB0aGUgcmVxdWVzdFxuICAgICAgY29uc29sZS5sb2coXCJXRUJIT09LX1ZFUklGSUVEXCIpO1xuICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoY2hhbGxlbmdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUmVzcG9uZHMgd2l0aCAnNDAzIEZvcmJpZGRlbicgaWYgdmVyaWZ5IHRva2VucyBkbyBub3QgbWF0Y2hcbiAgICAgIHJlcy5zZW5kU3RhdHVzKDQwMyk7XG4gICAgfVxuICB9XG59KTtcblxuLy8gRm9yIHRlc3RpbmcgZW5kcG9pbnRzXG5hcHAuZ2V0KFwiL3Rlc3RcIiwgKHJlcSxyZXMpID0+e1xuICAgIGxldCBib2R5ID0gcmVxLmJvZHk7XG4gICAgLy8gZ2V0QWxsUHJvZHVjdHMoKS50aGVuKGZ1bmN0aW9uKHByb2R1Y3RzKXtcbiAgICAvLyBjb25zb2xlLmxvZyhwcm9kdWN0cyk7XG4gICAgLy8gfSk7XG4gICAgLy8gZ2V0UHJvZHVjdEJ5VHlwZShcIkJha2VyXCIpLnRoZW4oZnVuY3Rpb24ocHJvZHVjdHMpe1xuICAgIC8vIGNvbnNvbGUubG9nKHByb2R1Y3RzKTtcbiAgICAvLyB9KTtcbiAgICAvLyBnZXRQcm9kdWN0QnlJRCgnMzA2MDcyNDY5NzM1MjE5NicpLnRoZW4oZnVuY3Rpb24ocHJvZCl7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2QpO1xuICAgIC8vIH0pO1xuICAgIC8vIGdldFByb2R1Y3RQcmljZSgnMzA2MDcyNDY5NzM1MjE5NicpLnRoZW4oZnVuY3Rpb24ocHJpY2Upe1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhwcmljZSk7XG4gICAgLy8gfSk7XG4gICAgLy8gZ2V0UHJvZHVjdERlc2MoJzMwNjA3MjQ2OTczNTIxOTYnKS50aGVuKGZ1bmN0aW9uKGRlc2NyaXB0aW9uKXtcbiAgICAgICAgLy8gY29uc29sZS5sb2coZGVzY3JpcHRpb24pO1xuICAgIC8vIH0pO1xuICAgIC8vIGdldFByb2R1Y3RzQnlOYW1lKCdFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXMnKS50aGVuKGZ1bmN0aW9uKHByb2Qpe1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhwcm9kKTtcbiAgICAvLyB9KTtcbiAgICAvLyBnZXRQcm9kdWN0QnlOYW1lVmFyKCdFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXMnLCdHaWZ0IGJveCcpLnRoZW4oZnVuY3Rpb24ocHJvZCl7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKHByb2QpO1xuICAgIC8vIH0pO1xuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKFwiU3VjY2Vzc1wiKTtcbiAgICBcbn0pO1xuXG4vLyBDcmVhdGVzIHRoZSBlbmRwb2ludCBmb3Igb3VyIHdlYmhvb2tcbmFwcC5wb3N0KFwiL3dlYmhvb2tcIiwgKHJlcSwgcmVzKSA9PiB7XG4gIGxldCBib2R5ID0gcmVxLmJvZHk7XG5cbiAgLy8gQ2hlY2tzIHRoaXMgaXMgYW4gZXZlbnQgZnJvbSBhIHBhZ2Ugc3Vic2NyaXB0aW9uXG4gIGlmIChib2R5Lm9iamVjdCA9PT0gXCJwYWdlXCIpIHtcbiAgICAvLyBJdGVyYXRlcyBvdmVyIGVhY2ggZW50cnkgLSB0aGVyZSBtYXkgYmUgbXVsdGlwbGUgaWYgYmF0Y2hlZFxuICAgIGJvZHkuZW50cnkuZm9yRWFjaChmdW5jdGlvbihlbnRyeSkge1xuICAgICAgLy8gR2V0cyB0aGUgbWVzc2FnZS4gZW50cnkubWVzc2FnaW5nIGlzIGFuIGFycmF5LCBidXRcbiAgICAgIC8vIHdpbGwgb25seSBldmVyIGNvbnRhaW4gb25lIG1lc3NhZ2UsIHNvIHdlIGdldCBpbmRleCAwXG4gICAgICBsZXQgd2ViaG9va19ldmVudCA9IGVudHJ5Lm1lc3NhZ2luZ1swXTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKHdlYmhvb2tfZXZlbnQpO1xuXG4gICAgICAvLyBHZXQgdGhlIHNlbmRlciBQU0lEXG4gICAgICBsZXQgc2VuZGVyX3BzaWQgPSB3ZWJob29rX2V2ZW50LnNlbmRlci5pZDtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiU2VuZGVyIFBTSUQ6IFwiICsgc2VuZGVyX3BzaWQpO1xuXG4gICAgICAvLyBDaGVjayBpZiB0aGUgZXZlbnQgaXMgYSBtZXNzYWdlIG9yIHBvc3RiYWNrIGFuZFxuICAgICAgLy8gcGFzcyB0aGUgZXZlbnQgdG8gdGhlIGFwcHJvcHJpYXRlIGhhbmRsZXIgZnVuY3Rpb25cbiAgICAgIGlmICh3ZWJob29rX2V2ZW50Lm1lc3NhZ2UpIHtcbiAgICAgICAgaWYgKHdlYmhvb2tfZXZlbnQubWVzc2FnZS5xdWlja19yZXBseSkge1xuICAgICAgICAgIGhhbmRsZVBvc3RiYWNrKHNlbmRlcl9wc2lkLCB3ZWJob29rX2V2ZW50Lm1lc3NhZ2UucXVpY2tfcmVwbHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhhbmRsZU1lc3NhZ2Uoc2VuZGVyX3BzaWQsIHdlYmhvb2tfZXZlbnQubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGdldE5hbWUoUEFHRV9BQ0NFU1NfVE9LRU4sc2VuZGVyX3BzaWQsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIGNoZWNrVXNlcihzZW5kZXJfcHNpZCxyZXNwb25zZSkudGhlbihmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgICAgICAgICBpZiAodXNlci5sZW5ndGggPT0gMCl7XG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVVzZXIoc2VuZGVyX3BzaWQscmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgfSBlbHNlIGlmICh3ZWJob29rX2V2ZW50LnBvc3RiYWNrKSB7XG4gICAgICAgIGhhbmRsZVBvc3RiYWNrKHNlbmRlcl9wc2lkLCB3ZWJob29rX2V2ZW50LnBvc3RiYWNrKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFJldHVybnMgYSAnMjAwIE9LJyByZXNwb25zZSB0byBhbGwgcmVxdWVzdHNcbiAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChcIkVWRU5UX1JFQ0VJVkVEXCIpO1xuICB9IGVsc2Uge1xuICAgIC8vIFJldHVybnMgYSAnNDA0IE5vdCBGb3VuZCcgaWYgZXZlbnQgaXMgbm90IGZyb20gYSBwYWdlIHN1YnNjcmlwdGlvblxuICAgIHJlcy5zZW5kU3RhdHVzKDQwNCk7XG4gIH1cbn0pO1xuXG5sZXQgZGVmYXVsdFJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICBcIldlIGNvdWxkIG5vdCB1bmRlcnN0YW5kIHlvdXIgbWVzc2FnZS4gS2luZGx5IHJlcGhyYXNlIHlvdXIgbWVzc2FnZSBhbmQgc2VuZCB1cyBhZ2Fpbi5cIlxuKTtcblxuLy8gQWRkcyBzdXBwb3J0IGZvciBHRVQgcmVxdWVzdHMgdG8gb3VyIHdlYmhvb2tcbmFwcC5nZXQoXCIvd2ViaG9va1wiLCAocmVxLCByZXMpID0+IHtcbiAgbGV0IFZFUklGWV9UT0tFTiA9IHByb2Nlc3MuZW52LlZFUklGWV9UT0tFTjtcblxuICAvLyBQYXJzZSB0aGUgcXVlcnkgcGFyYW1zXG4gIGxldCBtb2RlID0gcmVxLnF1ZXJ5W1wiaHViLm1vZGVcIl07XG4gIGxldCB0b2tlbiA9IHJlcS5xdWVyeVtcImh1Yi52ZXJpZnlfdG9rZW5cIl07XG4gIGxldCBjaGFsbGVuZ2UgPSByZXEucXVlcnlbXCJodWIuY2hhbGxlbmdlXCJdO1xuXG4gIC8vIENoZWNrcyBpZiBhIHRva2VuIGFuZCBtb2RlIGlzIGluIHRoZSBxdWVyeSBzdHJpbmcgb2YgdGhlIHJlcXVlc3RcbiAgaWYgKG1vZGUgJiYgdG9rZW4pIHtcbiAgICAvLyBDaGVja3MgdGhlIG1vZGUgYW5kIHRva2VuIHNlbnQgaXMgY29ycmVjdFxuICAgIGlmIChtb2RlID09PSBcInN1YnNjcmliZVwiICYmIHRva2VuID09PSBWRVJJRllfVE9LRU4pIHtcbiAgICAgIC8vIFJlc3BvbmRzIHdpdGggdGhlIGNoYWxsZW5nZSB0b2tlbiBmcm9tIHRoZSByZXF1ZXN0XG4gICAgICBjb25zb2xlLmxvZyhcIldFQkhPT0tfVkVSSUZJRURcIik7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChjaGFsbGVuZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZXNwb25kcyB3aXRoICc0MDMgRm9yYmlkZGVuJyBpZiB2ZXJpZnkgdG9rZW5zIGRvIG5vdCBtYXRjaFxuICAgICAgcmVzLnNlbmRTdGF0dXMoNDAzKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vLyBIYW5kbGVzIG1lc3NhZ2VzIGV2ZW50c1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfbWVzc2FnZSkge1xuICBsZXQgcmVzcG9uc2U7XG5cbiAgLy8gQ2hlY2sgaWYgdGhlIG1lc3NhZ2UgY29udGFpbnMgdGV4dFxuICBpZiAocmVjZWl2ZWRfbWVzc2FnZS50ZXh0KSB7XG4gICAgY29uc29sZS5sb2coYFJlY2VpdmVkIG1lc3NhZ2U6IFwiJHtyZWNlaXZlZF9tZXNzYWdlLnRleHR9XCJgKTtcblxuICAgIHJlc3BvbnNlID0gYXdhaXQgcHJvY2Vzc01lc3NhZ2Uoc2VuZGVyX3BzaWQsIHJlY2VpdmVkX21lc3NhZ2UpO1xuICAgIC8vIERlZmF1bHQgcmVzcG9uc2UgKGZvciBkZWJ1Z2dpbmcpXG4gICAgLy8gQ3JlYXRlIHRoZSBwYXlsb2FkIGZvciBhIGJhc2ljIHRleHQgbWVzc2FnZVxuICAgIC8vIHJlc3BvbnNlID0ge1xuICAgIC8vICAgdGV4dDogYFlvdSBzZW50IHRoZSBtZXNzYWdlOiBcIiR7cmVjZWl2ZWRfbWVzc2FnZS50ZXh0fVwiLmBcbiAgICAvLyB9O1xuICB9IGVsc2Uge1xuICAgIHJlc3BvbnNlID0gZGVmYXVsdFJlc3BvbnNlO1xuICAgIC8vICAgICAvLyBHZXRzIHRoZSBVUkwgb2YgdGhlIG1lc3NhZ2UgYXR0YWNobWVudFxuICAgIC8vICAgICBsZXQgYXR0YWNobWVudF91cmwgPSByZWNlaXZlZF9tZXNzYWdlLmF0dGFjaG1lbnRzWzBdLnBheWxvYWQudXJsO1xuICB9XG5cbiAgLy8gU2VuZHMgdGhlIHJlc3BvbnNlIG1lc3NhZ2VcbiAgY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKTtcbn1cblxuLy8gSGFuZGxlcyBtZXNzYWdpbmdfcG9zdGJhY2tzIGV2ZW50c1xuZnVuY3Rpb24gaGFuZGxlUG9zdGJhY2soc2VuZGVyX3BzaWQsIHJlY2VpdmVkX3Bvc3RiYWNrKSB7XG4gIGxldCByZXNwb25zZTtcblxuICAvLyBHZXQgdGhlIHBheWxvYWQgZm9yIHRoZSBwb3N0YmFja1xuICBsZXQgcGF5bG9hZCA9IHJlY2VpdmVkX3Bvc3RiYWNrLnBheWxvYWQ7XG4gIGNvbnNvbGUubG9nKGBSZWNlaXZlZCBwb3N0YmFjazogXCIke3BheWxvYWR9XCJgKTtcblxuICBsZXQgcG9zdGJhY2tfaW50ZW50ID0gcGF5bG9hZC5zcGxpdChcIiBcIilbMF07XG4gIGxldCBwb3N0YmFja19jb250ZW50ID0gcGF5bG9hZC5zdWJzdHJpbmcoXG4gICAgcGF5bG9hZC5pbmRleE9mKFwiIFwiKSArIDEsXG4gICAgcGF5bG9hZC5sZW5ndGhcbiAgKTtcblxuICAvLyBTZXQgdGhlIHJlc3BvbnNlIGJhc2VkIG9uIHRoZSBwb3N0YmFjayBpbnRlbnRcbiAgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJjYXJ0X2FkZFwiKSB7XG4gICAgLy8gQWRkIHRvIGNhcnRcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlQWRkQ2FydFJlc3BvbnNlKHNlbmRlcl9wc2lkLCBwb3N0YmFja19jb250ZW50LCAxKTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiY2FydF92aWV3XCIpIHtcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlVmlld0NhcnRSZXNwb25zZShzZW5kZXJfcHNpZCk7XG4gIH0gZWxzZSBpZiAocG9zdGJhY2tfaW50ZW50ID09PSBcImVucXVpcnlfcHJvZHVjdFwiKSB7XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICBgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBrbm93IGFib3V0IG91ciAke3Bvc3RiYWNrX2NvbnRlbnR9P2BcbiAgICApO1xuICB9IGVsc2UgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJjaGVja291dFwiKSB7XG4gICAgcmVzcG9uc2UgPSB7XG4gICAgICBhdHRhY2htZW50OiB7XG4gICAgICAgIHR5cGU6IFwidGVtcGxhdGVcIixcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIHRlbXBsYXRlX3R5cGU6IFwiYnV0dG9uXCIsXG4gICAgICAgICAgdGV4dDogXCJDbGljayBvbiB0aGUgYnV0dG9uIGJlbG93IHRvIHBheS5cIixcbiAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgdGl0bGU6IFwiUGF5XCIsXG4gICAgICAgICAgICAgIHBheWxvYWQ6IFwicGFpZFwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwicGFpZFwiKSB7XG4gICAgcmVzcG9uc2UgPSB7XG4gICAgICBhdHRhY2htZW50OiB7XG4gICAgICAgIHR5cGU6IFwidGVtcGxhdGVcIixcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIHRlbXBsYXRlX3R5cGU6IFwiYnV0dG9uXCIsXG4gICAgICAgICAgdGV4dDogXCJZb3VyIG9yZGVyIChvcmRlciBuby4pIGlzIGNvbmZpcm1lZC5cIixcbiAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgdGl0bGU6IFwiVmlldyBSZWNlaXB0XCIsXG4gICAgICAgICAgICAgIHBheWxvYWQ6IFwicmVjZWlwdF92aWV3XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9IGVsc2UgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJyZWNlaXB0X3ZpZXdcIikge1xuICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZWNlaXB0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpO1xuICB9XG5cbiAgaWYgKHJlc3BvbnNlID09IG51bGwpIHtcbiAgICByZXNwb25zZSA9IGRlZmF1bHRSZXNwb25zZSgpO1xuICB9XG5cbiAgLy8gU2VuZCB0aGUgbWVzc2FnZSB0byBhY2tub3dsZWRnZSB0aGUgcG9zdGJhY2tcbiAgY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKTtcbn1cblxuLy8gU2VuZHMgcmVzcG9uc2UgbWVzc2FnZXMgdmlhIHRoZSBTZW5kIEFQSVxuZnVuY3Rpb24gY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKSB7XG4gIC8vIFVuY29tbWVudCB0byBsb2cgcmVzcG9uc2Ugb2JqZWN0XG4gIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAvLyBDb25zdHJ1Y3QgdGhlIG1lc3NhZ2UgYm9keVxuICBsZXQgcmVxdWVzdF9ib2R5ID0ge1xuICAgIHJlY2lwaWVudDoge1xuICAgICAgaWQ6IHNlbmRlcl9wc2lkXG4gICAgfSxcbiAgICBtZXNzYWdlOiByZXNwb25zZVxuICB9O1xuXG4gIC8vIFNlbmQgdGhlIEhUVFAgcmVxdWVzdCB0byB0aGUgTWVzc2VuZ2VyIFBsYXRmb3JtXG4gIHJlcXVlc3QoXG4gICAge1xuICAgICAgdXJpOiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YyLjYvbWUvbWVzc2FnZXNcIixcbiAgICAgIHFzOiB7IGFjY2Vzc190b2tlbjogUEFHRV9BQ0NFU1NfVE9LRU4gfSxcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBqc29uOiByZXF1ZXN0X2JvZHlcbiAgICB9LFxuICAgIChlcnIsIHJlcywgYm9keSkgPT4ge1xuICAgICAgaWYgKCFlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJNZXNzYWdlIHNlbnQhXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byBzZW5kIG1lc3NhZ2U6XCIgKyBlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn1cblxuLy8gUHJvY2VzcyB0ZXh0IG1lc3NhZ2UgYW5kIHJldHVybnMgcmVzcG9uc2Ugb2JqZWN0IHRvIGhhbmRsZU1lc3NhZ2UoKVxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc01lc3NhZ2Uoc2VuZGVyX3BzaWQsIG1lc3NhZ2UpIHtcbiAgLy8gTkxQOiBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvbWVzc2VuZ2VyLXBsYXRmb3JtL2J1aWx0LWluLW5scFxuICBsZXQgZW50aXRpZXMgPSBtZXNzYWdlLm5scFtcImVudGl0aWVzXCJdO1xuXG4gIC8vIFVuY29tbWVudCB0byB2aWV3IGFsbCBlbnRpdGllcyBhbmQgdGhlaXIgeGFsdWVzXG4gIE9iamVjdC5rZXlzKGVudGl0aWVzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJFbnRpdHk6IFwiICsga2V5KTtcbiAgICBjb25zb2xlLmxvZyhlbnRpdGllc1trZXldKTtcbiAgfSk7XG5cbiAgLy8gQ2hlY2sgZ3JlZXRpbmdcbiAgbGV0IGlzX2dyZWV0aW5nID1cbiAgICBlbnRpdGllc1tcImdyZWV0aW5nc1wiXSAhPSBudWxsICYmXG4gICAgZW50aXRpZXNbXCJncmVldGluZ3NcIl1bMF1bXCJjb25maWRlbmNlXCJdID4gMC44OyAvLyBHcmVldGluZyB0aHJlc2hvbGQgc2V0IHRvIDAuOCAoc3RyaWN0ZXIpXG5cbiAgLy8gUmV0cmlldmUgZmlyc3QgaW50ZW50IG9iamVjdFxuICBsZXQgaW50ZW50ID0gZW50aXRpZXNbXCJpbnRlbnRcIl1bMF07XG5cbiAgaWYgKGludGVudFtcImNvbmZpZGVuY2VcIl0gPiAwLjUpIHtcbiAgICAvLyBQcm9jZXNzIGludGVudFxuICAgIGxldCBpbnRlbnRfcGFydHMgPSBpbnRlbnRbXCJ2YWx1ZVwiXS5zcGxpdChcIl9cIik7XG4gICAgbGV0IGludGVudF9jYXRlZ29yeSA9IGludGVudF9wYXJ0c1swXTtcbiAgICBsZXQgaW50ZW50X3N1YmNhdGVnb3J5ID0gaW50ZW50X3BhcnRzLmxlbmd0aCA+IDEgPyBpbnRlbnRfcGFydHNbMV0gOiBudWxsO1xuICAgIGxldCByZXNwb25zZSA9IG51bGw7XG5cbiAgICBzd2l0Y2ggKGludGVudF9jYXRlZ29yeSkge1xuICAgICAgY2FzZSBcInJlY29tbWVuZGF0aW9uXCI6XG4gICAgICAgIC8vIEhhbmRsZSByZWNvbW1lbmRhdGlvblxuICAgICAgICAvLyByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgICAgLy8gICBcIk1lc3NhZ2UgcmVjZWl2ZWQgaXMgYSByZWNvbW1lbmRhdGlvbiBtZXNzYWdlLlwiXG4gICAgICAgIC8vICk7XG5cbiAgICAgICAgbGV0IHByb2R1Y3RfdHlwZXMgPSBbXTtcbiAgICAgICAgaWYgKGVudGl0aWVzW1wicHJvZHVjdF90eXBlXCJdKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJQcm9jZXNzaW5nIHByb2R1Y3QgdHlwZXNcIik7XG4gICAgICAgICAgcHJvZHVjdF90eXBlcyA9IGVudGl0aWVzW1wicHJvZHVjdF90eXBlXCJdXG4gICAgICAgICAgICAuZmlsdGVyKG9iaiA9PiBvYmpbXCJjb25maWRlbmNlXCJdID4gMC41KVxuICAgICAgICAgICAgLm1hcChvYmogPT4gb2JqW1widmFsdWVcIl0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzcG9uc2UgPSBhd2FpdCBnZW5lcmF0ZVJlY29tbWVuZGF0aW9uc1Jlc3BvbnNlKHByb2R1Y3RfdHlwZXMpO1xuICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwiZW5xdWlyeVwiOlxuICAgICAgICAvLyBIYW5kbGUgZW5xdWlyeVxuICAgICAgICAvLyByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgICAgLy8gICBcIk1lc3NhZ2UgcmVjZWl2ZWQgaXMgYW4gZW5xdWlyeSBtZXNzYWdlLlwiXG4gICAgICAgIC8vICk7XG5cbiAgICAgICAgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJwcm9kdWN0XCIpIHtcbiAgICAgICAgICAvLyBSZXRyaWV2ZSBwcm9kdWN0IGFuZCBhdHRyaWJ1dGUgZnJvbSBlbnRpdGllcyBvYmplY3RcbiAgICAgICAgICBpZiAoZW50aXRpZXNbXCJwcm9kdWN0XCJdICYmIGVudGl0aWVzW1wiYXR0cmlidXRlXCJdKSB7XG4gICAgICAgICAgICBsZXQgcHJvZHVjdCA9IGVudGl0aWVzW1wicHJvZHVjdFwiXVswXTtcbiAgICAgICAgICAgIGxldCBhdHRyaWJ1dGUgPSBlbnRpdGllc1tcImF0dHJpYnV0ZVwiXVswXTtcbiAgICAgICAgICAgIC8vIFRPRE86IEhhbmRsZSBwcm9kdWN0IGVucXVpcnlcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVQcm9kdWN0RW5xdWlyeVJlc3BvbnNlKHByb2R1Y3QsIGF0dHJpYnV0ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZGVmYXVsdFJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChpbnRlbnRfc3ViY2F0ZWdvcnkgPT09IFwiZ2VuZXJhbFwiKSB7XG4gICAgICAgICAgbGV0IG1lc3NhZ2VzID0ge1xuICAgICAgICAgICAgcHJvZml0OlxuICAgICAgICAgICAgICBcIkFsbCBuZXQgcmV2ZW51ZSBlYXJuZWQgZnJvbSB0aGUgc2FsZSBvZiBvdXIgcHJvZHVjdHMgYW5kIHNlcnZpY2VzIGdvIHRvd2FyZHMgcGF5aW5nIGEgbW9udGhseSBhbGxvd2FuY2UgZm9yIG91ciBjbGllbnRzJyB3b3JrLCBhcyB3ZWxsIGFzIHRoZWlyIGx1bmNoIGV4cGVuc2VzIHdoaWxlIHVuZGVyZ29pbmcgdHJhaW5pbmcuXCIsXG4gICAgICAgICAgICBtYW51ZmFjdHVyZXI6XG4gICAgICAgICAgICAgIFwiV2Ugc3VwcG9ydCBhZHVsdHMgd2l0aCBpbnRlbGxlY3R1YWwgZGlzYWJpbGl0aWVzLiBXZSBzdGFydGVkIGEgcmFuZ2Ugb2Ygc29jaWFsIGVudGVycHJpc2UgcHJvamVjdHMgdG8gcHJvdmlkZSBhbHRlcm5hdGl2ZSB3b3JrIGVuZ2FnZW1lbnQgZm9yIG91ciBhZHVsdCB0cmFpbmVlcy5cIixcbiAgICAgICAgICAgIHByb2R1Y3RzOiBcIldlIHNlbGwgY3JhZnQgYW5kIGJha2VyIGdvb2RzLlwiXG4gICAgICAgICAgfTtcbiAgICAgICAgICAvLyBMb29wIHRocm91Z2ggbWVzc2FnZSBrZXlzIChlbnRpdHkpIGFuZCBmaW5kIGlmIGVudGl0eSBpcyBpbiBlbnRpdGllc1xuICAgICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VzKS5mb3JFYWNoKGVudGl0eSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgPT0gbnVsbCAmJiBlbnRpdGllc1tlbnRpdHldKSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKG1lc3NhZ2VzW2VudGl0eV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJkZWxpdmVyeVwiKSB7XG4gICAgICAgICAgaWYgKGVudGl0aWVzW1wic3RhdHVzXCJdKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBPcmRlciBzdGF0dXNcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAgICAgICBcIllvdXIgbGF0ZXN0IG9yZGVyIGlzIDxzdGF0dXM+LlwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZW50aXRpZXNbXCJlc3RpbWF0ZWRfYXJyaXZhbFwiXSkge1xuICAgICAgICAgICAgLy8gVE9ETzogT3JkZXIgZXN0aW1hdGVkIGFycml2YWxcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAgICAgICBcIlRoZSBhdmVyYWdlIGRlbGl2ZXJ5IHRpbWUgdGFrZXMgNS03IHdvcmtpbmcgZGF5cy4gWW91ciBvcmRlcmVkIHdhcyBzZW50IG9uIDxkYXRlPi4gSXQgaXMgZXN0aW1hdGVkIHRvIGFycml2ZSBvbiA8ZGF0ZSArIDcgd29ya2luZyBkYXlzPi5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVudGl0aWVzW1wiY29zdFwiXSkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiSXQgaXMgYSBmbGF0IGZlZSBvZiAkMiBmb3IgZXZlcnkgb3JkZXIuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAgICAgICBcIldlIGRlbGl2ZXIgaXNsYW5kd2lkZS4gVGhlIGF2ZXJhZ2UgZGVsaXZlcnkgdGltZSB0YWtlcyA1LTcgd29ya2luZyBkYXlzLlwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImNhcnRcIjpcbiAgICAgICAgLy8gSGFuZGxlIHNob3BwaW5nIGNhcnRcbiAgICAgICAgLy8gcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgIC8vICAgXCJNZXNzYWdlIHJlY2VpdmVkIGlzIGEgY2FydCBtZXNzYWdlLlwiXG4gICAgICAgIC8vICk7XG5cbiAgICAgICAgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJhZGRcIiAmJiBlbnRpdGllc1tcInByb2R1Y3RcIl0pIHtcbiAgICAgICAgICBsZXQgcHJvZHVjdF9uYW1lID0gZW50aXRpZXNbXCJwcm9kdWN0XCJdWzBdW1widmFsdWVcIl07XG4gICAgICAgICAgbGV0IHF1YW50aXR5ID0gZW50aXRpZXNbXCJudW1iZXJcIl1cbiAgICAgICAgICAgID8gZW50aXRpZXNbXCJudW1iZXJcIl1bMF1bXCJ2YWx1ZVwiXVxuICAgICAgICAgICAgOiAxO1xuICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVBZGRDYXJ0UmVzcG9uc2UoXG4gICAgICAgICAgICBzZW5kZXJfcHNpZCxcbiAgICAgICAgICAgIHByb2R1Y3RfbmFtZSxcbiAgICAgICAgICAgIHF1YW50aXR5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChpbnRlbnRfc3ViY2F0ZWdvcnkgPT09IFwidmlld1wiKSB7XG4gICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXNwb25zZSA9IGRlZmF1bHRSZXNwb25zZTtcbiAgICB9XG5cbiAgICByZXNwb25zZSA9IHJlc3BvbnNlID09IG51bGwgPyBkZWZhdWx0UmVzcG9uc2UgOiByZXNwb25zZTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0gZWxzZSBpZiAoaXNfZ3JlZXRpbmcpIHtcbiAgICAvLyBNZXNzYWdlIGhhcyBubyBpbnRlbnQsIGp1c3QgZ3JlZXRpbmdcbiAgICAvLyBUT0RPOiBBZGQgcXVpY2sgcmVwbGllcyBvZiBjaGF0Ym90IGZ1bmN0aW9uYWxpdGllcyAocmVjb21tZW5kYXRpb25zLCBjaGVjayBvcmRlciBzdGF0dXMsIGV0Yy4pXG4gICAgcmV0dXJuIGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgIFwiSGkgdGhlcmUhIFdlbGNvbWUgdG8gTUlORFMuIEhvdyBjYW4gSSBoZWxwIHlvdT9cIlxuICAgICk7XG4gIH1cblxuICAvLyBObyBpbnRlbnQgbm9yIGdyZWV0aW5nXG4gIHJldHVybiBkZWZhdWx0UmVzcG9uc2U7XG59XG5cbi8vIFdyYXBwZXIgbWV0aG9kIHRvIGNvbnZlcnQgdGV4dCBtZXNzYWdlIHN0cmluZyB0byByZXNwb25zZSBvYmplY3RcbmZ1bmN0aW9uIGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShtZXNzYWdlKSB7XG4gIHJldHVybiB7XG4gICAgdGV4dDogbWVzc2FnZVxuICB9O1xufVxuXG4vLyBSZXNwb25zZSBvbiBnZW5lcmljIHRlbXBsYXRlIGNhcm91c2VsIGZvciByZWNvbW1lbmRhdGlvbnNcbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zUmVzcG9uc2UocHJvZHVjdF90eXBlcykge1xuICAvLyBUT0RPOiBSZXRyaWV2ZSBwcm9kdWN0cyB0byByZWNvbW1lbmQgYmFzZWQgb24gbGlzdCBvZiBwcm9kdWN0IHR5cGVzLiBJZiBwcm9kdWN0IHR5cGVzIGlzIGFuIGVtcHR5IGFycmF5LCByZWNvbW1lbmQgcHJvZHVjdHMgb2YgdmFyaW91cyB0eXBlc1xuICBsZXQgcHJvZHVjdHM7XG4gIFxuICBpZiAocHJvZHVjdF90eXBlcy5sZW5ndGggPT09IDApIHtcbiAgICBwcm9kdWN0cyA9IGF3YWl0IGdldEFsbFByb2R1Y3RzKCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2cocHJvZHVjdF90eXBlc1swXSk7XG4gICAgcHJvZHVjdHMgPSBhd2FpdCBnZXRQcm9kdWN0c0J5VHlwZShwcm9kdWN0X3R5cGVzWzBdKTtcbiAgfVxuICBcbiAgbGV0IHJlc3BvbnNlID0ge1xuICAgIGF0dGFjaG1lbnQ6IHtcbiAgICAgIHR5cGU6IFwidGVtcGxhdGVcIixcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgdGVtcGxhdGVfdHlwZTogXCJnZW5lcmljXCIsXG4gICAgICAgIGVsZW1lbnRzOiBwcm9kdWN0cy5tYXAocHJvZHVjdCA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRpdGxlOiBwcm9kdWN0W1widGl0bGVcIl0sXG4gICAgICAgICAgICBzdWJ0aXRsZTogYCQke3Byb2R1Y3RbXCJwcmljZVwiXX1gLFxuICAgICAgICAgICAgaW1hZ2VfdXJsOiBwcm9kdWN0W1wiaW1hZ2VfbGlua1wiXSxcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJMZWFybiBNb3JlXCIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogYGVucXVpcnlfcHJvZHVjdCAke3Byb2R1Y3RbXCJ0aXRsZVwiXX1gXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQWRkIHRvIENhcnRcIixcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiBgY2FydF9hZGQgJHtwcm9kdWN0W1widGl0bGVcIl19YFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiByZXNwb25zZTtcbn1cblxuLy8gUmVzcG9uc2Ugb24gY29uZmlybWF0aW9uIG9mIHByb2R1Y3QgYWRkZWQgdG8gY2FydCBhbmQgcXVpY2sgcmVwbGllc1xuZnVuY3Rpb24gZ2VuZXJhdGVBZGRDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQsIHByb2R1Y3RfbmFtZSwgcXVhbnRpdHkpIHtcbiAgLy8gVE9ETzogQWRkIHByb2R1Y3QgdG8gY2FydCBpbiBkYlxuXG4gIHJldHVybiB7XG4gICAgdGV4dDogYEFkZGVkICR7cXVhbnRpdHl9ICR7cHJvZHVjdF9uYW1lfSB0byBjYXJ0LmAsXG4gICAgcXVpY2tfcmVwbGllczogW1xuICAgICAge1xuICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICB0aXRsZTogXCJWaWV3IENhcnRcIixcbiAgICAgICAgcGF5bG9hZDogYGNhcnRfdmlld2BcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIHRpdGxlOiBcIkNoZWNrb3V0XCIsXG4gICAgICAgIHBheWxvYWQ6IGBjaGVja291dGBcbiAgICAgIH1cbiAgICBdXG4gIH07XG59XG5cbi8vIFJlc3BvbnNlIG9uIGdlbmVyaWMgdGVtcGxhdGUgY2Fyb3VzZWwgZm9yIGNhcnRcbmZ1bmN0aW9uIGdlbmVyYXRlVmlld0NhcnRSZXNwb25zZShzZW5kZXJfcHNpZCkge1xuICAvLyBUT0RPOiBHZXQgY2FydCBmcm9tIGRiXG4gIGxldCBwcm9kdWN0cyA9IFtcbiAgICB7XG4gICAgICBpZDogMSxcbiAgICAgIG5hbWU6IFwiRGFyayBDaG9jb2xhdGUgT2F0bWVhbCBDb29raWVzXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCIsXG4gICAgICBxdWFudGl0eTogMVxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IDIsXG4gICAgICBuYW1lOiBcIkNyYW5iZXJyeSBTd2VldGhlYXJ0IENvb2tpZXMgKEVnZ2xlc3MpXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCIsXG4gICAgICBxdWFudGl0eTogMlxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IDMsXG4gICAgICBuYW1lOiBcIkVhcmwgR3JleSBTdW5mbG93ZXIgU2VlZHMgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9XG4gIF07XG4gIGxldCByZXNwb25zZSA9IHtcbiAgICBhdHRhY2htZW50OiB7XG4gICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIHRlbXBsYXRlX3R5cGU6IFwiZ2VuZXJpY1wiLFxuICAgICAgICBlbGVtZW50czogcHJvZHVjdHMubWFwKHByb2R1Y3QgPT4ge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aXRsZTogcHJvZHVjdFtcIm5hbWVcIl0sXG4gICAgICAgICAgICBzdWJ0aXRsZTogYFF0eTogJHtwcm9kdWN0W1wicXVhbnRpdHlcIl19ICgkJHtwcm9kdWN0W1wicHJpY2VcIl19IGVhY2gpYCxcbiAgICAgICAgICAgIGltYWdlX3VybDogcHJvZHVjdFtcInVybFwiXSxcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJBZGQgMVwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBjYXJ0X2FkZCAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJSZW1vdmUgQWxsXCIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogYGNhcnRfcmVtb3ZlICR7cHJvZHVjdFtcIm5hbWVcIl19YFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiByZXNwb25zZTtcbn1cblxuLy8gUmVzcG9uc2Ugb24gcmVjZWlwdCB0ZW1wbGF0ZSBmb3IgbGF0ZXN0IGNvbmZpcm1lZCBvcmRlclxuZnVuY3Rpb24gZ2VuZXJhdGVSZWNlaXB0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpIHtcbiAgLy8gVE9ETzogR2V0IGxhdGVzdCBvcmRlciBmcm9tIGRhdGFiYXNlXG4gIGxldCBwcm9kdWN0cyA9IFtcbiAgICB7XG4gICAgICBpZDogMSxcbiAgICAgIG5hbWU6IFwiRGFyayBDaG9jb2xhdGUgT2F0bWVhbCBDb29raWVzXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCIsXG4gICAgICBxdWFudGl0eTogMVxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IDIsXG4gICAgICBuYW1lOiBcIkNyYW5iZXJyeSBTd2VldGhlYXJ0IENvb2tpZXMgKEVnZ2xlc3MpXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCIsXG4gICAgICBxdWFudGl0eTogMlxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IDMsXG4gICAgICBuYW1lOiBcIkVhcmwgR3JleSBTdW5mbG93ZXIgU2VlZHMgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9XG4gIF07XG5cbiAgbGV0IHJlc3BvbnNlID0ge1xuICAgIGF0dGFjaG1lbnQ6IHtcbiAgICAgIHR5cGU6IFwidGVtcGxhdGVcIixcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgdGVtcGxhdGVfdHlwZTogXCJyZWNlaXB0XCIsXG4gICAgICAgIHJlY2lwaWVudF9uYW1lOiBcIjxDVVNUT01FUl9OQU1FPlwiLCAvLyBNYW5kYXRvcnkgZmllbGRcbiAgICAgICAgb3JkZXJfbnVtYmVyOiBcIjxPUkRFUl9OVU1CRVI+XCIsIC8vIE1hbmRhdG9yeSBmaWVsZFxuICAgICAgICBjdXJyZW5jeTogXCJTR0RcIixcbiAgICAgICAgcGF5bWVudF9tZXRob2Q6IFwiUGF5UGFsXCIsXG4gICAgICAgIG9yZGVyX3VybDogXCJcIixcbiAgICAgICAgYWRkcmVzczoge1xuICAgICAgICAgIHN0cmVldF8xOiBcIjkgU3RyYWl0cyBWaWV3XCIsIC8vIE1hbmRhdG9yeSBmaWVsZFxuICAgICAgICAgIGNpdHk6IFwiU2luZ2Fwb3JlXCIsXG4gICAgICAgICAgcG9zdGFsX2NvZGU6IFwiMDE4OTM3XCIsXG4gICAgICAgICAgc3RhdGU6IFwiU0dcIixcbiAgICAgICAgICBjb3VudHJ5OiBcIlNHXCJcbiAgICAgICAgfSxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHN1YnRvdGFsOiAxMCxcbiAgICAgICAgICBzaGlwcGluZ19jb3N0OiA1LFxuICAgICAgICAgIHRvdGFsX3RheDogMixcbiAgICAgICAgICB0b3RhbF9jb3N0OiAxNVxuICAgICAgICB9LFxuICAgICAgICBlbGVtZW50czogcHJvZHVjdHMubWFwKHByb2R1Y3QgPT4ge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aXRsZTogYCR7cHJvZHVjdFtcIm5hbWVcIl19YCxcbiAgICAgICAgICAgIHN1YnRpdGxlOiBcIlwiLFxuICAgICAgICAgICAgcXVhbnRpdHk6IHByb2R1Y3RbXCJxdWFudGl0eVwiXSxcbiAgICAgICAgICAgIHByaWNlOiBwcm9kdWN0W1wicHJpY2VcIl0sXG4gICAgICAgICAgICBjdXJyZW5jeTogXCJTR0RcIixcbiAgICAgICAgICAgIGltYWdlX3VybDogcHJvZHVjdFtcInVybFwiXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiByZXNwb25zZTtcbn1cblxuLy8gUmVzcG9uc2Ugb24gcHJvZG9kdWN0IGVucXVpcnlcbmZ1bmN0aW9uIGdlbmVyYXRlUHJvZHVjdEVucXVpcnlSZXNwb25zZShwcm9kdWN0LCBhdHRyaWJ1dGUpIHtcbiAgLy8gVE9ETzogR2V0IHByb2R1Y3QgZnJvbSBkYiwgY3JlYXRlIG1lc3NhZ2UgYW5kIGdlbmVyYXRlIHJlc3BvbnNlXG4gIHJldHVybiBkZWZhdWx0UmVzcG9uc2U7XG59XG4iXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "express",
        "require",
        "bodyParser",
        "app",
        "use",
        "json",
        "request",
        "dotenv",
        "crypto",
        "mongoose",
        "config",
        "PAGE_ACCESS_TOKEN",
        "process",
        "env",
        "DB_PASSWORD",
        "connect",
        "useNewUrlParser",
        "useCreateIndex",
        "useFindAndModify",
        "then",
        "console",
        "log",
        "Promise",
        "global",
        "FB_APP_SECRET",
        "appsecret_proof",
        "createHmac",
        "update",
        "digest",
        "listen",
        "get",
        "req",
        "res",
        "VERIFY_TOKEN",
        "mode",
        "query",
        "token",
        "challenge",
        "status",
        "send",
        "sendStatus",
        "body",
        "post",
        "object",
        "entry",
        "forEach",
        "webhook_event",
        "messaging",
        "sender_psid",
        "sender",
        "id",
        "message",
        "quick_reply",
        "handlePostback",
        "handleMessage",
        "response",
        "user",
        "length",
        "postback",
        "defaultResponse",
        "generateResponseFromMessage",
        "received_message",
        "text",
        "processMessage",
        "callSendAPI",
        "received_postback",
        "payload",
        "postback_intent",
        "split",
        "postback_content",
        "substring",
        "indexOf",
        "generateAddCartResponse",
        "generateViewCartResponse",
        "attachment",
        "type",
        "template_type",
        "buttons",
        "title",
        "generateReceiptResponse",
        "request_body",
        "recipient",
        "uri",
        "qs",
        "access_token",
        "method",
        "err",
        "error",
        "entities",
        "nlp",
        "Object",
        "keys",
        "key",
        "is_greeting",
        "intent",
        "intent_parts",
        "intent_category",
        "intent_subcategory",
        "product_types",
        "filter",
        "obj",
        "map",
        "generateRecommendationsResponse",
        "product",
        "attribute",
        "generateProductEnquiryResponse",
        "messages",
        "profit",
        "manufacturer",
        "products",
        "entity",
        "product_name",
        "quantity",
        "elements",
        "subtitle",
        "image_url",
        "quick_replies",
        "content_type",
        "name",
        "price",
        "url",
        "recipient_name",
        "order_number",
        "currency",
        "payment_method",
        "order_url",
        "address",
        "street_1",
        "city",
        "postal_code",
        "state",
        "country",
        "summary",
        "subtotal",
        "shipping_cost",
        "total_tax",
        "total_cost"
      ],
      "mappings": "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",
      "file": "index.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\nconst express = require(\"express\"),\n  bodyParser = require(\"body-parser\"),\n  app = express().use(bodyParser.json()); // creates express http server\nconst request = require(\"request\");\nconst dotenv = require('dotenv');\nconst crypto = require('crypto');\nconst mongoose = require('mongoose');\ndotenv.config();\n\n// Get page access token\nconst PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Setup to connect to DB\nconst DB_PASSWORD = process.env.DB_PASSWORD;\nmongoose.connect('mongodb+srv://mongoadmin:'+ DB_PASSWORD +'@fb-hack-chatbot-cevnk.mongodb.net/fbmsg',{useNewUrlParser: true,useCreateIndex: true, useFindAndModify: false}).then(() => console.log(\"DB Connection successful\"));\nmongoose.Promise = global.Promise;\n\nimport { getAllProducts, getProductsByType, getProductByID, getProductPrice, getProductDesc, getProductsByName, getProductByNameVar, checkUser, createUser } from './DBConn';\nimport { getName, getProductDetails } from './fbhelper';\n\n// Get page access token\nconst FB_APP_SECRET = process.env.FB_APP_SECRET;\nconst appsecret_proof = crypto.createHmac('sha256',FB_APP_SECRET).update(PAGE_ACCESS_TOKEN).digest('hex')\n\n// Sets server port and logs message on success\napp.listen(3000, () => console.log(\"webhook is listening\"));\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", (req, res) => {\n  let VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  let mode = req.query[\"hub.mode\"];\n  let token = req.query[\"hub.verify_token\"];\n  let challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// For testing endpoints\napp.get(\"/test\", (req,res) =>{\n    let body = req.body;\n    // getAllProducts().then(function(products){\n    // console.log(products);\n    // });\n    // getProductByType(\"Baker\").then(function(products){\n    // console.log(products);\n    // });\n    // getProductByID('3060724697352196').then(function(prod){\n        // console.log(prod);\n    // });\n    // getProductPrice('3060724697352196').then(function(price){\n        // console.log(price);\n    // });\n    // getProductDesc('3060724697352196').then(function(description){\n        // console.log(description);\n    // });\n    // getProductsByName('Earl Grey Sunflower Seeds Cookies').then(function(prod){\n        // console.log(prod);\n    // });\n    // getProductByNameVar('Earl Grey Sunflower Seeds Cookies','Gift box').then(function(prod){\n    //     console.log(prod);\n    // });\n    res.status(200).send(\"Success\");\n    \n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", (req, res) => {\n  let body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function(entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      let webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      let sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        if (webhook_event.message.quick_reply) {\n          handlePostback(sender_psid, webhook_event.message.quick_reply);\n        } else {\n          handleMessage(sender_psid, webhook_event.message);\n        }\n        \n        getName(PAGE_ACCESS_TOKEN,sender_psid, function(response){\n            checkUser(sender_psid,response).then(function(user){\n                if (user.length == 0){\n                    createUser(sender_psid,response);\n                }\n            });\n        });\n\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\nlet defaultResponse = generateResponseFromMessage(\n  \"We could not understand your message. Kindly rephrase your message and send us again.\"\n);\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", (req, res) => {\n  let VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  let mode = req.query[\"hub.mode\"];\n  let token = req.query[\"hub.verify_token\"];\n  let challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Handles messages events\nasync function handleMessage(sender_psid, received_message) {\n  let response;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(`Received message: \"${received_message.text}\"`);\n\n    response = await processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  let response;\n\n  // Get the payload for the postback\n  let payload = received_postback.payload;\n  console.log(`Received postback: \"${payload}\"`);\n\n  let postback_intent = payload.split(\" \")[0];\n  let postback_content = payload.substring(\n    payload.indexOf(\" \") + 1,\n    payload.length\n  );\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\n      `What would you like to know about our ${postback_content}?`\n    );\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [\n            {\n              type: \"postback\",\n              title: \"Pay\",\n              payload: \"paid\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [\n            {\n              type: \"postback\",\n              title: \"View Receipt\",\n              payload: \"receipt_view\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  let request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request(\n    {\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    },\n    (err, res, body) => {\n      if (!err) {\n        console.log(\"Message sent!\");\n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    }\n  );\n}\n\n// Process text message and returns response object to handleMessage()\nasync function processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  let entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  Object.keys(entities).forEach(key => {\n    console.log(\"Entity: \" + key);\n    console.log(entities[key]);\n  });\n\n  // Check greeting\n  let is_greeting =\n    entities[\"greetings\"] != null &&\n    entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  let intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    let intent_parts = intent[\"value\"].split(\"_\");\n    let intent_category = intent_parts[0];\n    let intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    let response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        let product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"]\n            .filter(obj => obj[\"confidence\"] > 0.5)\n            .map(obj => obj[\"value\"]);\n        }\n\n        response = await generateRecommendationsResponse(product_types);\n        console.log(response);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"attribute\"]) {\n            let product = entities[\"product\"][0];\n            let attribute = entities[\"attribute\"][0];\n            // TODO: Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          let messages = {\n            profit:\n              \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer:\n              \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(entity => {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\n              \"Your latest order is <status>.\"\n            );\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\n              \"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\"\n            );\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\n              \"It is a flat fee of $2 for every order.\"\n            );\n          } else {\n            response = generateResponseFromMessage(\n              \"We deliver islandwide. The average delivery time takes 5-7 working days.\"\n            );\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          let product_name = entities[\"product\"][0][\"value\"];\n          let quantity = entities[\"number\"]\n            ? entities[\"number\"][0][\"value\"]\n            : 1;\n          response = generateAddCartResponse(\n            sender_psid,\n            product_name,\n            quantity\n          );\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\n      \"Hi there! Welcome to MINDS. How can I help you?\"\n    );\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nasync function generateRecommendationsResponse(product_types) {\n  // TODO: Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  let products;\n  \n  if (product_types.length === 0) {\n    products = await getAllProducts();\n  } else {\n    console.log(product_types[0]);\n    products = await getProductsByType(product_types[0]);\n  }\n  \n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"title\"],\n            subtitle: `$${product[\"price\"]}`,\n            image_url: product[\"image_link\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Learn More\",\n                payload: `enquiry_product ${product[\"title\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Add to Cart\",\n                payload: `cart_add ${product[\"title\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: `Added ${quantity} ${product_name} to cart.`,\n    quick_replies: [\n      {\n        content_type: \"text\",\n        title: \"View Cart\",\n        payload: `cart_view`\n      },\n      {\n        content_type: \"text\",\n        title: \"Checkout\",\n        payload: `checkout`\n      }\n    ]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"name\"],\n            subtitle: `Qty: ${product[\"quantity\"]} ($${product[\"price\"]} each)`,\n            image_url: product[\"url\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Add 1\",\n                payload: `cart_add ${product[\"name\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Remove All\",\n                payload: `cart_remove ${product[\"name\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<CUSTOMER_NAME>\", // Mandatory field\n        order_number: \"<ORDER_NUMBER>\", // Mandatory field\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        order_url: \"\",\n        address: {\n          street_1: \"9 Straits View\", // Mandatory field\n          city: \"Singapore\",\n          postal_code: \"018937\",\n          state: \"SG\",\n          country: \"SG\"\n        },\n        summary: {\n          subtotal: 10,\n          shipping_cost: 5,\n          total_tax: 2,\n          total_cost: 15\n        },\n        elements: products.map(product => {\n          return {\n            title: `${product[\"name\"]}`,\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return defaultResponse;\n}\n"
      ]
    },
    "mtime": 1592494743000
  },
  "{\"filename\":\"/app/DBConn.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [
            "getAllProducts",
            "getProductsByType",
            "getProductByID",
            "getProductPrice",
            "getProductDesc",
            "getProductsByName",
            "getProductByNameVar",
            "checkUser",
            "createUser"
          ],
          "specifiers": [
            {
              "kind": "local",
              "local": "getAllProducts",
              "exported": "getAllProducts"
            },
            {
              "kind": "local",
              "local": "getProductsByType",
              "exported": "getProductsByType"
            },
            {
              "kind": "local",
              "local": "getProductByID",
              "exported": "getProductByID"
            },
            {
              "kind": "local",
              "local": "getProductPrice",
              "exported": "getProductPrice"
            },
            {
              "kind": "local",
              "local": "getProductDesc",
              "exported": "getProductDesc"
            },
            {
              "kind": "local",
              "local": "getProductsByName",
              "exported": "getProductsByName"
            },
            {
              "kind": "local",
              "local": "getProductByNameVar",
              "exported": "getProductByNameVar"
            },
            {
              "kind": "local",
              "local": "checkUser",
              "exported": "checkUser"
            },
            {
              "kind": "local",
              "local": "createUser",
              "exported": "createUser"
            }
          ]
        }
      }
    },
    "options": {
      "filename": "/app/DBConn.js",
      "filenameRelative": "/app/DBConn.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "DBConn.js",
      "sourceFileName": "DBConn.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "DBConn"
    },
    "ignored": false,
    "code": "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar mongoose = require('mongoose');\n\nvar userSchema = new mongoose.Schema({\n    id: String,\n    name: String\n});\n\nvar productsSchema = new mongoose.Schema({\n    id: String,\n    pid: String,\n    title: String,\n    description: String,\n    availability: String,\n    inventory: String,\n    condition: String,\n    price: String,\n    link: String,\n    image_link: String,\n    brand: String,\n    item_group_id: String,\n    color: String,\n    pattern: String,\n    product_type: String,\n    allergens: String\n});\n\nvar cartSchema = new mongoose.Schema({\n    uid: String,\n    pid: String,\n    quantity: Number,\n    price: Number\n});\n\nvar ordersSchema = new mongoose.Schema({\n    uid: String,\n    trackingNum: Number,\n    orderStatus: Number,\n    orderDateTime: Date,\n    orderDetails: [{ name: String, pid: String, quantity: Number, price: Number }]\n    // Are we able to find a way to use Double/Float for datatypes?\n});\n\nvar User = mongoose.model('users', userSchema);\nvar Product = mongoose.model('products', productsSchema);\nvar Cart = mongoose.model('cart', cartSchema);\nvar Order = mongoose.model('orders', ordersSchema);\n\n// Create user if user not found in database\nfunction createUser(fbid, name) {\n    var newUser = new User({\n        id: fbid,\n        name: name\n    });\n    newUser.save().then(function (doc) {\n        return console.log(doc);\n    }).catch(function (err) {\n        return console.log(err);\n    });\n}\n\nfunction checkUser(fbid) {\n    return User.find({ 'id': fbid }).then(function (user) {\n        return user;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Get all products\nasync function getAllProducts() {\n    var products = await Product.find({});\n    return products;\n}\n\n//Get product by type\nfunction getProductsByType(typeValue) {\n    return Product.find({ 'product_type': typeValue }).then(function (products) {\n        return products;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Get product by ID\nfunction getProductByID(pid) {\n    return Product.find({ 'pid': pid }).then(function (prod) {\n        return prod;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// Get product Price by ID\nfunction getProductPrice(pid) {\n    return Product.find({ 'pid': pid }).then(function (prod) {\n        return prod[0].price;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// get product Desc by ID\nfunction getProductDesc(pid) {\n    return Product.find({ 'pid': pid }).then(function (prod) {\n        return prod[0].description;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// get products with all the differnt variations by Name\nfunction getProductsByName(name) {\n    return Product.find({ 'title': name }).then(function (prod) {\n        return prod;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// get product by name and variation\nfunction getProductByNameVar(name, variation) {\n    return Product.find({ 'title': name, 'pattern': variation }).then(function (prod) {\n        return prod;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Check if user has an active shopping cart\nfunction checkCart(userID, products, quantity) {\n    pool.query('SELECT * FROM cart where uid=$1', [userID], function (error, results) {\n        if (error) {\n            throw error;\n        }\n        rowCount = results.rowCount;\n        console.log(results);\n        if (rowCount == 0) {\n            createCart(userID, products, quantity);\n        } else {\n            products += results.something;\n            quantity += results.something;\n            updateCart(userID, products, quantity);\n        }\n    });\n}\n\n// Initial creation of a fresh cart\nfunction createCart(userID, products, quantity) {\n    pool.query('INSERT INTO cart(uid,products,quantity) VALUES ($1,$2,$3)', [userID, products, quantity], function (error, reuslts) {\n        if (error) {\n            throw error;\n        }\n        console.log(results.insertId);\n    });\n}\n\n// Update cart if user has an active cart\nfunction updateCart(userID, products, quantity) {\n    pool.query('UPDATE cart SET products=$1, quantity=$2 WHERE uid=$3', [products, quantity, userID], function (error, results) {\n        if (error) {\n            throw error;\n        }\n        console.log(results.insertId);\n    });\n}\n\nexports.getAllProducts = getAllProducts;\nexports.getProductsByType = getProductsByType;\nexports.getProductByID = getProductByID;\nexports.getProductPrice = getProductPrice;\nexports.getProductDesc = getProductDesc;\nexports.getProductsByName = getProductsByName;\nexports.getProductByNameVar = getProductByNameVar;\nexports.checkUser = checkUser;\nexports.createUser = createUser;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRCQ29ubi5qcyJdLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJ1c2VyU2NoZW1hIiwiU2NoZW1hIiwiaWQiLCJTdHJpbmciLCJuYW1lIiwicHJvZHVjdHNTY2hlbWEiLCJwaWQiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiYXZhaWxhYmlsaXR5IiwiaW52ZW50b3J5IiwiY29uZGl0aW9uIiwicHJpY2UiLCJsaW5rIiwiaW1hZ2VfbGluayIsImJyYW5kIiwiaXRlbV9ncm91cF9pZCIsImNvbG9yIiwicGF0dGVybiIsInByb2R1Y3RfdHlwZSIsImFsbGVyZ2VucyIsImNhcnRTY2hlbWEiLCJ1aWQiLCJxdWFudGl0eSIsIk51bWJlciIsIm9yZGVyc1NjaGVtYSIsInRyYWNraW5nTnVtIiwib3JkZXJTdGF0dXMiLCJvcmRlckRhdGVUaW1lIiwiRGF0ZSIsIm9yZGVyRGV0YWlscyIsIlVzZXIiLCJtb2RlbCIsIlByb2R1Y3QiLCJDYXJ0IiwiT3JkZXIiLCJjcmVhdGVVc2VyIiwiZmJpZCIsIm5ld1VzZXIiLCJzYXZlIiwidGhlbiIsImNvbnNvbGUiLCJsb2ciLCJkb2MiLCJjYXRjaCIsImVyciIsImNoZWNrVXNlciIsImZpbmQiLCJ1c2VyIiwiZ2V0QWxsUHJvZHVjdHMiLCJwcm9kdWN0cyIsImdldFByb2R1Y3RzQnlUeXBlIiwidHlwZVZhbHVlIiwiZ2V0UHJvZHVjdEJ5SUQiLCJwcm9kIiwiZ2V0UHJvZHVjdFByaWNlIiwiZ2V0UHJvZHVjdERlc2MiLCJnZXRQcm9kdWN0c0J5TmFtZSIsImdldFByb2R1Y3RCeU5hbWVWYXIiLCJ2YXJpYXRpb24iLCJjaGVja0NhcnQiLCJ1c2VySUQiLCJwb29sIiwicXVlcnkiLCJlcnJvciIsInJlc3VsdHMiLCJyb3dDb3VudCIsImNyZWF0ZUNhcnQiLCJzb21ldGhpbmciLCJ1cGRhdGVDYXJ0IiwicmV1c2x0cyIsImluc2VydElkIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQU1BLFdBQVdDLFFBQVEsVUFBUixDQUFqQjs7QUFFQSxJQUFNQyxhQUFhLElBQUlGLFNBQVNHLE1BQWIsQ0FBb0I7QUFDbkNDLFFBQUlDLE1BRCtCO0FBRW5DQyxVQUFNRDtBQUY2QixDQUFwQixDQUFuQjs7QUFLQSxJQUFNRSxpQkFBaUIsSUFBSVAsU0FBU0csTUFBYixDQUFvQjtBQUN2Q0MsUUFBSUMsTUFEbUM7QUFFdkNHLFNBQUtILE1BRmtDO0FBR3ZDSSxXQUFPSixNQUhnQztBQUl2Q0ssaUJBQWFMLE1BSjBCO0FBS3ZDTSxrQkFBY04sTUFMeUI7QUFNdkNPLGVBQVdQLE1BTjRCO0FBT3ZDUSxlQUFXUixNQVA0QjtBQVF2Q1MsV0FBT1QsTUFSZ0M7QUFTdkNVLFVBQU1WLE1BVGlDO0FBVXZDVyxnQkFBWVgsTUFWMkI7QUFXdkNZLFdBQU9aLE1BWGdDO0FBWXZDYSxtQkFBZWIsTUFad0I7QUFhdkNjLFdBQU9kLE1BYmdDO0FBY3ZDZSxhQUFTZixNQWQ4QjtBQWV2Q2dCLGtCQUFjaEIsTUFmeUI7QUFnQnZDaUIsZUFBV2pCO0FBaEI0QixDQUFwQixDQUF2Qjs7QUFtQkEsSUFBTWtCLGFBQWEsSUFBSXZCLFNBQVNHLE1BQWIsQ0FBb0I7QUFDbkNxQixTQUFLbkIsTUFEOEI7QUFFbkNHLFNBQUtILE1BRjhCO0FBR25Db0IsY0FBVUMsTUFIeUI7QUFJbkNaLFdBQU9ZO0FBSjRCLENBQXBCLENBQW5COztBQU9BLElBQU1DLGVBQWUsSUFBSTNCLFNBQVNHLE1BQWIsQ0FBb0I7QUFDckNxQixTQUFLbkIsTUFEZ0M7QUFFckN1QixpQkFBYUYsTUFGd0I7QUFHckNHLGlCQUFhSCxNQUh3QjtBQUlyQ0ksbUJBQWVDLElBSnNCO0FBS3JDQyxrQkFBYyxDQUFDLEVBQUMxQixNQUFLRCxNQUFOLEVBQWFHLEtBQUlILE1BQWpCLEVBQXdCb0IsVUFBU0MsTUFBakMsRUFBd0NaLE9BQU1ZLE1BQTlDLEVBQUQ7QUFDZDtBQU5xQyxDQUFwQixDQUFyQjs7QUFTQSxJQUFNTyxPQUFPakMsU0FBU2tDLEtBQVQsQ0FBZSxPQUFmLEVBQXVCaEMsVUFBdkIsQ0FBYjtBQUNBLElBQU1pQyxVQUFVbkMsU0FBU2tDLEtBQVQsQ0FBZSxVQUFmLEVBQTBCM0IsY0FBMUIsQ0FBaEI7QUFDQSxJQUFNNkIsT0FBT3BDLFNBQVNrQyxLQUFULENBQWUsTUFBZixFQUFzQlgsVUFBdEIsQ0FBYjtBQUNBLElBQU1jLFFBQVFyQyxTQUFTa0MsS0FBVCxDQUFlLFFBQWYsRUFBd0JQLFlBQXhCLENBQWQ7O0FBRUE7QUFDQSxTQUFTVyxVQUFULENBQW9CQyxJQUFwQixFQUF5QmpDLElBQXpCLEVBQThCO0FBQzFCLFFBQUlrQyxVQUFVLElBQUlQLElBQUosQ0FBUztBQUNuQjdCLFlBQUdtQyxJQURnQjtBQUVuQmpDLGNBQUtBO0FBRmMsS0FBVCxDQUFkO0FBSUFrQyxZQUFRQyxJQUFSLEdBQWVDLElBQWYsQ0FBb0I7QUFBQSxlQUFPQyxRQUFRQyxHQUFSLENBQVlDLEdBQVosQ0FBUDtBQUFBLEtBQXBCLEVBQTZDQyxLQUE3QyxDQUFtRDtBQUFBLGVBQU9ILFFBQVFDLEdBQVIsQ0FBWUcsR0FBWixDQUFQO0FBQUEsS0FBbkQ7QUFDSDs7QUFFRCxTQUFTQyxTQUFULENBQW1CVCxJQUFuQixFQUF3QjtBQUNwQixXQUFPTixLQUFLZ0IsSUFBTCxDQUFVLEVBQUMsTUFBS1YsSUFBTixFQUFWLEVBQXVCRyxJQUF2QixDQUE0QixVQUFTUSxJQUFULEVBQWM7QUFDN0MsZUFBT0EsSUFBUDtBQUNILEtBRk0sRUFFSkosS0FGSSxDQUVFLFVBQVNDLEdBQVQsRUFBYTtBQUNsQkosZ0JBQVFDLEdBQVIsQ0FBWUcsR0FBWjtBQUNILEtBSk0sQ0FBUDtBQUtIOztBQUVEO0FBQ0EsZUFBZUksY0FBZixHQUErQjtBQUMzQixRQUFJQyxXQUFXLE1BQU1qQixRQUFRYyxJQUFSLENBQWEsRUFBYixDQUFyQjtBQUNBLFdBQU9HLFFBQVA7QUFDSDs7QUFFRDtBQUNBLFNBQVNDLGlCQUFULENBQTJCQyxTQUEzQixFQUFxQztBQUNqQyxXQUFPbkIsUUFBUWMsSUFBUixDQUFhLEVBQUMsZ0JBQWVLLFNBQWhCLEVBQWIsRUFBeUNaLElBQXpDLENBQThDLFVBQVNVLFFBQVQsRUFBa0I7QUFDbkUsZUFBT0EsUUFBUDtBQUNILEtBRk0sRUFFSk4sS0FGSSxDQUVFLFVBQVNDLEdBQVQsRUFBYTtBQUNsQkosZ0JBQVFDLEdBQVIsQ0FBWUcsR0FBWjtBQUNILEtBSk0sQ0FBUDtBQUtIOztBQUVEO0FBQ0EsU0FBU1EsY0FBVCxDQUF3Qi9DLEdBQXhCLEVBQTRCO0FBQ3hCLFdBQU8yQixRQUFRYyxJQUFSLENBQWEsRUFBQyxPQUFNekMsR0FBUCxFQUFiLEVBQTBCa0MsSUFBMUIsQ0FBK0IsVUFBU2MsSUFBVCxFQUFjO0FBQ2hELGVBQU9BLElBQVA7QUFDSCxLQUZNLEVBRUpWLEtBRkksQ0FFRSxVQUFTQyxHQUFULEVBQWE7QUFDbkJKLGdCQUFRQyxHQUFSLENBQVlHLEdBQVo7QUFDRixLQUpNLENBQVA7QUFLSDs7QUFFRDtBQUNBLFNBQVNVLGVBQVQsQ0FBeUJqRCxHQUF6QixFQUE2QjtBQUN6QixXQUFPMkIsUUFBUWMsSUFBUixDQUFhLEVBQUMsT0FBTXpDLEdBQVAsRUFBYixFQUEwQmtDLElBQTFCLENBQStCLFVBQVNjLElBQVQsRUFBYztBQUNoRCxlQUFPQSxLQUFLLENBQUwsRUFBUTFDLEtBQWY7QUFDSCxLQUZNLEVBRUpnQyxLQUZJLENBRUUsVUFBU0MsR0FBVCxFQUFhO0FBQ25CSixnQkFBUUMsR0FBUixDQUFZRyxHQUFaO0FBQ0YsS0FKTSxDQUFQO0FBS0g7O0FBRUQ7QUFDQSxTQUFTVyxjQUFULENBQXdCbEQsR0FBeEIsRUFBNEI7QUFDeEIsV0FBTzJCLFFBQVFjLElBQVIsQ0FBYSxFQUFDLE9BQU16QyxHQUFQLEVBQWIsRUFBMEJrQyxJQUExQixDQUErQixVQUFTYyxJQUFULEVBQWM7QUFDaEQsZUFBT0EsS0FBSyxDQUFMLEVBQVE5QyxXQUFmO0FBQ0gsS0FGTSxFQUVKb0MsS0FGSSxDQUVFLFVBQVNDLEdBQVQsRUFBYTtBQUNuQkosZ0JBQVFDLEdBQVIsQ0FBWUcsR0FBWjtBQUNGLEtBSk0sQ0FBUDtBQUtIOztBQUVEO0FBQ0EsU0FBU1ksaUJBQVQsQ0FBMkJyRCxJQUEzQixFQUFnQztBQUM1QixXQUFPNkIsUUFBUWMsSUFBUixDQUFhLEVBQUMsU0FBUTNDLElBQVQsRUFBYixFQUE2Qm9DLElBQTdCLENBQWtDLFVBQVNjLElBQVQsRUFBYztBQUNuRCxlQUFPQSxJQUFQO0FBQ0gsS0FGTSxFQUVKVixLQUZJLENBRUUsVUFBU0MsR0FBVCxFQUFhO0FBQ25CSixnQkFBUUMsR0FBUixDQUFZRyxHQUFaO0FBQ0YsS0FKTSxDQUFQO0FBS0g7O0FBRUQ7QUFDQSxTQUFTYSxtQkFBVCxDQUE2QnRELElBQTdCLEVBQWtDdUQsU0FBbEMsRUFBNEM7QUFDeEMsV0FBTzFCLFFBQVFjLElBQVIsQ0FBYSxFQUFDLFNBQVEzQyxJQUFULEVBQWMsV0FBVXVELFNBQXhCLEVBQWIsRUFBaURuQixJQUFqRCxDQUFzRCxVQUFTYyxJQUFULEVBQWM7QUFDdkUsZUFBT0EsSUFBUDtBQUNILEtBRk0sRUFFSlYsS0FGSSxDQUVFLFVBQVNDLEdBQVQsRUFBYTtBQUNuQkosZ0JBQVFDLEdBQVIsQ0FBWUcsR0FBWjtBQUNGLEtBSk0sQ0FBUDtBQUtIOztBQUVEO0FBQ0EsU0FBU2UsU0FBVCxDQUFtQkMsTUFBbkIsRUFBMEJYLFFBQTFCLEVBQW1DM0IsUUFBbkMsRUFBNEM7QUFDeEN1QyxTQUFLQyxLQUFMLENBQVcsaUNBQVgsRUFBNkMsQ0FBQ0YsTUFBRCxDQUE3QyxFQUFzRCxVQUFDRyxLQUFELEVBQVFDLE9BQVIsRUFBbUI7QUFDekUsWUFBSUQsS0FBSixFQUFVO0FBQ04sa0JBQU1BLEtBQU47QUFDSDtBQUNERSxtQkFBV0QsUUFBUUMsUUFBbkI7QUFDQXpCLGdCQUFRQyxHQUFSLENBQVl1QixPQUFaO0FBQ0EsWUFBSUMsWUFBWSxDQUFoQixFQUFrQjtBQUNkQyx1QkFBV04sTUFBWCxFQUFrQlgsUUFBbEIsRUFBMkIzQixRQUEzQjtBQUNILFNBRkQsTUFHSTtBQUNBMkIsd0JBQVllLFFBQVFHLFNBQXBCO0FBQ0E3Qyx3QkFBWTBDLFFBQVFHLFNBQXBCO0FBQ0FDLHVCQUFXUixNQUFYLEVBQWtCWCxRQUFsQixFQUEyQjNCLFFBQTNCO0FBQ0g7QUFBQyxLQWJGO0FBY0g7O0FBRUQ7QUFDQSxTQUFTNEMsVUFBVCxDQUFvQk4sTUFBcEIsRUFBMkJYLFFBQTNCLEVBQW9DM0IsUUFBcEMsRUFBNkM7QUFDekN1QyxTQUFLQyxLQUFMLENBQVcsMkRBQVgsRUFBdUUsQ0FBQ0YsTUFBRCxFQUFRWCxRQUFSLEVBQWlCM0IsUUFBakIsQ0FBdkUsRUFBa0csVUFBQ3lDLEtBQUQsRUFBT00sT0FBUCxFQUFpQjtBQUMvRyxZQUFJTixLQUFKLEVBQVU7QUFDTixrQkFBTUEsS0FBTjtBQUNIO0FBQ0R2QixnQkFBUUMsR0FBUixDQUFZdUIsUUFBUU0sUUFBcEI7QUFDSCxLQUxEO0FBTUg7O0FBRUQ7QUFDQSxTQUFTRixVQUFULENBQW9CUixNQUFwQixFQUEyQlgsUUFBM0IsRUFBb0MzQixRQUFwQyxFQUE2QztBQUN6Q3VDLFNBQUtDLEtBQUwsQ0FBVyx1REFBWCxFQUFtRSxDQUFDYixRQUFELEVBQVUzQixRQUFWLEVBQW1Cc0MsTUFBbkIsQ0FBbkUsRUFBOEYsVUFBQ0csS0FBRCxFQUFPQyxPQUFQLEVBQWtCO0FBQzVHLFlBQUlELEtBQUosRUFBVTtBQUNOLGtCQUFNQSxLQUFOO0FBQ0g7QUFDRHZCLGdCQUFRQyxHQUFSLENBQVl1QixRQUFRTSxRQUFwQjtBQUNILEtBTEQ7QUFNSDs7UUFFUXRCLGMsR0FBQUEsYztRQUFnQkUsaUIsR0FBQUEsaUI7UUFBbUJFLGMsR0FBQUEsYztRQUFnQkUsZSxHQUFBQSxlO1FBQWlCQyxjLEdBQUFBLGM7UUFBZ0JDLGlCLEdBQUFBLGlCO1FBQW1CQyxtQixHQUFBQSxtQjtRQUFxQlosUyxHQUFBQSxTO1FBQVdWLFUsR0FBQUEsVSIsImZpbGUiOiJEQkNvbm4uanMiLCJzb3VyY2VSb290IjoiL2FwcCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcblxuY29uc3QgdXNlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgIGlkOiBTdHJpbmcsXG4gICAgbmFtZTogU3RyaW5nXG59KTtcblxuY29uc3QgcHJvZHVjdHNTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgICBpZDogU3RyaW5nLFxuICAgIHBpZDogU3RyaW5nLFxuICAgIHRpdGxlOiBTdHJpbmcsXG4gICAgZGVzY3JpcHRpb246IFN0cmluZyxcbiAgICBhdmFpbGFiaWxpdHk6IFN0cmluZyxcbiAgICBpbnZlbnRvcnk6IFN0cmluZyxcbiAgICBjb25kaXRpb246IFN0cmluZyxcbiAgICBwcmljZTogU3RyaW5nLFxuICAgIGxpbms6IFN0cmluZyxcbiAgICBpbWFnZV9saW5rOiBTdHJpbmcsXG4gICAgYnJhbmQ6IFN0cmluZyxcbiAgICBpdGVtX2dyb3VwX2lkOiBTdHJpbmcsXG4gICAgY29sb3I6IFN0cmluZyxcbiAgICBwYXR0ZXJuOiBTdHJpbmcsXG4gICAgcHJvZHVjdF90eXBlOiBTdHJpbmcsXG4gICAgYWxsZXJnZW5zOiBTdHJpbmdcbn0pO1xuXG5jb25zdCBjYXJ0U2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgdWlkOiBTdHJpbmcsXG4gICAgcGlkOiBTdHJpbmcsXG4gICAgcXVhbnRpdHk6IE51bWJlcixcbiAgICBwcmljZTogTnVtYmVyXG59KVxuXG5jb25zdCBvcmRlcnNTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgICB1aWQ6IFN0cmluZyxcbiAgICB0cmFja2luZ051bTogTnVtYmVyLFxuICAgIG9yZGVyU3RhdHVzOiBOdW1iZXIsXG4gICAgb3JkZXJEYXRlVGltZTogRGF0ZSxcbiAgICBvcmRlckRldGFpbHM6IFt7bmFtZTpTdHJpbmcscGlkOlN0cmluZyxxdWFudGl0eTpOdW1iZXIscHJpY2U6TnVtYmVyfV0gXG4gICAgLy8gQXJlIHdlIGFibGUgdG8gZmluZCBhIHdheSB0byB1c2UgRG91YmxlL0Zsb2F0IGZvciBkYXRhdHlwZXM/XG59KVxuXG5jb25zdCBVc2VyID0gbW9uZ29vc2UubW9kZWwoJ3VzZXJzJyx1c2VyU2NoZW1hKTtcbmNvbnN0IFByb2R1Y3QgPSBtb25nb29zZS5tb2RlbCgncHJvZHVjdHMnLHByb2R1Y3RzU2NoZW1hKTtcbmNvbnN0IENhcnQgPSBtb25nb29zZS5tb2RlbCgnY2FydCcsY2FydFNjaGVtYSk7XG5jb25zdCBPcmRlciA9IG1vbmdvb3NlLm1vZGVsKCdvcmRlcnMnLG9yZGVyc1NjaGVtYSk7XG5cbi8vIENyZWF0ZSB1c2VyIGlmIHVzZXIgbm90IGZvdW5kIGluIGRhdGFiYXNlXG5mdW5jdGlvbiBjcmVhdGVVc2VyKGZiaWQsbmFtZSl7XG4gICAgdmFyIG5ld1VzZXIgPSBuZXcgVXNlcih7XG4gICAgICAgIGlkOmZiaWQsXG4gICAgICAgIG5hbWU6bmFtZVxuICAgIH0pO1xuICAgIG5ld1VzZXIuc2F2ZSgpLnRoZW4oZG9jID0+IGNvbnNvbGUubG9nKGRvYykpLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKTtcbn1cblxuZnVuY3Rpb24gY2hlY2tVc2VyKGZiaWQpe1xuICAgIHJldHVybiBVc2VyLmZpbmQoeydpZCc6ZmJpZH0pLnRoZW4oZnVuY3Rpb24odXNlcil7XG4gICAgICAgIHJldHVybiB1c2VyO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgfSk7XG59XG5cbi8vR2V0IGFsbCBwcm9kdWN0c1xuYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUHJvZHVjdHMoKXtcbiAgICBsZXQgcHJvZHVjdHMgPSBhd2FpdCBQcm9kdWN0LmZpbmQoe30pO1xuICAgIHJldHVybiBwcm9kdWN0cztcbn1cblxuLy9HZXQgcHJvZHVjdCBieSB0eXBlXG5mdW5jdGlvbiBnZXRQcm9kdWN0c0J5VHlwZSh0eXBlVmFsdWUpe1xuICAgIHJldHVybiBQcm9kdWN0LmZpbmQoeydwcm9kdWN0X3R5cGUnOnR5cGVWYWx1ZX0pLnRoZW4oZnVuY3Rpb24ocHJvZHVjdHMpe1xuICAgICAgICByZXR1cm4gcHJvZHVjdHM7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KTtcbn1cblxuLy9HZXQgcHJvZHVjdCBieSBJRFxuZnVuY3Rpb24gZ2V0UHJvZHVjdEJ5SUQocGlkKXtcbiAgICByZXR1cm4gUHJvZHVjdC5maW5kKHsncGlkJzpwaWR9KS50aGVuKGZ1bmN0aW9uKHByb2Qpe1xuICAgICAgICByZXR1cm4gcHJvZDtcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgIGNvbnNvbGUubG9nKGVycikgXG4gICAgfSk7XG59XG5cbi8vIEdldCBwcm9kdWN0IFByaWNlIGJ5IElEXG5mdW5jdGlvbiBnZXRQcm9kdWN0UHJpY2UocGlkKXtcbiAgICByZXR1cm4gUHJvZHVjdC5maW5kKHsncGlkJzpwaWR9KS50aGVuKGZ1bmN0aW9uKHByb2Qpe1xuICAgICAgICByZXR1cm4gcHJvZFswXS5wcmljZTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgIGNvbnNvbGUubG9nKGVycikgXG4gICAgfSk7XG59XG5cbi8vIGdldCBwcm9kdWN0IERlc2MgYnkgSURcbmZ1bmN0aW9uIGdldFByb2R1Y3REZXNjKHBpZCl7XG4gICAgcmV0dXJuIFByb2R1Y3QuZmluZCh7J3BpZCc6cGlkfSkudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgcmV0dXJuIHByb2RbMF0uZGVzY3JpcHRpb247XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICBjb25zb2xlLmxvZyhlcnIpIFxuICAgIH0pO1xufVxuXG4vLyBnZXQgcHJvZHVjdHMgd2l0aCBhbGwgdGhlIGRpZmZlcm50IHZhcmlhdGlvbnMgYnkgTmFtZVxuZnVuY3Rpb24gZ2V0UHJvZHVjdHNCeU5hbWUobmFtZSl7XG4gICAgcmV0dXJuIFByb2R1Y3QuZmluZCh7J3RpdGxlJzpuYW1lfSkudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgcmV0dXJuIHByb2Q7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICBjb25zb2xlLmxvZyhlcnIpIFxuICAgIH0pO1xufVxuXG4vLyBnZXQgcHJvZHVjdCBieSBuYW1lIGFuZCB2YXJpYXRpb25cbmZ1bmN0aW9uIGdldFByb2R1Y3RCeU5hbWVWYXIobmFtZSx2YXJpYXRpb24pe1xuICAgIHJldHVybiBQcm9kdWN0LmZpbmQoeyd0aXRsZSc6bmFtZSwncGF0dGVybic6dmFyaWF0aW9ufSkudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgcmV0dXJuIHByb2Q7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICBjb25zb2xlLmxvZyhlcnIpIFxuICAgIH0pO1xufVxuXG4vL0NoZWNrIGlmIHVzZXIgaGFzIGFuIGFjdGl2ZSBzaG9wcGluZyBjYXJ0XG5mdW5jdGlvbiBjaGVja0NhcnQodXNlcklELHByb2R1Y3RzLHF1YW50aXR5KXtcbiAgICBwb29sLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGNhcnQgd2hlcmUgdWlkPSQxJyxbdXNlcklEXSwoZXJyb3IsIHJlc3VsdHMpID0+e1xuICAgIGlmIChlcnJvcil7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgICByb3dDb3VudCA9IHJlc3VsdHMucm93Q291bnQ7XG4gICAgY29uc29sZS5sb2cocmVzdWx0cylcbiAgICBpZiAocm93Q291bnQgPT0gMCl7XG4gICAgICAgIGNyZWF0ZUNhcnQodXNlcklELHByb2R1Y3RzLHF1YW50aXR5KTtcbiAgICB9XG4gICAgZWxzZXtcbiAgICAgICAgcHJvZHVjdHMgKz0gcmVzdWx0cy5zb21ldGhpbmc7XG4gICAgICAgIHF1YW50aXR5ICs9IHJlc3VsdHMuc29tZXRoaW5nO1xuICAgICAgICB1cGRhdGVDYXJ0KHVzZXJJRCxwcm9kdWN0cyxxdWFudGl0eSk7XG4gICAgfX0pXG59XG5cbi8vIEluaXRpYWwgY3JlYXRpb24gb2YgYSBmcmVzaCBjYXJ0XG5mdW5jdGlvbiBjcmVhdGVDYXJ0KHVzZXJJRCxwcm9kdWN0cyxxdWFudGl0eSl7XG4gICAgcG9vbC5xdWVyeSgnSU5TRVJUIElOVE8gY2FydCh1aWQscHJvZHVjdHMscXVhbnRpdHkpIFZBTFVFUyAoJDEsJDIsJDMpJyxbdXNlcklELHByb2R1Y3RzLHF1YW50aXR5XSwoZXJyb3IscmV1c2x0cyk9PntcbiAgICAgICAgaWYgKGVycm9yKXtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMuaW5zZXJ0SWQpO1xuICAgIH0pXG59XG5cbi8vIFVwZGF0ZSBjYXJ0IGlmIHVzZXIgaGFzIGFuIGFjdGl2ZSBjYXJ0XG5mdW5jdGlvbiB1cGRhdGVDYXJ0KHVzZXJJRCxwcm9kdWN0cyxxdWFudGl0eSl7XG4gICAgcG9vbC5xdWVyeSgnVVBEQVRFIGNhcnQgU0VUIHByb2R1Y3RzPSQxLCBxdWFudGl0eT0kMiBXSEVSRSB1aWQ9JDMnLFtwcm9kdWN0cyxxdWFudGl0eSx1c2VySURdLChlcnJvcixyZXN1bHRzKT0+IHtcbiAgICAgICAgaWYgKGVycm9yKXtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMuaW5zZXJ0SWQpO1xuICAgIH0pXG59XG5cbmV4cG9ydCB7IGdldEFsbFByb2R1Y3RzLCBnZXRQcm9kdWN0c0J5VHlwZSwgZ2V0UHJvZHVjdEJ5SUQsIGdldFByb2R1Y3RQcmljZSwgZ2V0UHJvZHVjdERlc2MsIGdldFByb2R1Y3RzQnlOYW1lLCBnZXRQcm9kdWN0QnlOYW1lVmFyLCBjaGVja1VzZXIsIGNyZWF0ZVVzZXIgfTtcbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "DBConn.js"
      ],
      "names": [
        "mongoose",
        "require",
        "userSchema",
        "Schema",
        "id",
        "String",
        "name",
        "productsSchema",
        "pid",
        "title",
        "description",
        "availability",
        "inventory",
        "condition",
        "price",
        "link",
        "image_link",
        "brand",
        "item_group_id",
        "color",
        "pattern",
        "product_type",
        "allergens",
        "cartSchema",
        "uid",
        "quantity",
        "Number",
        "ordersSchema",
        "trackingNum",
        "orderStatus",
        "orderDateTime",
        "Date",
        "orderDetails",
        "User",
        "model",
        "Product",
        "Cart",
        "Order",
        "createUser",
        "fbid",
        "newUser",
        "save",
        "then",
        "console",
        "log",
        "doc",
        "catch",
        "err",
        "checkUser",
        "find",
        "user",
        "getAllProducts",
        "products",
        "getProductsByType",
        "typeValue",
        "getProductByID",
        "prod",
        "getProductPrice",
        "getProductDesc",
        "getProductsByName",
        "getProductByNameVar",
        "variation",
        "checkCart",
        "userID",
        "pool",
        "query",
        "error",
        "results",
        "rowCount",
        "createCart",
        "something",
        "updateCart",
        "reuslts",
        "insertId"
      ],
      "mappings": "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",
      "file": "DBConn.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "const mongoose = require('mongoose');\n\nconst userSchema = new mongoose.Schema({\n    id: String,\n    name: String\n});\n\nconst productsSchema = new mongoose.Schema({\n    id: String,\n    pid: String,\n    title: String,\n    description: String,\n    availability: String,\n    inventory: String,\n    condition: String,\n    price: String,\n    link: String,\n    image_link: String,\n    brand: String,\n    item_group_id: String,\n    color: String,\n    pattern: String,\n    product_type: String,\n    allergens: String\n});\n\nconst cartSchema = new mongoose.Schema({\n    uid: String,\n    pid: String,\n    quantity: Number,\n    price: Number\n})\n\nconst ordersSchema = new mongoose.Schema({\n    uid: String,\n    trackingNum: Number,\n    orderStatus: Number,\n    orderDateTime: Date,\n    orderDetails: [{name:String,pid:String,quantity:Number,price:Number}] \n    // Are we able to find a way to use Double/Float for datatypes?\n})\n\nconst User = mongoose.model('users',userSchema);\nconst Product = mongoose.model('products',productsSchema);\nconst Cart = mongoose.model('cart',cartSchema);\nconst Order = mongoose.model('orders',ordersSchema);\n\n// Create user if user not found in database\nfunction createUser(fbid,name){\n    var newUser = new User({\n        id:fbid,\n        name:name\n    });\n    newUser.save().then(doc => console.log(doc)).catch(err => console.log(err));\n}\n\nfunction checkUser(fbid){\n    return User.find({'id':fbid}).then(function(user){\n        return user;\n    }).catch(function(err){\n        console.log(err);\n    });\n}\n\n//Get all products\nasync function getAllProducts(){\n    let products = await Product.find({});\n    return products;\n}\n\n//Get product by type\nfunction getProductsByType(typeValue){\n    return Product.find({'product_type':typeValue}).then(function(products){\n        return products;\n    }).catch(function(err){\n        console.log(err);\n    });\n}\n\n//Get product by ID\nfunction getProductByID(pid){\n    return Product.find({'pid':pid}).then(function(prod){\n        return prod;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// Get product Price by ID\nfunction getProductPrice(pid){\n    return Product.find({'pid':pid}).then(function(prod){\n        return prod[0].price;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// get product Desc by ID\nfunction getProductDesc(pid){\n    return Product.find({'pid':pid}).then(function(prod){\n        return prod[0].description;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// get products with all the differnt variations by Name\nfunction getProductsByName(name){\n    return Product.find({'title':name}).then(function(prod){\n        return prod;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// get product by name and variation\nfunction getProductByNameVar(name,variation){\n    return Product.find({'title':name,'pattern':variation}).then(function(prod){\n        return prod;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n//Check if user has an active shopping cart\nfunction checkCart(userID,products,quantity){\n    pool.query('SELECT * FROM cart where uid=$1',[userID],(error, results) =>{\n    if (error){\n        throw error;\n    }\n    rowCount = results.rowCount;\n    console.log(results)\n    if (rowCount == 0){\n        createCart(userID,products,quantity);\n    }\n    else{\n        products += results.something;\n        quantity += results.something;\n        updateCart(userID,products,quantity);\n    }})\n}\n\n// Initial creation of a fresh cart\nfunction createCart(userID,products,quantity){\n    pool.query('INSERT INTO cart(uid,products,quantity) VALUES ($1,$2,$3)',[userID,products,quantity],(error,reuslts)=>{\n        if (error){\n            throw error;\n        }\n        console.log(results.insertId);\n    })\n}\n\n// Update cart if user has an active cart\nfunction updateCart(userID,products,quantity){\n    pool.query('UPDATE cart SET products=$1, quantity=$2 WHERE uid=$3',[products,quantity,userID],(error,results)=> {\n        if (error){\n            throw error;\n        }\n        console.log(results.insertId);\n    })\n}\n\nexport { getAllProducts, getProductsByType, getProductByID, getProductPrice, getProductDesc, getProductsByName, getProductByNameVar, checkUser, createUser };\n"
      ]
    },
    "mtime": 1592494609000
  },
  "{\"filename\":\"/app/fbhelper.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [
            "getName",
            "getAllProducts",
            "getProductDetails"
          ],
          "specifiers": [
            {
              "kind": "local",
              "local": "getName",
              "exported": "getName"
            },
            {
              "kind": "local",
              "local": "getAllProducts",
              "exported": "getAllProducts"
            },
            {
              "kind": "local",
              "local": "getProductDetails",
              "exported": "getProductDetails"
            }
          ]
        }
      }
    },
    "options": {
      "filename": "/app/fbhelper.js",
      "filenameRelative": "/app/fbhelper.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "fbhelper.js",
      "sourceFileName": "fbhelper.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "fbhelper"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n//Gets users name from facebook graph api\nvar request = require(\"request\");\nvar CATLOG_ID = process.env.CATLOG_ID;\nvar fields = \"currency,availability,condition,id,inventory,image_url,name,price,retailer_id,retailer_product_group_id,description,custom_label_0,pattern,product_type,color,url,product_group\";\nvar uri = \"https://graph.facebook.com/v7.0/\";\n\nfunction getName(PAGE_ACCESS_TOKEN, sender_psid, callback) {\n    var name = \"Empty\";\n    request({\n        url: uri + sender_psid,\n        qs: {\n            access_token: PAGE_ACCESS_TOKEN,\n            fields: \"first_name\"\n        },\n        method: \"GET\"\n    }, function (error, response, body) {\n        if (error) {\n            console.log(error);\n        } else {\n            var bodyObj = JSON.parse(body);\n            name = bodyObj.first_name;\n            console.log(\"Name: \" + name);\n            return callback(name);\n        }\n    });\n    return name;\n}\n\n//Get all products with their ID from Facebook\nfunction getAllProducts(PAGE_ACCESS_TOKEN, appsecret_proof) {\n    request({\n        url: uri + CATLOG_ID,\n        qs: {\n            access_token: PAGE_ACCESS_TOKEN,\n            appsecret_proof: appsecret_proof\n        },\n        method: \"GET\"\n    }, function (error, response, body) {\n        if (error) {\n            console.log(error);\n        } else {\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj);\n        }\n    });\n}\n\n//Gets product details from Facebook\nfunction getProductDetails(productID, callback) {\n    request({\n        url: uri + productID,\n        qs: {\n            access_token: PAGE_ACCESS_TOKEN,\n            fields: reqFields\n        },\n        method: \"GET\"\n    }, function (error, response, body) {\n        if (error) {\n            console.log(error);\n        } else {\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj);\n            return callback(bodyObj);\n        }\n    });\n}\n\nexports.getName = getName;\nexports.getAllProducts = getAllProducts;\nexports.getProductDetails = getProductDetails;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZiaGVscGVyLmpzIl0sIm5hbWVzIjpbInJlcXVlc3QiLCJyZXF1aXJlIiwiQ0FUTE9HX0lEIiwicHJvY2VzcyIsImVudiIsImZpZWxkcyIsInVyaSIsImdldE5hbWUiLCJQQUdFX0FDQ0VTU19UT0tFTiIsInNlbmRlcl9wc2lkIiwiY2FsbGJhY2siLCJuYW1lIiwidXJsIiwicXMiLCJhY2Nlc3NfdG9rZW4iLCJtZXRob2QiLCJlcnJvciIsInJlc3BvbnNlIiwiYm9keSIsImNvbnNvbGUiLCJsb2ciLCJib2R5T2JqIiwiSlNPTiIsInBhcnNlIiwiZmlyc3RfbmFtZSIsImdldEFsbFByb2R1Y3RzIiwiYXBwc2VjcmV0X3Byb29mIiwiZ2V0UHJvZHVjdERldGFpbHMiLCJwcm9kdWN0SUQiLCJyZXFGaWVsZHMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQSxJQUFNQSxVQUFVQyxRQUFRLFNBQVIsQ0FBaEI7QUFDQSxJQUFNQyxZQUFZQyxRQUFRQyxHQUFSLENBQVlGLFNBQTlCO0FBQ0EsSUFBTUcsU0FBUyxpTEFBZjtBQUNBLElBQU1DLE1BQU0sa0NBQVo7O0FBRUEsU0FBU0MsT0FBVCxDQUFpQkMsaUJBQWpCLEVBQW1DQyxXQUFuQyxFQUErQ0MsUUFBL0MsRUFBd0Q7QUFDcEQsUUFBSUMsT0FBTyxPQUFYO0FBQ0FYLFlBQVE7QUFDSlksYUFBSU4sTUFBTUcsV0FETjtBQUVKSSxZQUFHO0FBQ0NDLDBCQUFjTixpQkFEZjtBQUVDSCxvQkFBUTtBQUZULFNBRkM7QUFNSlUsZ0JBQU87QUFOSCxLQUFSLEVBT0csVUFBU0MsS0FBVCxFQUFlQyxRQUFmLEVBQXdCQyxJQUF4QixFQUE2QjtBQUM1QixZQUFJRixLQUFKLEVBQVU7QUFDTkcsb0JBQVFDLEdBQVIsQ0FBWUosS0FBWjtBQUNILFNBRkQsTUFFSztBQUNELGdCQUFJSyxVQUFVQyxLQUFLQyxLQUFMLENBQVdMLElBQVgsQ0FBZDtBQUNBUCxtQkFBT1UsUUFBUUcsVUFBZjtBQUNBTCxvQkFBUUMsR0FBUixDQUFZLFdBQVdULElBQXZCO0FBQ0EsbUJBQU9ELFNBQVNDLElBQVQsQ0FBUDtBQUNIO0FBQ0osS0FoQkQ7QUFpQkEsV0FBT0EsSUFBUDtBQUNIOztBQUVEO0FBQ0EsU0FBU2MsY0FBVCxDQUF3QmpCLGlCQUF4QixFQUEwQ2tCLGVBQTFDLEVBQTBEO0FBQ3REMUIsWUFBUTtBQUNKWSxhQUFLTixNQUFNSixTQURQO0FBRUpXLFlBQUc7QUFDQ0MsMEJBQWNOLGlCQURmO0FBRUNrQiw2QkFBaUJBO0FBRmxCLFNBRkM7QUFNSlgsZ0JBQU87QUFOSCxLQUFSLEVBT0csVUFBU0MsS0FBVCxFQUFlQyxRQUFmLEVBQXdCQyxJQUF4QixFQUE2QjtBQUM1QixZQUFJRixLQUFKLEVBQVU7QUFDTkcsb0JBQVFDLEdBQVIsQ0FBWUosS0FBWjtBQUNILFNBRkQsTUFFSztBQUNELGdCQUFJSyxVQUFVQyxLQUFLQyxLQUFMLENBQVdMLElBQVgsQ0FBZDtBQUNBQyxvQkFBUUMsR0FBUixDQUFZQyxPQUFaO0FBQ0g7QUFDSixLQWREO0FBZUg7O0FBR0Q7QUFDQSxTQUFTTSxpQkFBVCxDQUEyQkMsU0FBM0IsRUFBcUNsQixRQUFyQyxFQUE4QztBQUMxQ1YsWUFBUTtBQUNKWSxhQUFJTixNQUFNc0IsU0FETjtBQUVKZixZQUFHO0FBQ0NDLDBCQUFjTixpQkFEZjtBQUVDSCxvQkFBT3dCO0FBRlIsU0FGQztBQU1KZCxnQkFBTztBQU5ILEtBQVIsRUFPRyxVQUFTQyxLQUFULEVBQWVDLFFBQWYsRUFBd0JDLElBQXhCLEVBQTZCO0FBQ2hDLFlBQUlGLEtBQUosRUFBVTtBQUNGRyxvQkFBUUMsR0FBUixDQUFZSixLQUFaO0FBQ0gsU0FGTCxNQUVTO0FBQ0QsZ0JBQUlLLFVBQVVDLEtBQUtDLEtBQUwsQ0FBV0wsSUFBWCxDQUFkO0FBQ0FDLG9CQUFRQyxHQUFSLENBQVlDLE9BQVo7QUFDQSxtQkFBT1gsU0FBU1csT0FBVCxDQUFQO0FBQ0g7QUFDSixLQWZEO0FBZ0JIOztRQUlRZCxPLEdBQUFBLE87UUFBU2tCLGMsR0FBQUEsYztRQUFnQkUsaUIsR0FBQUEsaUIiLCJmaWxlIjoiZmJoZWxwZXIuanMiLCJzb3VyY2VSb290IjoiL2FwcCIsInNvdXJjZXNDb250ZW50IjpbIi8vR2V0cyB1c2VycyBuYW1lIGZyb20gZmFjZWJvb2sgZ3JhcGggYXBpXG5jb25zdCByZXF1ZXN0ID0gcmVxdWlyZShcInJlcXVlc3RcIik7XG5jb25zdCBDQVRMT0dfSUQgPSBwcm9jZXNzLmVudi5DQVRMT0dfSUQ7XG5jb25zdCBmaWVsZHMgPSBcImN1cnJlbmN5LGF2YWlsYWJpbGl0eSxjb25kaXRpb24saWQsaW52ZW50b3J5LGltYWdlX3VybCxuYW1lLHByaWNlLHJldGFpbGVyX2lkLHJldGFpbGVyX3Byb2R1Y3RfZ3JvdXBfaWQsZGVzY3JpcHRpb24sY3VzdG9tX2xhYmVsXzAscGF0dGVybixwcm9kdWN0X3R5cGUsY29sb3IsdXJsLHByb2R1Y3RfZ3JvdXBcIjtcbmNvbnN0IHVyaSA9IFwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjcuMC9cIlxuXG5mdW5jdGlvbiBnZXROYW1lKFBBR0VfQUNDRVNTX1RPS0VOLHNlbmRlcl9wc2lkLGNhbGxiYWNrKXtcbiAgICB2YXIgbmFtZSA9IFwiRW1wdHlcIjtcbiAgICByZXF1ZXN0KHtcbiAgICAgICAgdXJsOnVyaSArIHNlbmRlcl9wc2lkLFxuICAgICAgICBxczp7XG4gICAgICAgICAgICBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOLFxuICAgICAgICAgICAgZmllbGRzOiBcImZpcnN0X25hbWVcIixcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOlwiR0VUXCJcbiAgICB9LCBmdW5jdGlvbihlcnJvcixyZXNwb25zZSxib2R5KXtcbiAgICAgICAgaWYgKGVycm9yKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHZhciBib2R5T2JqID0gSlNPTi5wYXJzZShib2R5KTtcbiAgICAgICAgICAgIG5hbWUgPSBib2R5T2JqLmZpcnN0X25hbWU7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk5hbWU6IFwiICsgbmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmFtZSlcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBuYW1lO1xufVxuXG4vL0dldCBhbGwgcHJvZHVjdHMgd2l0aCB0aGVpciBJRCBmcm9tIEZhY2Vib29rXG5mdW5jdGlvbiBnZXRBbGxQcm9kdWN0cyhQQUdFX0FDQ0VTU19UT0tFTixhcHBzZWNyZXRfcHJvb2Ype1xuICAgIHJlcXVlc3Qoe1xuICAgICAgICB1cmw6IHVyaSArIENBVExPR19JRCxcbiAgICAgICAgcXM6e1xuICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiBQQUdFX0FDQ0VTU19UT0tFTixcbiAgICAgICAgICAgIGFwcHNlY3JldF9wcm9vZjogYXBwc2VjcmV0X3Byb29mXG4gICAgICAgIH0sXG4gICAgICAgIG1ldGhvZDpcIkdFVFwiXG4gICAgfSwgZnVuY3Rpb24oZXJyb3IscmVzcG9uc2UsYm9keSl7XG4gICAgICAgIGlmIChlcnJvcil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB2YXIgYm9keU9iaiA9IEpTT04ucGFyc2UoYm9keSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhib2R5T2JqKVxuICAgICAgICB9XG4gICAgfSk7XG59XG5cblxuLy9HZXRzIHByb2R1Y3QgZGV0YWlscyBmcm9tIEZhY2Vib29rXG5mdW5jdGlvbiBnZXRQcm9kdWN0RGV0YWlscyhwcm9kdWN0SUQsY2FsbGJhY2spe1xuICAgIHJlcXVlc3Qoe1xuICAgICAgICB1cmw6dXJpICsgcHJvZHVjdElELFxuICAgICAgICBxczp7XG4gICAgICAgICAgICBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOLFxuICAgICAgICAgICAgZmllbGRzOnJlcUZpZWxkcyxcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOlwiR0VUXCJcbiAgICB9LCBmdW5jdGlvbihlcnJvcixyZXNwb25zZSxib2R5KXtcbiAgICBpZiAoZXJyb3Ipe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIGJvZHlPYmogPSBKU09OLnBhcnNlKGJvZHkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYm9keU9iailcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhib2R5T2JqKVxuICAgICAgICB9XG4gICAgfSk7XG59XG5cblxuXG5leHBvcnQgeyBnZXROYW1lLCBnZXRBbGxQcm9kdWN0cywgZ2V0UHJvZHVjdERldGFpbHMgfTsiXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "fbhelper.js"
      ],
      "names": [
        "request",
        "require",
        "CATLOG_ID",
        "process",
        "env",
        "fields",
        "uri",
        "getName",
        "PAGE_ACCESS_TOKEN",
        "sender_psid",
        "callback",
        "name",
        "url",
        "qs",
        "access_token",
        "method",
        "error",
        "response",
        "body",
        "console",
        "log",
        "bodyObj",
        "JSON",
        "parse",
        "first_name",
        "getAllProducts",
        "appsecret_proof",
        "getProductDetails",
        "productID",
        "reqFields"
      ],
      "mappings": ";;;;;AAAA;AACA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,YAAYC,QAAQC,GAAR,CAAYF,SAA9B;AACA,IAAMG,SAAS,iLAAf;AACA,IAAMC,MAAM,kCAAZ;;AAEA,SAASC,OAAT,CAAiBC,iBAAjB,EAAmCC,WAAnC,EAA+CC,QAA/C,EAAwD;AACpD,QAAIC,OAAO,OAAX;AACAX,YAAQ;AACJY,aAAIN,MAAMG,WADN;AAEJI,YAAG;AACCC,0BAAcN,iBADf;AAECH,oBAAQ;AAFT,SAFC;AAMJU,gBAAO;AANH,KAAR,EAOG,UAASC,KAAT,EAAeC,QAAf,EAAwBC,IAAxB,EAA6B;AAC5B,YAAIF,KAAJ,EAAU;AACNG,oBAAQC,GAAR,CAAYJ,KAAZ;AACH,SAFD,MAEK;AACD,gBAAIK,UAAUC,KAAKC,KAAL,CAAWL,IAAX,CAAd;AACAP,mBAAOU,QAAQG,UAAf;AACAL,oBAAQC,GAAR,CAAY,WAAWT,IAAvB;AACA,mBAAOD,SAASC,IAAT,CAAP;AACH;AACJ,KAhBD;AAiBA,WAAOA,IAAP;AACH;;AAED;AACA,SAASc,cAAT,CAAwBjB,iBAAxB,EAA0CkB,eAA1C,EAA0D;AACtD1B,YAAQ;AACJY,aAAKN,MAAMJ,SADP;AAEJW,YAAG;AACCC,0BAAcN,iBADf;AAECkB,6BAAiBA;AAFlB,SAFC;AAMJX,gBAAO;AANH,KAAR,EAOG,UAASC,KAAT,EAAeC,QAAf,EAAwBC,IAAxB,EAA6B;AAC5B,YAAIF,KAAJ,EAAU;AACNG,oBAAQC,GAAR,CAAYJ,KAAZ;AACH,SAFD,MAEK;AACD,gBAAIK,UAAUC,KAAKC,KAAL,CAAWL,IAAX,CAAd;AACAC,oBAAQC,GAAR,CAAYC,OAAZ;AACH;AACJ,KAdD;AAeH;;AAGD;AACA,SAASM,iBAAT,CAA2BC,SAA3B,EAAqClB,QAArC,EAA8C;AAC1CV,YAAQ;AACJY,aAAIN,MAAMsB,SADN;AAEJf,YAAG;AACCC,0BAAcN,iBADf;AAECH,oBAAOwB;AAFR,SAFC;AAMJd,gBAAO;AANH,KAAR,EAOG,UAASC,KAAT,EAAeC,QAAf,EAAwBC,IAAxB,EAA6B;AAChC,YAAIF,KAAJ,EAAU;AACFG,oBAAQC,GAAR,CAAYJ,KAAZ;AACH,SAFL,MAES;AACD,gBAAIK,UAAUC,KAAKC,KAAL,CAAWL,IAAX,CAAd;AACAC,oBAAQC,GAAR,CAAYC,OAAZ;AACA,mBAAOX,SAASW,OAAT,CAAP;AACH;AACJ,KAfD;AAgBH;;QAIQd,O,GAAAA,O;QAASkB,c,GAAAA,c;QAAgBE,iB,GAAAA,iB",
      "file": "fbhelper.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "//Gets users name from facebook graph api\nconst request = require(\"request\");\nconst CATLOG_ID = process.env.CATLOG_ID;\nconst fields = \"currency,availability,condition,id,inventory,image_url,name,price,retailer_id,retailer_product_group_id,description,custom_label_0,pattern,product_type,color,url,product_group\";\nconst uri = \"https://graph.facebook.com/v7.0/\"\n\nfunction getName(PAGE_ACCESS_TOKEN,sender_psid,callback){\n    var name = \"Empty\";\n    request({\n        url:uri + sender_psid,\n        qs:{\n            access_token: PAGE_ACCESS_TOKEN,\n            fields: \"first_name\",\n        },\n        method:\"GET\"\n    }, function(error,response,body){\n        if (error){\n            console.log(error)\n        }else{\n            var bodyObj = JSON.parse(body);\n            name = bodyObj.first_name;\n            console.log(\"Name: \" + name);\n            return callback(name)\n        }\n    });\n    return name;\n}\n\n//Get all products with their ID from Facebook\nfunction getAllProducts(PAGE_ACCESS_TOKEN,appsecret_proof){\n    request({\n        url: uri + CATLOG_ID,\n        qs:{\n            access_token: PAGE_ACCESS_TOKEN,\n            appsecret_proof: appsecret_proof\n        },\n        method:\"GET\"\n    }, function(error,response,body){\n        if (error){\n            console.log(error)\n        }else{\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj)\n        }\n    });\n}\n\n\n//Gets product details from Facebook\nfunction getProductDetails(productID,callback){\n    request({\n        url:uri + productID,\n        qs:{\n            access_token: PAGE_ACCESS_TOKEN,\n            fields:reqFields,\n        },\n        method:\"GET\"\n    }, function(error,response,body){\n    if (error){\n            console.log(error)\n        }else{\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj)\n            return callback(bodyObj)\n        }\n    });\n}\n\n\n\nexport { getName, getAllProducts, getProductDetails };"
      ]
    },
    "mtime": 1592484869000
  }
}
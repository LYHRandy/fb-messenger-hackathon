{
  "{\"filename\":\"/app/index.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/index.js",
      "filenameRelative": "/app/index.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "index.js",
      "sourceFileName": "index.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "index"
    },
    "ignored": false,
    "code": "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\n\nvar express = require(\"express\"),\n    bodyParser = require(\"body-parser\"),\n    app = express().use(bodyParser.json()); // creates express http server\nvar request = require(\"request\");\n\n// import { checkUser, createUser } from './DBConn';\n\n// Get page access token\nvar PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Sets server port and logs message on success\napp.listen(3000, function () {\n  return console.log(\"webhook is listening\");\n});\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", function (req, res) {\n  var VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  var mode = req.query[\"hub.mode\"];\n  var token = req.query[\"hub.verify_token\"];\n  var challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", function (req, res) {\n  var body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function (entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      var webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      var sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        // getName(sender_psid, function(response){\n        //     checkUser(sender_psid,response);\n        // });\n        if (webhook_event.message.quick_reply) {\n          handlePostback(sender_psid, webhook_event.message.quick_reply);\n        } else {\n          handleMessage(sender_psid, webhook_event.message);\n        }\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\n// Gets users name from facebook graph api\n// function getName(sender_psid,callback){\n//     var name = \"Empty\";\n//     request({\n//         url:\"https://graph.facebook.com/v3.3/\" + sender_psid,\n//         qs:{\n//             access_token: PAGE_ACCESS_TOKEN,\n//             fields: \"first_name\",\n//         },\n//         method:\"GET\"\n//     }, function(error,response,body){\n//         if (error){\n//             console.log(error)\n//         }else{\n//             var bodyObj = JSON.parse(body);\n//             name = bodyObj.first_name;\n//             console.log(\"Name: \" + name);\n//             return callback(name)\n//         }\n//     });\n//     return name;\n// }\n\nvar defaultResponse = generateResponseFromMessage(\"We could not understand your message. Kindly rephrase your message and send us again.\");\n\n// Handles messages events\nfunction handleMessage(sender_psid, received_message) {\n  var response = void 0;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(\"Received message: \\\"\" + received_message.text + \"\\\"\");\n\n    response = processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  var response = void 0;\n\n  // Get the payload for the postback\n  var payload = received_postback.payload;\n  console.log(\"Received postback: \\\"\" + payload + \"\\\"\");\n\n  var postback_intent = payload.split(\" \")[0];\n  var postback_content = payload.substring(payload.indexOf(\" \") + 1, payload.length);\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\"What would you like to know about our \" + postback_content + \"?\");\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [{\n            type: \"postback\",\n            title: \"Pay\",\n            payload: \"paid\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [{\n            type: \"postback\",\n            title: \"View Receipt\",\n            payload: \"receipt_view\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  var request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request({\n    uri: \"https://graph.facebook.com/v2.6/me/messages\",\n    qs: { access_token: PAGE_ACCESS_TOKEN },\n    method: \"POST\",\n    json: request_body\n  }, function (err, res, body) {\n    if (!err) {\n      console.log(\"Message sent!\");\n    } else {\n      console.error(\"Unable to send message:\" + err);\n    }\n  });\n}\n\n// Process text message and returns response object to handleMessage()\nfunction processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  var entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  // Object.keys(entities).forEach(key => {\n  //   console.log(\"Entity: \" + key);\n  //   console.log(entities[key]);\n  // });\n\n  // Check greeting\n  var is_greeting = entities[\"greetings\"] != null && entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  var intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    var intent_parts = intent[\"value\"].split(\"_\");\n    var intent_category = intent_parts[0];\n    var intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    var response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        var product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"].filter(function (obj) {\n            return obj[\"confidence\"] > 0.5;\n          }).map(function (obj) {\n            return obj[\"value\"];\n          });\n        }\n\n        response = generateRecommendationsResponse(product_types);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"attribute\"]) {\n            var product = entities[\"product\"][0];\n            var attribute = entities[\"attribute\"][0];\n            // TODO: Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          var messages = {\n            profit: \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer: \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(function (entity) {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\"Your latest order is <status>.\");\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\");\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\"It is a flat fee of $2 for every order.\");\n          } else {\n            response = generateResponseFromMessage(\"We deliver islandwide. The average delivery time takes 5-7 working days.\");\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          var product_name = entities[\"product\"][0][\"value\"];\n          var quantity = entities[\"number\"] ? entities[\"number\"][0][\"value\"] : 1;\n          response = generateAddCartResponse(sender_psid, product_name, quantity);\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\"Hi there! Welcome to MINDS. How can I help you?\");\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nfunction generateRecommendationsResponse(product_types) {\n  // TODO: Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    attribute: {\n      allegens: [\"eggs\", \"nut\"],\n      colour: null\n    }\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n  }];\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"name\"],\n            subtitle: \"$\" + product[\"price\"],\n            image_url: product[\"url\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Learn More\",\n              payload: \"enquiry_product \" + product[\"name\"]\n            }, {\n              type: \"postback\",\n              title: \"Add to Cart\",\n              payload: \"cart_add \" + product[\"name\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: \"Added \" + quantity + \" \" + product_name + \" to cart.\",\n    quick_replies: [{\n      content_type: \"text\",\n      title: \"View Cart\",\n      payload: \"cart_view\"\n    }, {\n      content_type: \"text\",\n      title: \"Checkout\",\n      payload: \"checkout\"\n    }]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"name\"],\n            subtitle: \"Qty: \" + product[\"quantity\"] + \" ($\" + product[\"price\"] + \" each)\",\n            image_url: product[\"url\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Add 1\",\n              payload: \"cart_add \" + product[\"name\"]\n            }, {\n              type: \"postback\",\n              title: \"Remove All\",\n              payload: \"cart_remove \" + product[\"name\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<name>\",\n        order_number: \"<order_number>\",\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        \"order_url\": \"http://petersapparel.parseapp.com/order?order_id=123456\",\n        \"timestamp\": \"1428444852\",\n        \"address\": {\n          \"street_1\": \"1 Hacker Way\",\n          \"street_2\": \"\",\n          \"city\": \"Menlo Park\",\n          \"postal_code\": \"94025\",\n          \"state\": \"CA\",\n          \"country\": \"US\"\n        },\n        summary: {\n          subtotal: 75.0 //,\n          // \"shipping_cost\":4.95,\n          // \"total_tax\":6.19,\n          // \"total_cost\":56.14\n        },\n        elements: products.map(function (product) {\n          return {\n            title: \"\" + product[\"name\"],\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return defaultResponse;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYm9keVBhcnNlciIsImFwcCIsInVzZSIsImpzb24iLCJyZXF1ZXN0IiwiUEFHRV9BQ0NFU1NfVE9LRU4iLCJwcm9jZXNzIiwiZW52IiwibGlzdGVuIiwiY29uc29sZSIsImxvZyIsImdldCIsInJlcSIsInJlcyIsIlZFUklGWV9UT0tFTiIsIm1vZGUiLCJxdWVyeSIsInRva2VuIiwiY2hhbGxlbmdlIiwic3RhdHVzIiwic2VuZCIsInNlbmRTdGF0dXMiLCJwb3N0IiwiYm9keSIsIm9iamVjdCIsImVudHJ5IiwiZm9yRWFjaCIsIndlYmhvb2tfZXZlbnQiLCJtZXNzYWdpbmciLCJzZW5kZXJfcHNpZCIsInNlbmRlciIsImlkIiwibWVzc2FnZSIsInF1aWNrX3JlcGx5IiwiaGFuZGxlUG9zdGJhY2siLCJoYW5kbGVNZXNzYWdlIiwicG9zdGJhY2siLCJkZWZhdWx0UmVzcG9uc2UiLCJnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UiLCJyZWNlaXZlZF9tZXNzYWdlIiwicmVzcG9uc2UiLCJ0ZXh0IiwicHJvY2Vzc01lc3NhZ2UiLCJjYWxsU2VuZEFQSSIsInJlY2VpdmVkX3Bvc3RiYWNrIiwicGF5bG9hZCIsInBvc3RiYWNrX2ludGVudCIsInNwbGl0IiwicG9zdGJhY2tfY29udGVudCIsInN1YnN0cmluZyIsImluZGV4T2YiLCJsZW5ndGgiLCJnZW5lcmF0ZUFkZENhcnRSZXNwb25zZSIsImdlbmVyYXRlVmlld0NhcnRSZXNwb25zZSIsImF0dGFjaG1lbnQiLCJ0eXBlIiwidGVtcGxhdGVfdHlwZSIsImJ1dHRvbnMiLCJ0aXRsZSIsImdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlIiwicmVxdWVzdF9ib2R5IiwicmVjaXBpZW50IiwidXJpIiwicXMiLCJhY2Nlc3NfdG9rZW4iLCJtZXRob2QiLCJlcnIiLCJlcnJvciIsImVudGl0aWVzIiwibmxwIiwiaXNfZ3JlZXRpbmciLCJpbnRlbnQiLCJpbnRlbnRfcGFydHMiLCJpbnRlbnRfY2F0ZWdvcnkiLCJpbnRlbnRfc3ViY2F0ZWdvcnkiLCJwcm9kdWN0X3R5cGVzIiwiZmlsdGVyIiwib2JqIiwibWFwIiwiZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZSIsInByb2R1Y3QiLCJhdHRyaWJ1dGUiLCJnZW5lcmF0ZVByb2R1Y3RFbnF1aXJ5UmVzcG9uc2UiLCJtZXNzYWdlcyIsInByb2ZpdCIsIm1hbnVmYWN0dXJlciIsInByb2R1Y3RzIiwiT2JqZWN0Iiwia2V5cyIsImVudGl0eSIsInByb2R1Y3RfbmFtZSIsInF1YW50aXR5IiwibmFtZSIsInByaWNlIiwidXJsIiwiYWxsZWdlbnMiLCJjb2xvdXIiLCJlbGVtZW50cyIsInN1YnRpdGxlIiwiaW1hZ2VfdXJsIiwicXVpY2tfcmVwbGllcyIsImNvbnRlbnRfdHlwZSIsInJlY2lwaWVudF9uYW1lIiwib3JkZXJfbnVtYmVyIiwiY3VycmVuY3kiLCJwYXltZW50X21ldGhvZCIsInN1bW1hcnkiLCJzdWJ0b3RhbCJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUNBLElBQU1BLFVBQVVDLFFBQVEsU0FBUixDQUFoQjtBQUFBLElBQ0VDLGFBQWFELFFBQVEsYUFBUixDQURmO0FBQUEsSUFFRUUsTUFBTUgsVUFBVUksR0FBVixDQUFjRixXQUFXRyxJQUFYLEVBQWQsQ0FGUixDLENBRTBDO0FBQzFDLElBQU1DLFVBQVVMLFFBQVEsU0FBUixDQUFoQjs7QUFFQTs7QUFFQTtBQUNBLElBQU1NLG9CQUFvQkMsUUFBUUMsR0FBUixDQUFZRixpQkFBdEM7O0FBRUE7QUFDQUosSUFBSU8sTUFBSixDQUFXLElBQVgsRUFBaUI7QUFBQSxTQUFNQyxRQUFRQyxHQUFSLENBQVksc0JBQVosQ0FBTjtBQUFBLENBQWpCOztBQUVBO0FBQ0FULElBQUlVLEdBQUosQ0FBUSxVQUFSLEVBQW9CLFVBQUNDLEdBQUQsRUFBTUMsR0FBTixFQUFjO0FBQ2hDLE1BQUlDLGVBQWVSLFFBQVFDLEdBQVIsQ0FBWU8sWUFBL0I7O0FBRUE7QUFDQSxNQUFJQyxPQUFPSCxJQUFJSSxLQUFKLENBQVUsVUFBVixDQUFYO0FBQ0EsTUFBSUMsUUFBUUwsSUFBSUksS0FBSixDQUFVLGtCQUFWLENBQVo7QUFDQSxNQUFJRSxZQUFZTixJQUFJSSxLQUFKLENBQVUsZUFBVixDQUFoQjs7QUFFQTtBQUNBLE1BQUlELFFBQVFFLEtBQVosRUFBbUI7QUFDakI7QUFDQSxRQUFJRixTQUFTLFdBQVQsSUFBd0JFLFVBQVVILFlBQXRDLEVBQW9EO0FBQ2xEO0FBQ0FMLGNBQVFDLEdBQVIsQ0FBWSxrQkFBWjtBQUNBRyxVQUFJTSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUJGLFNBQXJCO0FBQ0QsS0FKRCxNQUlPO0FBQ0w7QUFDQUwsVUFBSVEsVUFBSixDQUFlLEdBQWY7QUFDRDtBQUNGO0FBQ0YsQ0FwQkQ7O0FBc0JBO0FBQ0FwQixJQUFJcUIsSUFBSixDQUFTLFVBQVQsRUFBcUIsVUFBQ1YsR0FBRCxFQUFNQyxHQUFOLEVBQWM7QUFDakMsTUFBSVUsT0FBT1gsSUFBSVcsSUFBZjs7QUFFQTtBQUNBLE1BQUlBLEtBQUtDLE1BQUwsS0FBZ0IsTUFBcEIsRUFBNEI7QUFDMUI7QUFDQUQsU0FBS0UsS0FBTCxDQUFXQyxPQUFYLENBQW1CLFVBQVNELEtBQVQsRUFBZ0I7QUFDakM7QUFDQTtBQUNBLFVBQUlFLGdCQUFnQkYsTUFBTUcsU0FBTixDQUFnQixDQUFoQixDQUFwQjtBQUNBOztBQUVBO0FBQ0EsVUFBSUMsY0FBY0YsY0FBY0csTUFBZCxDQUFxQkMsRUFBdkM7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsVUFBSUosY0FBY0ssT0FBbEIsRUFBMkI7QUFDekI7QUFDQTtBQUNBO0FBQ0EsWUFBSUwsY0FBY0ssT0FBZCxDQUFzQkMsV0FBMUIsRUFBdUM7QUFDckNDLHlCQUFlTCxXQUFmLEVBQTRCRixjQUFjSyxPQUFkLENBQXNCQyxXQUFsRDtBQUNELFNBRkQsTUFFTztBQUNMRSx3QkFBY04sV0FBZCxFQUEyQkYsY0FBY0ssT0FBekM7QUFDRDtBQUNGLE9BVEQsTUFTTyxJQUFJTCxjQUFjUyxRQUFsQixFQUE0QjtBQUNqQ0YsdUJBQWVMLFdBQWYsRUFBNEJGLGNBQWNTLFFBQTFDO0FBQ0Q7QUFDRixLQXhCRDs7QUEwQkE7QUFDQXZCLFFBQUlNLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixnQkFBckI7QUFDRCxHQTlCRCxNQThCTztBQUNMO0FBQ0FQLFFBQUlRLFVBQUosQ0FBZSxHQUFmO0FBQ0Q7QUFDRixDQXRDRDs7QUF3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsSUFBSWdCLGtCQUFrQkMsNEJBQ3BCLHVGQURvQixDQUF0Qjs7QUFJQTtBQUNBLFNBQVNILGFBQVQsQ0FBdUJOLFdBQXZCLEVBQW9DVSxnQkFBcEMsRUFBc0Q7QUFDcEQsTUFBSUMsaUJBQUo7O0FBRUE7QUFDQSxNQUFJRCxpQkFBaUJFLElBQXJCLEVBQTJCO0FBQ3pCaEMsWUFBUUMsR0FBUiwwQkFBa0M2QixpQkFBaUJFLElBQW5EOztBQUVBRCxlQUFXRSxlQUFlYixXQUFmLEVBQTRCVSxnQkFBNUIsQ0FBWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDRCxHQVRELE1BU087QUFDTEMsZUFBV0gsZUFBWDtBQUNBO0FBQ0E7QUFDRDs7QUFFRDtBQUNBTSxjQUFZZCxXQUFaLEVBQXlCVyxRQUF6QjtBQUNEOztBQUVEO0FBQ0EsU0FBU04sY0FBVCxDQUF3QkwsV0FBeEIsRUFBcUNlLGlCQUFyQyxFQUF3RDtBQUN0RCxNQUFJSixpQkFBSjs7QUFFQTtBQUNBLE1BQUlLLFVBQVVELGtCQUFrQkMsT0FBaEM7QUFDQXBDLFVBQVFDLEdBQVIsMkJBQW1DbUMsT0FBbkM7O0FBRUEsTUFBSUMsa0JBQWtCRCxRQUFRRSxLQUFSLENBQWMsR0FBZCxFQUFtQixDQUFuQixDQUF0QjtBQUNBLE1BQUlDLG1CQUFtQkgsUUFBUUksU0FBUixDQUNyQkosUUFBUUssT0FBUixDQUFnQixHQUFoQixJQUF1QixDQURGLEVBRXJCTCxRQUFRTSxNQUZhLENBQXZCOztBQUtBO0FBQ0EsTUFBSUwsb0JBQW9CLFVBQXhCLEVBQW9DO0FBQ2xDO0FBQ0FOLGVBQVdZLHdCQUF3QnZCLFdBQXhCLEVBQXFDbUIsZ0JBQXJDLEVBQXVELENBQXZELENBQVg7QUFDRCxHQUhELE1BR08sSUFBSUYsb0JBQW9CLFdBQXhCLEVBQXFDO0FBQzFDTixlQUFXYSx5QkFBeUJ4QixXQUF6QixDQUFYO0FBQ0QsR0FGTSxNQUVBLElBQUlpQixvQkFBb0IsaUJBQXhCLEVBQTJDO0FBQ2hETixlQUFXRix1RUFDZ0NVLGdCQURoQyxPQUFYO0FBR0QsR0FKTSxNQUlBLElBQUlGLG9CQUFvQixVQUF4QixFQUFvQztBQUN6Q04sZUFBVztBQUNUYyxrQkFBWTtBQUNWQyxjQUFNLFVBREk7QUFFVlYsaUJBQVM7QUFDUFcseUJBQWUsUUFEUjtBQUVQZixnQkFBTSxtQ0FGQztBQUdQZ0IsbUJBQVMsQ0FDUDtBQUNFRixrQkFBTSxVQURSO0FBRUVHLG1CQUFPLEtBRlQ7QUFHRWIscUJBQVM7QUFIWCxXQURPO0FBSEY7QUFGQztBQURILEtBQVg7QUFnQkQsR0FqQk0sTUFpQkEsSUFBSUMsb0JBQW9CLE1BQXhCLEVBQWdDO0FBQ3JDTixlQUFXO0FBQ1RjLGtCQUFZO0FBQ1ZDLGNBQU0sVUFESTtBQUVWVixpQkFBUztBQUNQVyx5QkFBZSxRQURSO0FBRVBmLGdCQUFNLHNDQUZDO0FBR1BnQixtQkFBUyxDQUNQO0FBQ0VGLGtCQUFNLFVBRFI7QUFFRUcsbUJBQU8sY0FGVDtBQUdFYixxQkFBUztBQUhYLFdBRE87QUFIRjtBQUZDO0FBREgsS0FBWDtBQWdCRCxHQWpCTSxNQWlCQSxJQUFJQyxvQkFBb0IsY0FBeEIsRUFBd0M7QUFDN0NOLGVBQVdtQix3QkFBd0I5QixXQUF4QixDQUFYO0FBQ0Q7O0FBRUQsTUFBSVcsWUFBWSxJQUFoQixFQUFzQjtBQUNwQkEsZUFBV0gsaUJBQVg7QUFDRDs7QUFFRDtBQUNBTSxjQUFZZCxXQUFaLEVBQXlCVyxRQUF6QjtBQUNEOztBQUVEO0FBQ0EsU0FBU0csV0FBVCxDQUFxQmQsV0FBckIsRUFBa0NXLFFBQWxDLEVBQTRDO0FBQzFDO0FBQ0EvQixVQUFRQyxHQUFSLENBQVk4QixRQUFaOztBQUVBO0FBQ0EsTUFBSW9CLGVBQWU7QUFDakJDLGVBQVc7QUFDVDlCLFVBQUlGO0FBREssS0FETTtBQUlqQkcsYUFBU1E7QUFKUSxHQUFuQjs7QUFPQTtBQUNBcEMsVUFDRTtBQUNFMEQsU0FBSyw2Q0FEUDtBQUVFQyxRQUFJLEVBQUVDLGNBQWMzRCxpQkFBaEIsRUFGTjtBQUdFNEQsWUFBUSxNQUhWO0FBSUU5RCxVQUFNeUQ7QUFKUixHQURGLEVBT0UsVUFBQ00sR0FBRCxFQUFNckQsR0FBTixFQUFXVSxJQUFYLEVBQW9CO0FBQ2xCLFFBQUksQ0FBQzJDLEdBQUwsRUFBVTtBQUNSekQsY0FBUUMsR0FBUixDQUFZLGVBQVo7QUFDRCxLQUZELE1BRU87QUFDTEQsY0FBUTBELEtBQVIsQ0FBYyw0QkFBNEJELEdBQTFDO0FBQ0Q7QUFDRixHQWJIO0FBZUQ7O0FBRUQ7QUFDQSxTQUFTeEIsY0FBVCxDQUF3QmIsV0FBeEIsRUFBcUNHLE9BQXJDLEVBQThDO0FBQzVDO0FBQ0EsTUFBSW9DLFdBQVdwQyxRQUFRcUMsR0FBUixDQUFZLFVBQVosQ0FBZjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsTUFBSUMsY0FDRkYsU0FBUyxXQUFULEtBQXlCLElBQXpCLElBQ0FBLFNBQVMsV0FBVCxFQUFzQixDQUF0QixFQUF5QixZQUF6QixJQUF5QyxHQUYzQyxDQVg0QyxDQWFJOztBQUVoRDtBQUNBLE1BQUlHLFNBQVNILFNBQVMsUUFBVCxFQUFtQixDQUFuQixDQUFiOztBQUVBLE1BQUlHLE9BQU8sWUFBUCxJQUF1QixHQUEzQixFQUFnQztBQUM5QjtBQUNBLFFBQUlDLGVBQWVELE9BQU8sT0FBUCxFQUFnQnhCLEtBQWhCLENBQXNCLEdBQXRCLENBQW5CO0FBQ0EsUUFBSTBCLGtCQUFrQkQsYUFBYSxDQUFiLENBQXRCO0FBQ0EsUUFBSUUscUJBQXFCRixhQUFhckIsTUFBYixHQUFzQixDQUF0QixHQUEwQnFCLGFBQWEsQ0FBYixDQUExQixHQUE0QyxJQUFyRTtBQUNBLFFBQUloQyxXQUFXLElBQWY7O0FBRUEsWUFBUWlDLGVBQVI7QUFDRSxXQUFLLGdCQUFMO0FBQ0U7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsWUFBSUUsZ0JBQWdCLEVBQXBCO0FBQ0EsWUFBSVAsU0FBUyxjQUFULENBQUosRUFBOEI7QUFDNUIzRCxrQkFBUUMsR0FBUixDQUFZLDBCQUFaO0FBQ0FpRSwwQkFBZ0JQLFNBQVMsY0FBVCxFQUNiUSxNQURhLENBQ047QUFBQSxtQkFBT0MsSUFBSSxZQUFKLElBQW9CLEdBQTNCO0FBQUEsV0FETSxFQUViQyxHQUZhLENBRVQ7QUFBQSxtQkFBT0QsSUFBSSxPQUFKLENBQVA7QUFBQSxXQUZTLENBQWhCO0FBR0Q7O0FBRURyQyxtQkFBV3VDLGdDQUFnQ0osYUFBaEMsQ0FBWDtBQUNBOztBQUVGLFdBQUssU0FBTDtBQUNFO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQUlELHVCQUF1QixTQUEzQixFQUFzQztBQUNwQztBQUNBLGNBQUlOLFNBQVMsU0FBVCxLQUF1QkEsU0FBUyxXQUFULENBQTNCLEVBQWtEO0FBQ2hELGdCQUFJWSxVQUFVWixTQUFTLFNBQVQsRUFBb0IsQ0FBcEIsQ0FBZDtBQUNBLGdCQUFJYSxZQUFZYixTQUFTLFdBQVQsRUFBc0IsQ0FBdEIsQ0FBaEI7QUFDQTtBQUNBNUIsdUJBQVcwQywrQkFBK0JGLE9BQS9CLEVBQXdDQyxTQUF4QyxDQUFYO0FBQ0QsV0FMRCxNQUtPO0FBQ0x6Qyx1QkFBV0gsZUFBWDtBQUNEO0FBQ0YsU0FWRCxNQVVPLElBQUlxQyx1QkFBdUIsU0FBM0IsRUFBc0M7QUFDM0MsY0FBSVMsV0FBVztBQUNiQyxvQkFDRSwyTEFGVztBQUdiQywwQkFDRSxtS0FKVztBQUtiQyxzQkFBVTtBQUxHLFdBQWY7QUFPQTtBQUNBQyxpQkFBT0MsSUFBUCxDQUFZTCxRQUFaLEVBQXNCekQsT0FBdEIsQ0FBOEIsa0JBQVU7QUFDdEMsZ0JBQUljLFlBQVksSUFBWixJQUFvQjRCLFNBQVNxQixNQUFULENBQXhCLEVBQTBDO0FBQ3hDakQseUJBQVdGLDRCQUE0QjZDLFNBQVNNLE1BQVQsQ0FBNUIsQ0FBWDtBQUNEO0FBQ0YsV0FKRDtBQUtELFNBZE0sTUFjQSxJQUFJZix1QkFBdUIsVUFBM0IsRUFBdUM7QUFDNUMsY0FBSU4sU0FBUyxRQUFULENBQUosRUFBd0I7QUFDdEI7QUFDQTVCLHVCQUFXRiw0QkFDVCxnQ0FEUyxDQUFYO0FBR0QsV0FMRCxNQUtPLElBQUk4QixTQUFTLG1CQUFULENBQUosRUFBbUM7QUFDeEM7QUFDQTVCLHVCQUFXRiw0QkFDVCwwSUFEUyxDQUFYO0FBR0QsV0FMTSxNQUtBLElBQUk4QixTQUFTLE1BQVQsQ0FBSixFQUFzQjtBQUMzQjVCLHVCQUFXRiw0QkFDVCx5Q0FEUyxDQUFYO0FBR0QsV0FKTSxNQUlBO0FBQ0xFLHVCQUFXRiw0QkFDVCwwRUFEUyxDQUFYO0FBR0Q7QUFDRjtBQUNEOztBQUVGLFdBQUssTUFBTDtBQUNFO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFlBQUlvQyx1QkFBdUIsS0FBdkIsSUFBZ0NOLFNBQVMsU0FBVCxDQUFwQyxFQUF5RDtBQUN2RCxjQUFJc0IsZUFBZXRCLFNBQVMsU0FBVCxFQUFvQixDQUFwQixFQUF1QixPQUF2QixDQUFuQjtBQUNBLGNBQUl1QixXQUFXdkIsU0FBUyxRQUFULElBQ1hBLFNBQVMsUUFBVCxFQUFtQixDQUFuQixFQUFzQixPQUF0QixDQURXLEdBRVgsQ0FGSjtBQUdBNUIscUJBQVdZLHdCQUNUdkIsV0FEUyxFQUVUNkQsWUFGUyxFQUdUQyxRQUhTLENBQVg7QUFLRCxTQVZELE1BVU8sSUFBSWpCLHVCQUF1QixNQUEzQixFQUFtQztBQUN4Q2xDLHFCQUFXYSx5QkFBeUJ4QixXQUF6QixDQUFYO0FBQ0Q7QUFDRDs7QUFFRjtBQUNFVyxtQkFBV0gsZUFBWDtBQTdGSjs7QUFnR0FHLGVBQVdBLFlBQVksSUFBWixHQUFtQkgsZUFBbkIsR0FBcUNHLFFBQWhEO0FBQ0EsV0FBT0EsUUFBUDtBQUNELEdBekdELE1BeUdPLElBQUk4QixXQUFKLEVBQWlCO0FBQ3RCO0FBQ0E7QUFDQSxXQUFPaEMsNEJBQ0wsaURBREssQ0FBUDtBQUdEOztBQUVEO0FBQ0EsU0FBT0QsZUFBUDtBQUNEOztBQUVEO0FBQ0EsU0FBU0MsMkJBQVQsQ0FBcUNOLE9BQXJDLEVBQThDO0FBQzVDLFNBQU87QUFDTFMsVUFBTVQ7QUFERCxHQUFQO0FBR0Q7O0FBRUQ7QUFDQSxTQUFTK0MsK0JBQVQsQ0FBeUNKLGFBQXpDLEVBQXdEO0FBQ3REO0FBQ0EsTUFBSVcsV0FBVyxDQUNiO0FBQ0V2RCxRQUFJLENBRE47QUFFRTZELFVBQU0sZ0NBRlI7QUFHRUMsV0FBTyxHQUhUO0FBSUVDLFNBQ0Usb0dBTEo7QUFNRWIsZUFBVztBQUNUYyxnQkFBVSxDQUFDLE1BQUQsRUFBUyxLQUFULENBREQ7QUFFVEMsY0FBUTtBQUZDO0FBTmIsR0FEYSxFQVliO0FBQ0VqRSxRQUFJLENBRE47QUFFRTZELFVBQU0sd0NBRlI7QUFHRUMsV0FBTyxHQUhUO0FBSUVDLFNBQ0U7QUFMSixHQVphLEVBbUJiO0FBQ0UvRCxRQUFJLENBRE47QUFFRTZELFVBQU0sbUNBRlI7QUFHRUMsV0FBTyxHQUhUO0FBSUVDLFNBQ0U7QUFMSixHQW5CYSxDQUFmOztBQTRCQSxNQUFJdEQsV0FBVztBQUNiYyxnQkFBWTtBQUNWQyxZQUFNLFVBREk7QUFFVlYsZUFBUztBQUNQVyx1QkFBZSxTQURSO0FBRVB5QyxrQkFBVVgsU0FBU1IsR0FBVCxDQUFhLG1CQUFXO0FBQ2hDLGlCQUFPO0FBQ0xwQixtQkFBT3NCLFFBQVEsTUFBUixDQURGO0FBRUxrQiw0QkFBY2xCLFFBQVEsT0FBUixDQUZUO0FBR0xtQix1QkFBV25CLFFBQVEsS0FBUixDQUhOO0FBSUx2QixxQkFBUyxDQUNQO0FBQ0VGLG9CQUFNLFVBRFI7QUFFRUcscUJBQU8sWUFGVDtBQUdFYiw0Q0FBNEJtQyxRQUFRLE1BQVI7QUFIOUIsYUFETyxFQU1QO0FBQ0V6QixvQkFBTSxVQURSO0FBRUVHLHFCQUFPLGFBRlQ7QUFHRWIscUNBQXFCbUMsUUFBUSxNQUFSO0FBSHZCLGFBTk87QUFKSixXQUFQO0FBaUJELFNBbEJTO0FBRkg7QUFGQztBQURDLEdBQWY7QUEyQkEsU0FBT3hDLFFBQVA7QUFDRDs7QUFFRDtBQUNBLFNBQVNZLHVCQUFULENBQWlDdkIsV0FBakMsRUFBOEM2RCxZQUE5QyxFQUE0REMsUUFBNUQsRUFBc0U7QUFDcEU7O0FBRUEsU0FBTztBQUNMbEQscUJBQWVrRCxRQUFmLFNBQTJCRCxZQUEzQixjQURLO0FBRUxVLG1CQUFlLENBQ2I7QUFDRUMsb0JBQWMsTUFEaEI7QUFFRTNDLGFBQU8sV0FGVDtBQUdFYjtBQUhGLEtBRGEsRUFNYjtBQUNFd0Qsb0JBQWMsTUFEaEI7QUFFRTNDLGFBQU8sVUFGVDtBQUdFYjtBQUhGLEtBTmE7QUFGVixHQUFQO0FBZUQ7O0FBRUQ7QUFDQSxTQUFTUSx3QkFBVCxDQUFrQ3hCLFdBQWxDLEVBQStDO0FBQzdDO0FBQ0EsTUFBSXlELFdBQVcsQ0FDYjtBQUNFdkQsUUFBSSxDQUROO0FBRUU2RCxVQUFNLGdDQUZSO0FBR0VDLFdBQU8sR0FIVDtBQUlFQyxTQUNFLG9HQUxKO0FBTUVILGNBQVU7QUFOWixHQURhLEVBU2I7QUFDRTVELFFBQUksQ0FETjtBQUVFNkQsVUFBTSx3Q0FGUjtBQUdFQyxXQUFPLEdBSFQ7QUFJRUMsU0FDRSxvR0FMSjtBQU1FSCxjQUFVO0FBTlosR0FUYSxFQWlCYjtBQUNFNUQsUUFBSSxDQUROO0FBRUU2RCxVQUFNLG1DQUZSO0FBR0VDLFdBQU8sR0FIVDtBQUlFQyxTQUNFLG9HQUxKO0FBTUVILGNBQVU7QUFOWixHQWpCYSxDQUFmO0FBMEJBLE1BQUluRCxXQUFXO0FBQ2JjLGdCQUFZO0FBQ1ZDLFlBQU0sVUFESTtBQUVWVixlQUFTO0FBQ1BXLHVCQUFlLFNBRFI7QUFFUHlDLGtCQUFVWCxTQUFTUixHQUFULENBQWEsbUJBQVc7QUFDaEMsaUJBQU87QUFDTHBCLG1CQUFPc0IsUUFBUSxNQUFSLENBREY7QUFFTGtCLGdDQUFrQmxCLFFBQVEsVUFBUixDQUFsQixXQUEyQ0EsUUFBUSxPQUFSLENBQTNDLFdBRks7QUFHTG1CLHVCQUFXbkIsUUFBUSxLQUFSLENBSE47QUFJTHZCLHFCQUFTLENBQ1A7QUFDRUYsb0JBQU0sVUFEUjtBQUVFRyxxQkFBTyxPQUZUO0FBR0ViLHFDQUFxQm1DLFFBQVEsTUFBUjtBQUh2QixhQURPLEVBTVA7QUFDRXpCLG9CQUFNLFVBRFI7QUFFRUcscUJBQU8sWUFGVDtBQUdFYix3Q0FBd0JtQyxRQUFRLE1BQVI7QUFIMUIsYUFOTztBQUpKLFdBQVA7QUFpQkQsU0FsQlM7QUFGSDtBQUZDO0FBREMsR0FBZjtBQTJCQSxTQUFPeEMsUUFBUDtBQUNEOztBQUVEO0FBQ0EsU0FBU21CLHVCQUFULENBQWlDOUIsV0FBakMsRUFBOEM7QUFDNUM7QUFDQSxNQUFJeUQsV0FBVyxDQUNiO0FBQ0V2RCxRQUFJLENBRE47QUFFRTZELFVBQU0sZ0NBRlI7QUFHRUMsV0FBTyxHQUhUO0FBSUVDLFNBQ0Usb0dBTEo7QUFNRUgsY0FBVTtBQU5aLEdBRGEsRUFTYjtBQUNFNUQsUUFBSSxDQUROO0FBRUU2RCxVQUFNLHdDQUZSO0FBR0VDLFdBQU8sR0FIVDtBQUlFQyxTQUNFLG9HQUxKO0FBTUVILGNBQVU7QUFOWixHQVRhLEVBaUJiO0FBQ0U1RCxRQUFJLENBRE47QUFFRTZELFVBQU0sbUNBRlI7QUFHRUMsV0FBTyxHQUhUO0FBSUVDLFNBQ0Usb0dBTEo7QUFNRUgsY0FBVTtBQU5aLEdBakJhLENBQWY7O0FBMkJBLE1BQUluRCxXQUFXO0FBQ2JjLGdCQUFZO0FBQ1ZDLFlBQU0sVUFESTtBQUVWVixlQUFTO0FBQ1BXLHVCQUFlLFNBRFI7QUFFUDhDLHdCQUFnQixRQUZUO0FBR1BDLHNCQUFjLGdCQUhQO0FBSVBDLGtCQUFVLEtBSkg7QUFLUEMsd0JBQWdCLFFBTFQ7QUFNUCxxQkFBWSx5REFOTDtBQU9QLHFCQUFZLFlBUEw7QUFRUCxtQkFBVTtBQUNSLHNCQUFXLGNBREg7QUFFUixzQkFBVyxFQUZIO0FBR1Isa0JBQU8sWUFIQztBQUlSLHlCQUFjLE9BSk47QUFLUixtQkFBUSxJQUxBO0FBTVIscUJBQVU7QUFORixTQVJIO0FBZ0JQQyxpQkFBUztBQUNQQyxvQkFBVSxJQURILENBQ1E7QUFDZjtBQUNBO0FBQ0E7QUFKTyxTQWhCRjtBQXNCUFYsa0JBQVVYLFNBQVNSLEdBQVQsQ0FBYSxtQkFBVztBQUNoQyxpQkFBTztBQUNMcEIsd0JBQVVzQixRQUFRLE1BQVIsQ0FETDtBQUVMa0Isc0JBQVUsRUFGTDtBQUdMUCxzQkFBVVgsUUFBUSxVQUFSLENBSEw7QUFJTGEsbUJBQU9iLFFBQVEsT0FBUixDQUpGO0FBS0x3QixzQkFBVSxLQUxMO0FBTUxMLHVCQUFXbkIsUUFBUSxLQUFSO0FBTk4sV0FBUDtBQVFELFNBVFM7QUF0Qkg7QUFGQztBQURDLEdBQWY7O0FBdUNBLFNBQU94QyxRQUFQO0FBQ0Q7O0FBRUQ7QUFDQSxTQUFTMEMsOEJBQVQsQ0FBd0NGLE9BQXhDLEVBQWlEQyxTQUFqRCxFQUE0RDtBQUMxRDtBQUNBLFNBQU81QyxlQUFQO0FBQ0QiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiL2FwcCIsInNvdXJjZXNDb250ZW50IjpbIi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5mYWNlYm9vay5jb20vZG9jcy9tZXNzZW5nZXItcGxhdGZvcm0vZ2V0dGluZy1zdGFydGVkL3dlYmhvb2stc2V0dXAvXG4vLyBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvbWVzc2VuZ2VyLXBsYXRmb3JtL2dldHRpbmctc3RhcnRlZC9hcHAtc2V0dXBcbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5mYWNlYm9vay5jb20vZG9jcy9tZXNzZW5nZXItcGxhdGZvcm0vZ2V0dGluZy1zdGFydGVkL3F1aWNrLXN0YXJ0XG5cblwidXNlIHN0cmljdFwiO1xuXG4vLyBJbXBvcnRzIGRlcGVuZGVuY2llcyBhbmQgc2V0IHVwIGh0dHAgc2VydmVyXG5jb25zdCBleHByZXNzID0gcmVxdWlyZShcImV4cHJlc3NcIiksXG4gIGJvZHlQYXJzZXIgPSByZXF1aXJlKFwiYm9keS1wYXJzZXJcIiksXG4gIGFwcCA9IGV4cHJlc3MoKS51c2UoYm9keVBhcnNlci5qc29uKCkpOyAvLyBjcmVhdGVzIGV4cHJlc3MgaHR0cCBzZXJ2ZXJcbmNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKFwicmVxdWVzdFwiKTtcblxuLy8gaW1wb3J0IHsgY2hlY2tVc2VyLCBjcmVhdGVVc2VyIH0gZnJvbSAnLi9EQkNvbm4nO1xuXG4vLyBHZXQgcGFnZSBhY2Nlc3MgdG9rZW5cbmNvbnN0IFBBR0VfQUNDRVNTX1RPS0VOID0gcHJvY2Vzcy5lbnYuUEFHRV9BQ0NFU1NfVE9LRU47XG5cbi8vIFNldHMgc2VydmVyIHBvcnQgYW5kIGxvZ3MgbWVzc2FnZSBvbiBzdWNjZXNzXG5hcHAubGlzdGVuKDMwMDAsICgpID0+IGNvbnNvbGUubG9nKFwid2ViaG9vayBpcyBsaXN0ZW5pbmdcIikpO1xuXG4vLyBBZGRzIHN1cHBvcnQgZm9yIEdFVCByZXF1ZXN0cyB0byBvdXIgd2ViaG9va1xuYXBwLmdldChcIi93ZWJob29rXCIsIChyZXEsIHJlcykgPT4ge1xuICBsZXQgVkVSSUZZX1RPS0VOID0gcHJvY2Vzcy5lbnYuVkVSSUZZX1RPS0VOO1xuXG4gIC8vIFBhcnNlIHRoZSBxdWVyeSBwYXJhbXNcbiAgbGV0IG1vZGUgPSByZXEucXVlcnlbXCJodWIubW9kZVwiXTtcbiAgbGV0IHRva2VuID0gcmVxLnF1ZXJ5W1wiaHViLnZlcmlmeV90b2tlblwiXTtcbiAgbGV0IGNoYWxsZW5nZSA9IHJlcS5xdWVyeVtcImh1Yi5jaGFsbGVuZ2VcIl07XG5cbiAgLy8gQ2hlY2tzIGlmIGEgdG9rZW4gYW5kIG1vZGUgaXMgaW4gdGhlIHF1ZXJ5IHN0cmluZyBvZiB0aGUgcmVxdWVzdFxuICBpZiAobW9kZSAmJiB0b2tlbikge1xuICAgIC8vIENoZWNrcyB0aGUgbW9kZSBhbmQgdG9rZW4gc2VudCBpcyBjb3JyZWN0XG4gICAgaWYgKG1vZGUgPT09IFwic3Vic2NyaWJlXCIgJiYgdG9rZW4gPT09IFZFUklGWV9UT0tFTikge1xuICAgICAgLy8gUmVzcG9uZHMgd2l0aCB0aGUgY2hhbGxlbmdlIHRva2VuIGZyb20gdGhlIHJlcXVlc3RcbiAgICAgIGNvbnNvbGUubG9nKFwiV0VCSE9PS19WRVJJRklFRFwiKTtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKGNoYWxsZW5nZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlc3BvbmRzIHdpdGggJzQwMyBGb3JiaWRkZW4nIGlmIHZlcmlmeSB0b2tlbnMgZG8gbm90IG1hdGNoXG4gICAgICByZXMuc2VuZFN0YXR1cyg0MDMpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vIENyZWF0ZXMgdGhlIGVuZHBvaW50IGZvciBvdXIgd2ViaG9va1xuYXBwLnBvc3QoXCIvd2ViaG9va1wiLCAocmVxLCByZXMpID0+IHtcbiAgbGV0IGJvZHkgPSByZXEuYm9keTtcblxuICAvLyBDaGVja3MgdGhpcyBpcyBhbiBldmVudCBmcm9tIGEgcGFnZSBzdWJzY3JpcHRpb25cbiAgaWYgKGJvZHkub2JqZWN0ID09PSBcInBhZ2VcIikge1xuICAgIC8vIEl0ZXJhdGVzIG92ZXIgZWFjaCBlbnRyeSAtIHRoZXJlIG1heSBiZSBtdWx0aXBsZSBpZiBiYXRjaGVkXG4gICAgYm9keS5lbnRyeS5mb3JFYWNoKGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAvLyBHZXRzIHRoZSBtZXNzYWdlLiBlbnRyeS5tZXNzYWdpbmcgaXMgYW4gYXJyYXksIGJ1dFxuICAgICAgLy8gd2lsbCBvbmx5IGV2ZXIgY29udGFpbiBvbmUgbWVzc2FnZSwgc28gd2UgZ2V0IGluZGV4IDBcbiAgICAgIGxldCB3ZWJob29rX2V2ZW50ID0gZW50cnkubWVzc2FnaW5nWzBdO1xuICAgICAgLy8gY29uc29sZS5sb2cod2ViaG9va19ldmVudCk7XG5cbiAgICAgIC8vIEdldCB0aGUgc2VuZGVyIFBTSURcbiAgICAgIGxldCBzZW5kZXJfcHNpZCA9IHdlYmhvb2tfZXZlbnQuc2VuZGVyLmlkO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJTZW5kZXIgUFNJRDogXCIgKyBzZW5kZXJfcHNpZCk7XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSBldmVudCBpcyBhIG1lc3NhZ2Ugb3IgcG9zdGJhY2sgYW5kXG4gICAgICAvLyBwYXNzIHRoZSBldmVudCB0byB0aGUgYXBwcm9wcmlhdGUgaGFuZGxlciBmdW5jdGlvblxuICAgICAgaWYgKHdlYmhvb2tfZXZlbnQubWVzc2FnZSkge1xuICAgICAgICAvLyBnZXROYW1lKHNlbmRlcl9wc2lkLCBmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgIC8vICAgICBjaGVja1VzZXIoc2VuZGVyX3BzaWQscmVzcG9uc2UpO1xuICAgICAgICAvLyB9KTtcbiAgICAgICAgaWYgKHdlYmhvb2tfZXZlbnQubWVzc2FnZS5xdWlja19yZXBseSkge1xuICAgICAgICAgIGhhbmRsZVBvc3RiYWNrKHNlbmRlcl9wc2lkLCB3ZWJob29rX2V2ZW50Lm1lc3NhZ2UucXVpY2tfcmVwbHkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhhbmRsZU1lc3NhZ2Uoc2VuZGVyX3BzaWQsIHdlYmhvb2tfZXZlbnQubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAod2ViaG9va19ldmVudC5wb3N0YmFjaykge1xuICAgICAgICBoYW5kbGVQb3N0YmFjayhzZW5kZXJfcHNpZCwgd2ViaG9va19ldmVudC5wb3N0YmFjayk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBSZXR1cm5zIGEgJzIwMCBPSycgcmVzcG9uc2UgdG8gYWxsIHJlcXVlc3RzXG4gICAgcmVzLnN0YXR1cygyMDApLnNlbmQoXCJFVkVOVF9SRUNFSVZFRFwiKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBSZXR1cm5zIGEgJzQwNCBOb3QgRm91bmQnIGlmIGV2ZW50IGlzIG5vdCBmcm9tIGEgcGFnZSBzdWJzY3JpcHRpb25cbiAgICByZXMuc2VuZFN0YXR1cyg0MDQpO1xuICB9XG59KTtcblxuLy8gR2V0cyB1c2VycyBuYW1lIGZyb20gZmFjZWJvb2sgZ3JhcGggYXBpXG4vLyBmdW5jdGlvbiBnZXROYW1lKHNlbmRlcl9wc2lkLGNhbGxiYWNrKXtcbi8vICAgICB2YXIgbmFtZSA9IFwiRW1wdHlcIjtcbi8vICAgICByZXF1ZXN0KHtcbi8vICAgICAgICAgdXJsOlwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjMuMy9cIiArIHNlbmRlcl9wc2lkLFxuLy8gICAgICAgICBxczp7XG4vLyAgICAgICAgICAgICBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOLFxuLy8gICAgICAgICAgICAgZmllbGRzOiBcImZpcnN0X25hbWVcIixcbi8vICAgICAgICAgfSxcbi8vICAgICAgICAgbWV0aG9kOlwiR0VUXCJcbi8vICAgICB9LCBmdW5jdGlvbihlcnJvcixyZXNwb25zZSxib2R5KXtcbi8vICAgICAgICAgaWYgKGVycm9yKXtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuLy8gICAgICAgICB9ZWxzZXtcbi8vICAgICAgICAgICAgIHZhciBib2R5T2JqID0gSlNPTi5wYXJzZShib2R5KTtcbi8vICAgICAgICAgICAgIG5hbWUgPSBib2R5T2JqLmZpcnN0X25hbWU7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk5hbWU6IFwiICsgbmFtZSk7XG4vLyAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmFtZSlcbi8vICAgICAgICAgfVxuLy8gICAgIH0pO1xuLy8gICAgIHJldHVybiBuYW1lO1xuLy8gfVxuXG5sZXQgZGVmYXVsdFJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICBcIldlIGNvdWxkIG5vdCB1bmRlcnN0YW5kIHlvdXIgbWVzc2FnZS4gS2luZGx5IHJlcGhyYXNlIHlvdXIgbWVzc2FnZSBhbmQgc2VuZCB1cyBhZ2Fpbi5cIlxuKTtcblxuLy8gSGFuZGxlcyBtZXNzYWdlcyBldmVudHNcbmZ1bmN0aW9uIGhhbmRsZU1lc3NhZ2Uoc2VuZGVyX3BzaWQsIHJlY2VpdmVkX21lc3NhZ2UpIHtcbiAgbGV0IHJlc3BvbnNlO1xuXG4gIC8vIENoZWNrIGlmIHRoZSBtZXNzYWdlIGNvbnRhaW5zIHRleHRcbiAgaWYgKHJlY2VpdmVkX21lc3NhZ2UudGV4dCkge1xuICAgIGNvbnNvbGUubG9nKGBSZWNlaXZlZCBtZXNzYWdlOiBcIiR7cmVjZWl2ZWRfbWVzc2FnZS50ZXh0fVwiYCk7XG5cbiAgICByZXNwb25zZSA9IHByb2Nlc3NNZXNzYWdlKHNlbmRlcl9wc2lkLCByZWNlaXZlZF9tZXNzYWdlKTtcbiAgICAvLyBEZWZhdWx0IHJlc3BvbnNlIChmb3IgZGVidWdnaW5nKVxuICAgIC8vIENyZWF0ZSB0aGUgcGF5bG9hZCBmb3IgYSBiYXNpYyB0ZXh0IG1lc3NhZ2VcbiAgICAvLyByZXNwb25zZSA9IHtcbiAgICAvLyAgIHRleHQ6IGBZb3Ugc2VudCB0aGUgbWVzc2FnZTogXCIke3JlY2VpdmVkX21lc3NhZ2UudGV4dH1cIi5gXG4gICAgLy8gfTtcbiAgfSBlbHNlIHtcbiAgICByZXNwb25zZSA9IGRlZmF1bHRSZXNwb25zZTtcbiAgICAvLyAgICAgLy8gR2V0cyB0aGUgVVJMIG9mIHRoZSBtZXNzYWdlIGF0dGFjaG1lbnRcbiAgICAvLyAgICAgbGV0IGF0dGFjaG1lbnRfdXJsID0gcmVjZWl2ZWRfbWVzc2FnZS5hdHRhY2htZW50c1swXS5wYXlsb2FkLnVybDtcbiAgfVxuXG4gIC8vIFNlbmRzIHRoZSByZXNwb25zZSBtZXNzYWdlXG4gIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSk7XG59XG5cbi8vIEhhbmRsZXMgbWVzc2FnaW5nX3Bvc3RiYWNrcyBldmVudHNcbmZ1bmN0aW9uIGhhbmRsZVBvc3RiYWNrKHNlbmRlcl9wc2lkLCByZWNlaXZlZF9wb3N0YmFjaykge1xuICBsZXQgcmVzcG9uc2U7XG5cbiAgLy8gR2V0IHRoZSBwYXlsb2FkIGZvciB0aGUgcG9zdGJhY2tcbiAgbGV0IHBheWxvYWQgPSByZWNlaXZlZF9wb3N0YmFjay5wYXlsb2FkO1xuICBjb25zb2xlLmxvZyhgUmVjZWl2ZWQgcG9zdGJhY2s6IFwiJHtwYXlsb2FkfVwiYCk7XG5cbiAgbGV0IHBvc3RiYWNrX2ludGVudCA9IHBheWxvYWQuc3BsaXQoXCIgXCIpWzBdO1xuICBsZXQgcG9zdGJhY2tfY29udGVudCA9IHBheWxvYWQuc3Vic3RyaW5nKFxuICAgIHBheWxvYWQuaW5kZXhPZihcIiBcIikgKyAxLFxuICAgIHBheWxvYWQubGVuZ3RoXG4gICk7XG5cbiAgLy8gU2V0IHRoZSByZXNwb25zZSBiYXNlZCBvbiB0aGUgcG9zdGJhY2sgaW50ZW50XG4gIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiY2FydF9hZGRcIikge1xuICAgIC8vIEFkZCB0byBjYXJ0XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZUFkZENhcnRSZXNwb25zZShzZW5kZXJfcHNpZCwgcG9zdGJhY2tfY29udGVudCwgMSk7XG4gIH0gZWxzZSBpZiAocG9zdGJhY2tfaW50ZW50ID09PSBcImNhcnRfdmlld1wiKSB7XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpO1xuICB9IGVsc2UgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJlbnF1aXJ5X3Byb2R1Y3RcIikge1xuICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgYFdoYXQgd291bGQgeW91IGxpa2UgdG8ga25vdyBhYm91dCBvdXIgJHtwb3N0YmFja19jb250ZW50fT9gXG4gICAgKTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiY2hlY2tvdXRcIikge1xuICAgIHJlc3BvbnNlID0ge1xuICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImJ1dHRvblwiLFxuICAgICAgICAgIHRleHQ6IFwiQ2xpY2sgb24gdGhlIGJ1dHRvbiBiZWxvdyB0byBwYXkuXCIsXG4gICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBcIlBheVwiLFxuICAgICAgICAgICAgICBwYXlsb2FkOiBcInBhaWRcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gIH0gZWxzZSBpZiAocG9zdGJhY2tfaW50ZW50ID09PSBcInBhaWRcIikge1xuICAgIHJlc3BvbnNlID0ge1xuICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImJ1dHRvblwiLFxuICAgICAgICAgIHRleHQ6IFwiWW91ciBvcmRlciAob3JkZXIgbm8uKSBpcyBjb25maXJtZWQuXCIsXG4gICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBcIlZpZXcgUmVjZWlwdFwiLFxuICAgICAgICAgICAgICBwYXlsb2FkOiBcInJlY2VpcHRfdmlld1wiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwicmVjZWlwdF92aWV3XCIpIHtcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlKHNlbmRlcl9wc2lkKTtcbiAgfVxuXG4gIGlmIChyZXNwb25zZSA9PSBudWxsKSB7XG4gICAgcmVzcG9uc2UgPSBkZWZhdWx0UmVzcG9uc2UoKTtcbiAgfVxuXG4gIC8vIFNlbmQgdGhlIG1lc3NhZ2UgdG8gYWNrbm93bGVkZ2UgdGhlIHBvc3RiYWNrXG4gIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSk7XG59XG5cbi8vIFNlbmRzIHJlc3BvbnNlIG1lc3NhZ2VzIHZpYSB0aGUgU2VuZCBBUElcbmZ1bmN0aW9uIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSkge1xuICAvLyBVbmNvbW1lbnQgdG8gbG9nIHJlc3BvbnNlIG9iamVjdFxuICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cbiAgLy8gQ29uc3RydWN0IHRoZSBtZXNzYWdlIGJvZHlcbiAgbGV0IHJlcXVlc3RfYm9keSA9IHtcbiAgICByZWNpcGllbnQ6IHtcbiAgICAgIGlkOiBzZW5kZXJfcHNpZFxuICAgIH0sXG4gICAgbWVzc2FnZTogcmVzcG9uc2VcbiAgfTtcblxuICAvLyBTZW5kIHRoZSBIVFRQIHJlcXVlc3QgdG8gdGhlIE1lc3NlbmdlciBQbGF0Zm9ybVxuICByZXF1ZXN0KFxuICAgIHtcbiAgICAgIHVyaTogXCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92Mi42L21lL21lc3NhZ2VzXCIsXG4gICAgICBxczogeyBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOIH0sXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAganNvbjogcmVxdWVzdF9ib2R5XG4gICAgfSxcbiAgICAoZXJyLCByZXMsIGJvZHkpID0+IHtcbiAgICAgIGlmICghZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWVzc2FnZSBzZW50IVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gc2VuZCBtZXNzYWdlOlwiICsgZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5cbi8vIFByb2Nlc3MgdGV4dCBtZXNzYWdlIGFuZCByZXR1cm5zIHJlc3BvbnNlIG9iamVjdCB0byBoYW5kbGVNZXNzYWdlKClcbmZ1bmN0aW9uIHByb2Nlc3NNZXNzYWdlKHNlbmRlcl9wc2lkLCBtZXNzYWdlKSB7XG4gIC8vIE5MUDogaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9idWlsdC1pbi1ubHBcbiAgbGV0IGVudGl0aWVzID0gbWVzc2FnZS5ubHBbXCJlbnRpdGllc1wiXTtcblxuICAvLyBVbmNvbW1lbnQgdG8gdmlldyBhbGwgZW50aXRpZXMgYW5kIHRoZWlyIHhhbHVlc1xuICAvLyBPYmplY3Qua2V5cyhlbnRpdGllcykuZm9yRWFjaChrZXkgPT4ge1xuICAvLyAgIGNvbnNvbGUubG9nKFwiRW50aXR5OiBcIiArIGtleSk7XG4gIC8vICAgY29uc29sZS5sb2coZW50aXRpZXNba2V5XSk7XG4gIC8vIH0pO1xuXG4gIC8vIENoZWNrIGdyZWV0aW5nXG4gIGxldCBpc19ncmVldGluZyA9XG4gICAgZW50aXRpZXNbXCJncmVldGluZ3NcIl0gIT0gbnVsbCAmJlxuICAgIGVudGl0aWVzW1wiZ3JlZXRpbmdzXCJdWzBdW1wiY29uZmlkZW5jZVwiXSA+IDAuODsgLy8gR3JlZXRpbmcgdGhyZXNob2xkIHNldCB0byAwLjggKHN0cmljdGVyKVxuXG4gIC8vIFJldHJpZXZlIGZpcnN0IGludGVudCBvYmplY3RcbiAgbGV0IGludGVudCA9IGVudGl0aWVzW1wiaW50ZW50XCJdWzBdO1xuXG4gIGlmIChpbnRlbnRbXCJjb25maWRlbmNlXCJdID4gMC41KSB7XG4gICAgLy8gUHJvY2VzcyBpbnRlbnRcbiAgICBsZXQgaW50ZW50X3BhcnRzID0gaW50ZW50W1widmFsdWVcIl0uc3BsaXQoXCJfXCIpO1xuICAgIGxldCBpbnRlbnRfY2F0ZWdvcnkgPSBpbnRlbnRfcGFydHNbMF07XG4gICAgbGV0IGludGVudF9zdWJjYXRlZ29yeSA9IGludGVudF9wYXJ0cy5sZW5ndGggPiAxID8gaW50ZW50X3BhcnRzWzFdIDogbnVsbDtcbiAgICBsZXQgcmVzcG9uc2UgPSBudWxsO1xuXG4gICAgc3dpdGNoIChpbnRlbnRfY2F0ZWdvcnkpIHtcbiAgICAgIGNhc2UgXCJyZWNvbW1lbmRhdGlvblwiOlxuICAgICAgICAvLyBIYW5kbGUgcmVjb21tZW5kYXRpb25cbiAgICAgICAgLy8gcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgIC8vICAgXCJNZXNzYWdlIHJlY2VpdmVkIGlzIGEgcmVjb21tZW5kYXRpb24gbWVzc2FnZS5cIlxuICAgICAgICAvLyApO1xuXG4gICAgICAgIGxldCBwcm9kdWN0X3R5cGVzID0gW107XG4gICAgICAgIGlmIChlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUHJvY2Vzc2luZyBwcm9kdWN0IHR5cGVzXCIpO1xuICAgICAgICAgIHByb2R1Y3RfdHlwZXMgPSBlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXVxuICAgICAgICAgICAgLmZpbHRlcihvYmogPT4gb2JqW1wiY29uZmlkZW5jZVwiXSA+IDAuNSlcbiAgICAgICAgICAgIC5tYXAob2JqID0+IG9ialtcInZhbHVlXCJdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZShwcm9kdWN0X3R5cGVzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgXCJlbnF1aXJ5XCI6XG4gICAgICAgIC8vIEhhbmRsZSBlbnF1aXJ5XG4gICAgICAgIC8vIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAvLyAgIFwiTWVzc2FnZSByZWNlaXZlZCBpcyBhbiBlbnF1aXJ5IG1lc3NhZ2UuXCJcbiAgICAgICAgLy8gKTtcblxuICAgICAgICBpZiAoaW50ZW50X3N1YmNhdGVnb3J5ID09PSBcInByb2R1Y3RcIikge1xuICAgICAgICAgIC8vIFJldHJpZXZlIHByb2R1Y3QgYW5kIGF0dHJpYnV0ZSBmcm9tIGVudGl0aWVzIG9iamVjdFxuICAgICAgICAgIGlmIChlbnRpdGllc1tcInByb2R1Y3RcIl0gJiYgZW50aXRpZXNbXCJhdHRyaWJ1dGVcIl0pIHtcbiAgICAgICAgICAgIGxldCBwcm9kdWN0ID0gZW50aXRpZXNbXCJwcm9kdWN0XCJdWzBdO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZSA9IGVudGl0aWVzW1wiYXR0cmlidXRlXCJdWzBdO1xuICAgICAgICAgICAgLy8gVE9ETzogSGFuZGxlIHByb2R1Y3QgZW5xdWlyeVxuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVByb2R1Y3RFbnF1aXJ5UmVzcG9uc2UocHJvZHVjdCwgYXR0cmlidXRlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBkZWZhdWx0UmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJnZW5lcmFsXCIpIHtcbiAgICAgICAgICBsZXQgbWVzc2FnZXMgPSB7XG4gICAgICAgICAgICBwcm9maXQ6XG4gICAgICAgICAgICAgIFwiQWxsIG5ldCByZXZlbnVlIGVhcm5lZCBmcm9tIHRoZSBzYWxlIG9mIG91ciBwcm9kdWN0cyBhbmQgc2VydmljZXMgZ28gdG93YXJkcyBwYXlpbmcgYSBtb250aGx5IGFsbG93YW5jZSBmb3Igb3VyIGNsaWVudHMnIHdvcmssIGFzIHdlbGwgYXMgdGhlaXIgbHVuY2ggZXhwZW5zZXMgd2hpbGUgdW5kZXJnb2luZyB0cmFpbmluZy5cIixcbiAgICAgICAgICAgIG1hbnVmYWN0dXJlcjpcbiAgICAgICAgICAgICAgXCJXZSBzdXBwb3J0IGFkdWx0cyB3aXRoIGludGVsbGVjdHVhbCBkaXNhYmlsaXRpZXMuIFdlIHN0YXJ0ZWQgYSByYW5nZSBvZiBzb2NpYWwgZW50ZXJwcmlzZSBwcm9qZWN0cyB0byBwcm92aWRlIGFsdGVybmF0aXZlIHdvcmsgZW5nYWdlbWVudCBmb3Igb3VyIGFkdWx0IHRyYWluZWVzLlwiLFxuICAgICAgICAgICAgcHJvZHVjdHM6IFwiV2Ugc2VsbCBjcmFmdCBhbmQgYmFrZXIgZ29vZHMuXCJcbiAgICAgICAgICB9O1xuICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBtZXNzYWdlIGtleXMgKGVudGl0eSkgYW5kIGZpbmQgaWYgZW50aXR5IGlzIGluIGVudGl0aWVzXG4gICAgICAgICAgT2JqZWN0LmtleXMobWVzc2FnZXMpLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PSBudWxsICYmIGVudGl0aWVzW2VudGl0eV0pIHtcbiAgICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UobWVzc2FnZXNbZW50aXR5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaW50ZW50X3N1YmNhdGVnb3J5ID09PSBcImRlbGl2ZXJ5XCIpIHtcbiAgICAgICAgICBpZiAoZW50aXRpZXNbXCJzdGF0dXNcIl0pIHtcbiAgICAgICAgICAgIC8vIFRPRE86IE9yZGVyIHN0YXR1c1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiWW91ciBsYXRlc3Qgb3JkZXIgaXMgPHN0YXR1cz4uXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbnRpdGllc1tcImVzdGltYXRlZF9hcnJpdmFsXCJdKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBPcmRlciBlc3RpbWF0ZWQgYXJyaXZhbFxuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiVGhlIGF2ZXJhZ2UgZGVsaXZlcnkgdGltZSB0YWtlcyA1LTcgd29ya2luZyBkYXlzLiBZb3VyIG9yZGVyZWQgd2FzIHNlbnQgb24gPGRhdGU+LiBJdCBpcyBlc3RpbWF0ZWQgdG8gYXJyaXZlIG9uIDxkYXRlICsgNyB3b3JraW5nIGRheXM+LlwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZW50aXRpZXNbXCJjb3N0XCJdKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgICAgICAgICAgXCJJdCBpcyBhIGZsYXQgZmVlIG9mICQyIGZvciBldmVyeSBvcmRlci5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiV2UgZGVsaXZlciBpc2xhbmR3aWRlLiBUaGUgYXZlcmFnZSBkZWxpdmVyeSB0aW1lIHRha2VzIDUtNyB3b3JraW5nIGRheXMuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwiY2FydFwiOlxuICAgICAgICAvLyBIYW5kbGUgc2hvcHBpbmcgY2FydFxuICAgICAgICAvLyByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgICAgLy8gICBcIk1lc3NhZ2UgcmVjZWl2ZWQgaXMgYSBjYXJ0IG1lc3NhZ2UuXCJcbiAgICAgICAgLy8gKTtcblxuICAgICAgICBpZiAoaW50ZW50X3N1YmNhdGVnb3J5ID09PSBcImFkZFwiICYmIGVudGl0aWVzW1wicHJvZHVjdFwiXSkge1xuICAgICAgICAgIGxldCBwcm9kdWN0X25hbWUgPSBlbnRpdGllc1tcInByb2R1Y3RcIl1bMF1bXCJ2YWx1ZVwiXTtcbiAgICAgICAgICBsZXQgcXVhbnRpdHkgPSBlbnRpdGllc1tcIm51bWJlclwiXVxuICAgICAgICAgICAgPyBlbnRpdGllc1tcIm51bWJlclwiXVswXVtcInZhbHVlXCJdXG4gICAgICAgICAgICA6IDE7XG4gICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZUFkZENhcnRSZXNwb25zZShcbiAgICAgICAgICAgIHNlbmRlcl9wc2lkLFxuICAgICAgICAgICAgcHJvZHVjdF9uYW1lLFxuICAgICAgICAgICAgcXVhbnRpdHlcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJ2aWV3XCIpIHtcbiAgICAgICAgICByZXNwb25zZSA9IGdlbmVyYXRlVmlld0NhcnRSZXNwb25zZShzZW5kZXJfcHNpZCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlc3BvbnNlID0gZGVmYXVsdFJlc3BvbnNlO1xuICAgIH1cblxuICAgIHJlc3BvbnNlID0gcmVzcG9uc2UgPT0gbnVsbCA/IGRlZmF1bHRSZXNwb25zZSA6IHJlc3BvbnNlO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfSBlbHNlIGlmIChpc19ncmVldGluZykge1xuICAgIC8vIE1lc3NhZ2UgaGFzIG5vIGludGVudCwganVzdCBncmVldGluZ1xuICAgIC8vIFRPRE86IEFkZCBxdWljayByZXBsaWVzIG9mIGNoYXRib3QgZnVuY3Rpb25hbGl0aWVzIChyZWNvbW1lbmRhdGlvbnMsIGNoZWNrIG9yZGVyIHN0YXR1cywgZXRjLilcbiAgICByZXR1cm4gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgXCJIaSB0aGVyZSEgV2VsY29tZSB0byBNSU5EUy4gSG93IGNhbiBJIGhlbHAgeW91P1wiXG4gICAgKTtcbiAgfVxuXG4gIC8vIE5vIGludGVudCBub3IgZ3JlZXRpbmdcbiAgcmV0dXJuIGRlZmF1bHRSZXNwb25zZTtcbn1cblxuLy8gV3JhcHBlciBtZXRob2QgdG8gY29udmVydCB0ZXh0IG1lc3NhZ2Ugc3RyaW5nIHRvIHJlc3BvbnNlIG9iamVjdFxuZnVuY3Rpb24gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKG1lc3NhZ2UpIHtcbiAgcmV0dXJuIHtcbiAgICB0ZXh0OiBtZXNzYWdlXG4gIH07XG59XG5cbi8vIFJlc3BvbnNlIG9uIGdlbmVyaWMgdGVtcGxhdGUgY2Fyb3VzZWwgZm9yIHJlY29tbWVuZGF0aW9uc1xuZnVuY3Rpb24gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZShwcm9kdWN0X3R5cGVzKSB7XG4gIC8vIFRPRE86IFJldHJpZXZlIHByb2R1Y3RzIHRvIHJlY29tbWVuZCBiYXNlZCBvbiBsaXN0IG9mIHByb2R1Y3QgdHlwZXMuIElmIHByb2R1Y3QgdHlwZXMgaXMgYW4gZW1wdHkgYXJyYXksIHJlY29tbWVuZCBwcm9kdWN0cyBvZiB2YXJpb3VzIHR5cGVzXG4gIGxldCBwcm9kdWN0cyA9IFtcbiAgICB7XG4gICAgICBpZDogMSxcbiAgICAgIG5hbWU6IFwiRGFyayBDaG9jb2xhdGUgT2F0bWVhbCBDb29raWVzXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCIsXG4gICAgICBhdHRyaWJ1dGU6IHtcbiAgICAgICAgYWxsZWdlbnM6IFtcImVnZ3NcIiwgXCJudXRcIl0sXG4gICAgICAgIGNvbG91cjogbnVsbFxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IDIsXG4gICAgICBuYW1lOiBcIkNyYW5iZXJyeSBTd2VldGhlYXJ0IENvb2tpZXMgKEVnZ2xlc3MpXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIlxuICAgIH1cbiAgXTtcblxuICBsZXQgcmVzcG9uc2UgPSB7XG4gICAgYXR0YWNobWVudDoge1xuICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImdlbmVyaWNcIixcbiAgICAgICAgZWxlbWVudHM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IHByb2R1Y3RbXCJuYW1lXCJdLFxuICAgICAgICAgICAgc3VidGl0bGU6IGAkJHtwcm9kdWN0W1wicHJpY2VcIl19YCxcbiAgICAgICAgICAgIGltYWdlX3VybDogcHJvZHVjdFtcInVybFwiXSxcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJMZWFybiBNb3JlXCIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogYGVucXVpcnlfcHJvZHVjdCAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJBZGQgdG8gQ2FydFwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBjYXJ0X2FkZCAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIGNvbmZpcm1hdGlvbiBvZiBwcm9kdWN0IGFkZGVkIHRvIGNhcnQgYW5kIHF1aWNrIHJlcGxpZXNcbmZ1bmN0aW9uIGdlbmVyYXRlQWRkQ2FydFJlc3BvbnNlKHNlbmRlcl9wc2lkLCBwcm9kdWN0X25hbWUsIHF1YW50aXR5KSB7XG4gIC8vIFRPRE86IEFkZCBwcm9kdWN0IHRvIGNhcnQgaW4gZGJcblxuICByZXR1cm4ge1xuICAgIHRleHQ6IGBBZGRlZCAke3F1YW50aXR5fSAke3Byb2R1Y3RfbmFtZX0gdG8gY2FydC5gLFxuICAgIHF1aWNrX3JlcGxpZXM6IFtcbiAgICAgIHtcbiAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgdGl0bGU6IFwiVmlldyBDYXJ0XCIsXG4gICAgICAgIHBheWxvYWQ6IGBjYXJ0X3ZpZXdgXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICB0aXRsZTogXCJDaGVja291dFwiLFxuICAgICAgICBwYXlsb2FkOiBgY2hlY2tvdXRgXG4gICAgICB9XG4gICAgXVxuICB9O1xufVxuXG4vLyBSZXNwb25zZSBvbiBnZW5lcmljIHRlbXBsYXRlIGNhcm91c2VsIGZvciBjYXJ0XG5mdW5jdGlvbiBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpIHtcbiAgLy8gVE9ETzogR2V0IGNhcnQgZnJvbSBkYlxuICBsZXQgcHJvZHVjdHMgPSBbXG4gICAge1xuICAgICAgaWQ6IDEsXG4gICAgICBuYW1lOiBcIkRhcmsgQ2hvY29sYXRlIE9hdG1lYWwgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAyLFxuICAgICAgbmFtZTogXCJDcmFuYmVycnkgU3dlZXRoZWFydCBDb29raWVzIChFZ2dsZXNzKVwiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIixcbiAgICAgIHF1YW50aXR5OiAxXG4gICAgfVxuICBdO1xuICBsZXQgcmVzcG9uc2UgPSB7XG4gICAgYXR0YWNobWVudDoge1xuICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImdlbmVyaWNcIixcbiAgICAgICAgZWxlbWVudHM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IHByb2R1Y3RbXCJuYW1lXCJdLFxuICAgICAgICAgICAgc3VidGl0bGU6IGBRdHk6ICR7cHJvZHVjdFtcInF1YW50aXR5XCJdfSAoJCR7cHJvZHVjdFtcInByaWNlXCJdfSBlYWNoKWAsXG4gICAgICAgICAgICBpbWFnZV91cmw6IHByb2R1Y3RbXCJ1cmxcIl0sXG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQWRkIDFcIixcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiBgY2FydF9hZGQgJHtwcm9kdWN0W1wibmFtZVwiXX1gXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiUmVtb3ZlIEFsbFwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBjYXJ0X3JlbW92ZSAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIHJlY2VpcHQgdGVtcGxhdGUgZm9yIGxhdGVzdCBjb25maXJtZWQgb3JkZXJcbmZ1bmN0aW9uIGdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlKHNlbmRlcl9wc2lkKSB7XG4gIC8vIFRPRE86IEdldCBsYXRlc3Qgb3JkZXIgZnJvbSBkYXRhYmFzZVxuICBsZXQgcHJvZHVjdHMgPSBbXG4gICAge1xuICAgICAgaWQ6IDEsXG4gICAgICBuYW1lOiBcIkRhcmsgQ2hvY29sYXRlIE9hdG1lYWwgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAyLFxuICAgICAgbmFtZTogXCJDcmFuYmVycnkgU3dlZXRoZWFydCBDb29raWVzIChFZ2dsZXNzKVwiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIixcbiAgICAgIHF1YW50aXR5OiAxXG4gICAgfVxuICBdO1xuXG4gIGxldCByZXNwb25zZSA9IHtcbiAgICBhdHRhY2htZW50OiB7XG4gICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIHRlbXBsYXRlX3R5cGU6IFwicmVjZWlwdFwiLFxuICAgICAgICByZWNpcGllbnRfbmFtZTogXCI8bmFtZT5cIixcbiAgICAgICAgb3JkZXJfbnVtYmVyOiBcIjxvcmRlcl9udW1iZXI+XCIsXG4gICAgICAgIGN1cnJlbmN5OiBcIlNHRFwiLFxuICAgICAgICBwYXltZW50X21ldGhvZDogXCJQYXlQYWxcIixcbiAgICAgICAgXCJvcmRlcl91cmxcIjpcImh0dHA6Ly9wZXRlcnNhcHBhcmVsLnBhcnNlYXBwLmNvbS9vcmRlcj9vcmRlcl9pZD0xMjM0NTZcIixcbiAgICAgICAgXCJ0aW1lc3RhbXBcIjpcIjE0Mjg0NDQ4NTJcIixcbiAgICAgICAgXCJhZGRyZXNzXCI6e1xuICAgICAgICAgIFwic3RyZWV0XzFcIjpcIjEgSGFja2VyIFdheVwiLFxuICAgICAgICAgIFwic3RyZWV0XzJcIjpcIlwiLFxuICAgICAgICAgIFwiY2l0eVwiOlwiTWVubG8gUGFya1wiLFxuICAgICAgICAgIFwicG9zdGFsX2NvZGVcIjpcIjk0MDI1XCIsXG4gICAgICAgICAgXCJzdGF0ZVwiOlwiQ0FcIixcbiAgICAgICAgICBcImNvdW50cnlcIjpcIlVTXCJcbiAgICAgICAgfSxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHN1YnRvdGFsOiA3NS4wIC8vLFxuICAgICAgICAgIC8vIFwic2hpcHBpbmdfY29zdFwiOjQuOTUsXG4gICAgICAgICAgLy8gXCJ0b3RhbF90YXhcIjo2LjE5LFxuICAgICAgICAgIC8vIFwidG90YWxfY29zdFwiOjU2LjE0XG4gICAgICAgIH0sXG4gICAgICAgIGVsZW1lbnRzOiBwcm9kdWN0cy5tYXAocHJvZHVjdCA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRpdGxlOiBgJHtwcm9kdWN0W1wibmFtZVwiXX1gLFxuICAgICAgICAgICAgc3VidGl0bGU6IFwiXCIsXG4gICAgICAgICAgICBxdWFudGl0eTogcHJvZHVjdFtcInF1YW50aXR5XCJdLFxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3RbXCJwcmljZVwiXSxcbiAgICAgICAgICAgIGN1cnJlbmN5OiBcIlNHRFwiLFxuICAgICAgICAgICAgaW1hZ2VfdXJsOiBwcm9kdWN0W1widXJsXCJdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG4vLyBSZXNwb25zZSBvbiBwcm9kb2R1Y3QgZW5xdWlyeVxuZnVuY3Rpb24gZ2VuZXJhdGVQcm9kdWN0RW5xdWlyeVJlc3BvbnNlKHByb2R1Y3QsIGF0dHJpYnV0ZSkge1xuICAvLyBUT0RPOiBHZXQgcHJvZHVjdCBmcm9tIGRiLCBjcmVhdGUgbWVzc2FnZSBhbmQgZ2VuZXJhdGUgcmVzcG9uc2VcbiAgcmV0dXJuIGRlZmF1bHRSZXNwb25zZTtcbn1cbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "express",
        "require",
        "bodyParser",
        "app",
        "use",
        "json",
        "request",
        "PAGE_ACCESS_TOKEN",
        "process",
        "env",
        "listen",
        "console",
        "log",
        "get",
        "req",
        "res",
        "VERIFY_TOKEN",
        "mode",
        "query",
        "token",
        "challenge",
        "status",
        "send",
        "sendStatus",
        "post",
        "body",
        "object",
        "entry",
        "forEach",
        "webhook_event",
        "messaging",
        "sender_psid",
        "sender",
        "id",
        "message",
        "quick_reply",
        "handlePostback",
        "handleMessage",
        "postback",
        "defaultResponse",
        "generateResponseFromMessage",
        "received_message",
        "response",
        "text",
        "processMessage",
        "callSendAPI",
        "received_postback",
        "payload",
        "postback_intent",
        "split",
        "postback_content",
        "substring",
        "indexOf",
        "length",
        "generateAddCartResponse",
        "generateViewCartResponse",
        "attachment",
        "type",
        "template_type",
        "buttons",
        "title",
        "generateReceiptResponse",
        "request_body",
        "recipient",
        "uri",
        "qs",
        "access_token",
        "method",
        "err",
        "error",
        "entities",
        "nlp",
        "is_greeting",
        "intent",
        "intent_parts",
        "intent_category",
        "intent_subcategory",
        "product_types",
        "filter",
        "obj",
        "map",
        "generateRecommendationsResponse",
        "product",
        "attribute",
        "generateProductEnquiryResponse",
        "messages",
        "profit",
        "manufacturer",
        "products",
        "Object",
        "keys",
        "entity",
        "product_name",
        "quantity",
        "name",
        "price",
        "url",
        "allegens",
        "colour",
        "elements",
        "subtitle",
        "image_url",
        "quick_replies",
        "content_type",
        "recipient_name",
        "order_number",
        "currency",
        "payment_method",
        "summary",
        "subtotal"
      ],
      "mappings": "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",
      "file": "index.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\nconst express = require(\"express\"),\n  bodyParser = require(\"body-parser\"),\n  app = express().use(bodyParser.json()); // creates express http server\nconst request = require(\"request\");\n\n// import { checkUser, createUser } from './DBConn';\n\n// Get page access token\nconst PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Sets server port and logs message on success\napp.listen(3000, () => console.log(\"webhook is listening\"));\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", (req, res) => {\n  let VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  let mode = req.query[\"hub.mode\"];\n  let token = req.query[\"hub.verify_token\"];\n  let challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", (req, res) => {\n  let body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function(entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      let webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      let sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        // getName(sender_psid, function(response){\n        //     checkUser(sender_psid,response);\n        // });\n        if (webhook_event.message.quick_reply) {\n          handlePostback(sender_psid, webhook_event.message.quick_reply);\n        } else {\n          handleMessage(sender_psid, webhook_event.message);\n        }\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\n// Gets users name from facebook graph api\n// function getName(sender_psid,callback){\n//     var name = \"Empty\";\n//     request({\n//         url:\"https://graph.facebook.com/v3.3/\" + sender_psid,\n//         qs:{\n//             access_token: PAGE_ACCESS_TOKEN,\n//             fields: \"first_name\",\n//         },\n//         method:\"GET\"\n//     }, function(error,response,body){\n//         if (error){\n//             console.log(error)\n//         }else{\n//             var bodyObj = JSON.parse(body);\n//             name = bodyObj.first_name;\n//             console.log(\"Name: \" + name);\n//             return callback(name)\n//         }\n//     });\n//     return name;\n// }\n\nlet defaultResponse = generateResponseFromMessage(\n  \"We could not understand your message. Kindly rephrase your message and send us again.\"\n);\n\n// Handles messages events\nfunction handleMessage(sender_psid, received_message) {\n  let response;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(`Received message: \"${received_message.text}\"`);\n\n    response = processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  let response;\n\n  // Get the payload for the postback\n  let payload = received_postback.payload;\n  console.log(`Received postback: \"${payload}\"`);\n\n  let postback_intent = payload.split(\" \")[0];\n  let postback_content = payload.substring(\n    payload.indexOf(\" \") + 1,\n    payload.length\n  );\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\n      `What would you like to know about our ${postback_content}?`\n    );\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [\n            {\n              type: \"postback\",\n              title: \"Pay\",\n              payload: \"paid\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [\n            {\n              type: \"postback\",\n              title: \"View Receipt\",\n              payload: \"receipt_view\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  let request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request(\n    {\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    },\n    (err, res, body) => {\n      if (!err) {\n        console.log(\"Message sent!\");\n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    }\n  );\n}\n\n// Process text message and returns response object to handleMessage()\nfunction processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  let entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  // Object.keys(entities).forEach(key => {\n  //   console.log(\"Entity: \" + key);\n  //   console.log(entities[key]);\n  // });\n\n  // Check greeting\n  let is_greeting =\n    entities[\"greetings\"] != null &&\n    entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  let intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    let intent_parts = intent[\"value\"].split(\"_\");\n    let intent_category = intent_parts[0];\n    let intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    let response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        let product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"]\n            .filter(obj => obj[\"confidence\"] > 0.5)\n            .map(obj => obj[\"value\"]);\n        }\n\n        response = generateRecommendationsResponse(product_types);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"attribute\"]) {\n            let product = entities[\"product\"][0];\n            let attribute = entities[\"attribute\"][0];\n            // TODO: Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          let messages = {\n            profit:\n              \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer:\n              \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(entity => {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\n              \"Your latest order is <status>.\"\n            );\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\n              \"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\"\n            );\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\n              \"It is a flat fee of $2 for every order.\"\n            );\n          } else {\n            response = generateResponseFromMessage(\n              \"We deliver islandwide. The average delivery time takes 5-7 working days.\"\n            );\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          let product_name = entities[\"product\"][0][\"value\"];\n          let quantity = entities[\"number\"]\n            ? entities[\"number\"][0][\"value\"]\n            : 1;\n          response = generateAddCartResponse(\n            sender_psid,\n            product_name,\n            quantity\n          );\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\n      \"Hi there! Welcome to MINDS. How can I help you?\"\n    );\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nfunction generateRecommendationsResponse(product_types) {\n  // TODO: Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      attribute: {\n        allegens: [\"eggs\", \"nut\"],\n        colour: null\n      }\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n    }\n  ];\n\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"name\"],\n            subtitle: `$${product[\"price\"]}`,\n            image_url: product[\"url\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Learn More\",\n                payload: `enquiry_product ${product[\"name\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Add to Cart\",\n                payload: `cart_add ${product[\"name\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: `Added ${quantity} ${product_name} to cart.`,\n    quick_replies: [\n      {\n        content_type: \"text\",\n        title: \"View Cart\",\n        payload: `cart_view`\n      },\n      {\n        content_type: \"text\",\n        title: \"Checkout\",\n        payload: `checkout`\n      }\n    ]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"name\"],\n            subtitle: `Qty: ${product[\"quantity\"]} ($${product[\"price\"]} each)`,\n            image_url: product[\"url\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Add 1\",\n                payload: `cart_add ${product[\"name\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Remove All\",\n                payload: `cart_remove ${product[\"name\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<name>\",\n        order_number: \"<order_number>\",\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        \"order_url\":\"http://petersapparel.parseapp.com/order?order_id=123456\",\n        \"timestamp\":\"1428444852\",\n        \"address\":{\n          \"street_1\":\"1 Hacker Way\",\n          \"street_2\":\"\",\n          \"city\":\"Menlo Park\",\n          \"postal_code\":\"94025\",\n          \"state\":\"CA\",\n          \"country\":\"US\"\n        },\n        summary: {\n          subtotal: 75.0 //,\n          // \"shipping_cost\":4.95,\n          // \"total_tax\":6.19,\n          // \"total_cost\":56.14\n        },\n        elements: products.map(product => {\n          return {\n            title: `${product[\"name\"]}`,\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return defaultResponse;\n}\n"
      ]
    },
    "mtime": 1592462882000
  }
}
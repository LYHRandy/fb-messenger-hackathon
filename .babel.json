{
  "{\"filename\":\"/app/index.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [
          {
            "source": "./DBConn",
            "imported": [
              "getAllProducts",
              "getProductsByType",
              "getProductByID",
              "getProductPrice",
              "getProductDesc",
              "getProductsByName",
              "getProductByNameVar",
              "checkUser",
              "createUser"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "getAllProducts",
                "local": "getAllProducts"
              },
              {
                "kind": "named",
                "imported": "getProductsByType",
                "local": "getProductsByType"
              },
              {
                "kind": "named",
                "imported": "getProductByID",
                "local": "getProductByID"
              },
              {
                "kind": "named",
                "imported": "getProductPrice",
                "local": "getProductPrice"
              },
              {
                "kind": "named",
                "imported": "getProductDesc",
                "local": "getProductDesc"
              },
              {
                "kind": "named",
                "imported": "getProductsByName",
                "local": "getProductsByName"
              },
              {
                "kind": "named",
                "imported": "getProductByNameVar",
                "local": "getProductByNameVar"
              },
              {
                "kind": "named",
                "imported": "checkUser",
                "local": "checkUser"
              },
              {
                "kind": "named",
                "imported": "createUser",
                "local": "createUser"
              }
            ]
          },
          {
            "source": "./fbhelper",
            "imported": [
              "getName",
              "getProductDetails"
            ],
            "specifiers": [
              {
                "kind": "named",
                "imported": "getName",
                "local": "getName"
              },
              {
                "kind": "named",
                "imported": "getProductDetails",
                "local": "getProductDetails"
              }
            ]
          }
        ],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/index.js",
      "filenameRelative": "/app/index.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "index.js",
      "sourceFileName": "index.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "index"
    },
    "ignored": false,
    "code": "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\n\nvar _DBConn = require(\"./DBConn\");\n\nvar _fbhelper = require(\"./fbhelper\");\n\nvar express = require(\"express\"),\n    bodyParser = require(\"body-parser\"),\n    app = express().use(bodyParser.json()); // creates express http server\nvar request = require(\"request\");\nvar dotenv = require('dotenv');\nvar crypto = require('crypto');\nvar mongoose = require('mongoose');\ndotenv.config();\n\n// Get page access token\nvar PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Setup to connect to DB\nvar DB_PASSWORD = process.env.DB_PASSWORD;\nmongoose.connect('mongodb+srv://mongoadmin:' + DB_PASSWORD + '@fb-hack-chatbot-cevnk.mongodb.net/fbmsg', { useNewUrlParser: true, useCreateIndex: true, useFindAndModify: false }).then(function () {\n  return console.log(\"DB Connection successful\");\n});\nmongoose.Promise = global.Promise;\n\n// Get page access token\nvar FB_APP_SECRET = process.env.FB_APP_SECRET;\nvar appsecret_proof = crypto.createHmac('sha256', FB_APP_SECRET).update(PAGE_ACCESS_TOKEN).digest('hex');\n\n// Sets server port and logs message on success\napp.listen(3000, function () {\n  return console.log(\"webhook is listening\");\n});\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", function (req, res) {\n  var VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  var mode = req.query[\"hub.mode\"];\n  var token = req.query[\"hub.verify_token\"];\n  var challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// For testing endpoints\napp.get(\"/test\", function (req, res) {\n  var body = req.body;\n  // getAllProducts().then(function(products){\n  // console.log(products);\n  // });\n  // getProductByType(\"Baker\").then(function(products){\n  // console.log(products);\n  // });\n  // getProductByID('3060724697352196').then(function(prod){\n  // console.log(prod);\n  // });\n  // getProductPrice('3060724697352196').then(function(price){\n  // console.log(price);\n  // });\n  // getProductDesc('3060724697352196').then(function(description){\n  // console.log(description);\n  // });\n  // getProductsByName('Earl Grey Sunflower Seeds Cookies').then(function(prod){\n  // console.log(prod);\n  // });\n  // getProductByNameVar('Earl Grey Sunflower Seeds Cookies','Gift box').then(function(prod){\n  //     console.log(prod);\n  // });\n  res.status(200).send(\"Success\");\n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", function (req, res) {\n  var body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function (entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      var webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      var sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        if (webhook_event.message.quick_reply) {\n          handlePostback(sender_psid, webhook_event.message.quick_reply);\n        } else {\n          handleMessage(sender_psid, webhook_event.message);\n        }\n\n        (0, _fbhelper.getName)(PAGE_ACCESS_TOKEN, sender_psid, function (response) {\n          (0, _DBConn.checkUser)(sender_psid, response).then(function (user) {\n            if (user.length == 0) {\n              (0, _DBConn.createUser)(sender_psid, response);\n            }\n          });\n        });\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\nvar defaultResponse = generateResponseFromMessage(\"We could not understand your message. Kindly rephrase your message and send us again.\");\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", function (req, res) {\n  var VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  var mode = req.query[\"hub.mode\"];\n  var token = req.query[\"hub.verify_token\"];\n  var challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Handles messages events\nasync function handleMessage(sender_psid, received_message) {\n  var response = void 0;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(\"Received message: \\\"\" + received_message.text + \"\\\"\");\n\n    response = await processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  var response = void 0;\n\n  // Get the payload for the postback\n  var payload = received_postback.payload;\n  console.log(\"Received postback: \\\"\" + payload + \"\\\"\");\n\n  var postback_intent = payload.split(\" \")[0];\n  var postback_content = payload.substring(payload.indexOf(\" \") + 1, payload.length);\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\"What would you like to know about our \" + postback_content + \"?\");\n  } else if (postback_intent === \"enquiry_product_attribute\") {\n    var attribute = postback_content.substring(0, postback_content.indexOf(\" \") + 1);\n    var product = postback_content.substring(postback_content.indexOf(\" \") + 1, postback_content.length);\n    response = generateProductEnquiryResponse(product, attribute);\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [{\n            type: \"postback\",\n            title: \"Pay\",\n            payload: \"paid\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [{\n            type: \"postback\",\n            title: \"View Receipt\",\n            payload: \"receipt_view\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  var request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request({\n    uri: \"https://graph.facebook.com/v2.6/me/messages\",\n    qs: { access_token: PAGE_ACCESS_TOKEN },\n    method: \"POST\",\n    json: request_body\n  }, function (err, res, body) {\n    if (!err) {\n      console.log(\"Message sent!\");\n    } else {\n      console.error(\"Unable to send message:\" + err);\n    }\n  });\n}\n\n// Process text message and returns response object to handleMessage()\nfunction processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  var entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  Object.keys(entities).forEach(function (key) {\n    console.log(\"Entity: \" + key);\n    console.log(entities[key]);\n  });\n\n  // Check greeting\n  var is_greeting = entities[\"greetings\"] != null && entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  var intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    var intent_parts = intent[\"value\"].split(\"_\");\n    var intent_category = intent_parts[0];\n    var intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    var response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        var product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"].filter(function (obj) {\n            return obj[\"confidence\"] > 0.5;\n          }).map(function (obj) {\n            return obj[\"value\"];\n          });\n        }\n\n        response = generateRecommendationsResponse(product_types);\n        console.log(response);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"product_attribute\"]) {\n            var product = entities[\"product\"][0][\"value\"];\n            var attribute = entities[\"product_attribute\"][0][\"value\"];\n            // Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else if (entities[\"product_type\"] && entities[\"product_attribute\"]) {\n            // Handle product type enquiry\n            var product_type = entities[\"product_type\"][0][\"value\"];\n            var _attribute = entities[\"product_attribute\"][0][\"value\"];\n            response = generateProductTypeEnquiryResponse(product_type, _attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          var messages = {\n            profit: \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer: \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(function (entity) {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\"Your latest order is <status>.\");\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\");\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\"It is a flat fee of $2 for every order.\");\n          } else {\n            response = generateResponseFromMessage(\"We deliver islandwide. The average delivery time takes 5-7 working days.\");\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          var product_name = entities[\"product\"][0][\"value\"];\n          var quantity = entities[\"number\"] ? entities[\"number\"][0][\"value\"] : 1;\n          response = generateAddCartResponse(sender_psid, product_name, quantity);\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\"Hi there! Welcome to Bright. How can I help you?\");\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nasync function generateRecommendationsResponse(product_types) {\n  // Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  var products = void 0;\n\n  if (product_types.length === 0) {\n    products = await (0, _DBConn.getAllProducts)();\n  } else {\n    products = await (0, _DBConn.getProductsByType)(product_types[0]);\n  }\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"title\"],\n            subtitle: \"$\" + product[\"price\"],\n            image_url: product[\"image_link\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Learn More\",\n              payload: \"enquiry_product \" + product[\"title\"]\n            }, {\n              type: \"postback\",\n              title: \"Add to Cart\",\n              payload: \"cart_add \" + product[\"title\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: \"Added \" + quantity + \" \" + product_name + \" to cart.\",\n    quick_replies: [{\n      content_type: \"text\",\n      title: \"View Cart\",\n      payload: \"cart_view\"\n    }, {\n      content_type: \"text\",\n      title: \"Checkout\",\n      payload: \"checkout\"\n    }]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"name\"],\n            subtitle: \"Qty: \" + product[\"quantity\"] + \" ($\" + product[\"price\"] + \" each)\",\n            image_url: product[\"url\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Add 1\",\n              payload: \"cart_add \" + product[\"name\"]\n            }, {\n              type: \"postback\",\n              title: \"Remove All\",\n              payload: \"cart_remove \" + product[\"name\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<CUSTOMER_NAME>\", // Mandatory field\n        order_number: \"<ORDER_NUMBER>\", // Mandatory field\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        order_url: \"\",\n        address: {\n          street_1: \"9 Straits View\", // Mandatory field\n          city: \"Singapore\",\n          postal_code: \"018937\",\n          state: \"SG\",\n          country: \"SG\"\n        },\n        summary: {\n          subtotal: 10,\n          shipping_cost: 5,\n          total_tax: 2,\n          total_cost: 15\n        },\n        elements: products.map(function (product) {\n          return {\n            title: \"\" + product[\"name\"],\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return generateResponseFromMessage(\"You are enquiring about the \" + attribute + \" of \" + product);\n}\n\n// Response on prododuct enquiry\nasync function generateProductTypeEnquiryResponse(product_type, attribute) {\n  // TODO: Get product from db, create message and generate response\n  var products = await (0, _DBConn.getProductsByType)(product_type);\n  return {\n    text: \"Which product are you enquiring about its \" + attribute + \"?\",\n    quick_replies: products.map(function (product) {\n      return {\n        content_type: \"text\",\n        title: product.title,\n        payload: \"enquiry_product_attribute \" + attribute + \" \" + product.title\n      };\n    })\n  };\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYm9keVBhcnNlciIsImFwcCIsInVzZSIsImpzb24iLCJyZXF1ZXN0IiwiZG90ZW52IiwiY3J5cHRvIiwibW9uZ29vc2UiLCJjb25maWciLCJQQUdFX0FDQ0VTU19UT0tFTiIsInByb2Nlc3MiLCJlbnYiLCJEQl9QQVNTV09SRCIsImNvbm5lY3QiLCJ1c2VOZXdVcmxQYXJzZXIiLCJ1c2VDcmVhdGVJbmRleCIsInVzZUZpbmRBbmRNb2RpZnkiLCJ0aGVuIiwiY29uc29sZSIsImxvZyIsIlByb21pc2UiLCJnbG9iYWwiLCJGQl9BUFBfU0VDUkVUIiwiYXBwc2VjcmV0X3Byb29mIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsImxpc3RlbiIsImdldCIsInJlcSIsInJlcyIsIlZFUklGWV9UT0tFTiIsIm1vZGUiLCJxdWVyeSIsInRva2VuIiwiY2hhbGxlbmdlIiwic3RhdHVzIiwic2VuZCIsInNlbmRTdGF0dXMiLCJib2R5IiwicG9zdCIsIm9iamVjdCIsImVudHJ5IiwiZm9yRWFjaCIsIndlYmhvb2tfZXZlbnQiLCJtZXNzYWdpbmciLCJzZW5kZXJfcHNpZCIsInNlbmRlciIsImlkIiwibWVzc2FnZSIsInF1aWNrX3JlcGx5IiwiaGFuZGxlUG9zdGJhY2siLCJoYW5kbGVNZXNzYWdlIiwicmVzcG9uc2UiLCJ1c2VyIiwibGVuZ3RoIiwicG9zdGJhY2siLCJkZWZhdWx0UmVzcG9uc2UiLCJnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UiLCJyZWNlaXZlZF9tZXNzYWdlIiwidGV4dCIsInByb2Nlc3NNZXNzYWdlIiwiY2FsbFNlbmRBUEkiLCJyZWNlaXZlZF9wb3N0YmFjayIsInBheWxvYWQiLCJwb3N0YmFja19pbnRlbnQiLCJzcGxpdCIsInBvc3RiYWNrX2NvbnRlbnQiLCJzdWJzdHJpbmciLCJpbmRleE9mIiwiZ2VuZXJhdGVBZGRDYXJ0UmVzcG9uc2UiLCJnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2UiLCJhdHRyaWJ1dGUiLCJwcm9kdWN0IiwiZ2VuZXJhdGVQcm9kdWN0RW5xdWlyeVJlc3BvbnNlIiwiYXR0YWNobWVudCIsInR5cGUiLCJ0ZW1wbGF0ZV90eXBlIiwiYnV0dG9ucyIsInRpdGxlIiwiZ2VuZXJhdGVSZWNlaXB0UmVzcG9uc2UiLCJyZXF1ZXN0X2JvZHkiLCJyZWNpcGllbnQiLCJ1cmkiLCJxcyIsImFjY2Vzc190b2tlbiIsIm1ldGhvZCIsImVyciIsImVycm9yIiwiZW50aXRpZXMiLCJubHAiLCJPYmplY3QiLCJrZXlzIiwia2V5IiwiaXNfZ3JlZXRpbmciLCJpbnRlbnQiLCJpbnRlbnRfcGFydHMiLCJpbnRlbnRfY2F0ZWdvcnkiLCJpbnRlbnRfc3ViY2F0ZWdvcnkiLCJwcm9kdWN0X3R5cGVzIiwiZmlsdGVyIiwib2JqIiwibWFwIiwiZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZSIsInByb2R1Y3RfdHlwZSIsImdlbmVyYXRlUHJvZHVjdFR5cGVFbnF1aXJ5UmVzcG9uc2UiLCJtZXNzYWdlcyIsInByb2ZpdCIsIm1hbnVmYWN0dXJlciIsInByb2R1Y3RzIiwiZW50aXR5IiwicHJvZHVjdF9uYW1lIiwicXVhbnRpdHkiLCJlbGVtZW50cyIsInN1YnRpdGxlIiwiaW1hZ2VfdXJsIiwicXVpY2tfcmVwbGllcyIsImNvbnRlbnRfdHlwZSIsIm5hbWUiLCJwcmljZSIsInVybCIsInJlY2lwaWVudF9uYW1lIiwib3JkZXJfbnVtYmVyIiwiY3VycmVuY3kiLCJwYXltZW50X21ldGhvZCIsIm9yZGVyX3VybCIsImFkZHJlc3MiLCJzdHJlZXRfMSIsImNpdHkiLCJwb3N0YWxfY29kZSIsInN0YXRlIiwiY291bnRyeSIsInN1bW1hcnkiLCJzdWJ0b3RhbCIsInNoaXBwaW5nX2Nvc3QiLCJ0b3RhbF90YXgiLCJ0b3RhbF9jb3N0Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBa0JBOztBQUNBOztBQWxCQSxJQUFNQSxVQUFV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LHVCQUFXMUMsUUFBUSxLQUFSO0FBTk4sV0FBUDtBQVFELFNBVFM7QUFwQkg7QUFGQztBQURDLEdBQWY7O0FBcUNBLFNBQU9wQixRQUFQO0FBQ0Q7O0FBRUQ7QUFDQSxTQUFTcUIsOEJBQVQsQ0FBd0NELE9BQXhDLEVBQWlERCxTQUFqRCxFQUE0RDtBQUMxRDtBQUNBLFNBQU9kLDRCQUE0QixpQ0FBaUNjLFNBQWpDLEdBQTZDLE1BQTdDLEdBQXNEQyxPQUFsRixDQUFQO0FBQ0Q7O0FBRUQ7QUFDQSxlQUFlZ0Msa0NBQWYsQ0FBa0RELFlBQWxELEVBQWdFaEMsU0FBaEUsRUFBMkU7QUFDekU7QUFDQSxNQUFJcUMsV0FBVyxNQUFNLCtCQUFrQkwsWUFBbEIsQ0FBckI7QUFDQSxTQUFPO0FBQ0w1Qyx5REFBbURZLFNBQW5ELE1BREs7QUFFTDRDLG1CQUFlUCxTQUFTUCxHQUFULENBQWEsbUJBQVc7QUFDckMsYUFBTztBQUNMZSxzQkFBYyxNQURUO0FBRUx0QyxlQUFPTixRQUFRTSxLQUZWO0FBR0xmLGdEQUFzQ1EsU0FBdEMsU0FBbURDLFFBQVFNO0FBSHRELE9BQVA7QUFLRCxLQU5jO0FBRlYsR0FBUDtBQVVEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlUm9vdCI6Ii9hcHAiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvbWVzc2VuZ2VyLXBsYXRmb3JtL2dldHRpbmctc3RhcnRlZC93ZWJob29rLXNldHVwL1xuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9nZXR0aW5nLXN0YXJ0ZWQvYXBwLXNldHVwXG4vLyBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvbWVzc2VuZ2VyLXBsYXRmb3JtL2dldHRpbmctc3RhcnRlZC9xdWljay1zdGFydFxuXG5cInVzZSBzdHJpY3RcIjtcblxuLy8gSW1wb3J0cyBkZXBlbmRlbmNpZXMgYW5kIHNldCB1cCBodHRwIHNlcnZlclxuY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoXCJleHByZXNzXCIpLFxuICBib2R5UGFyc2VyID0gcmVxdWlyZShcImJvZHktcGFyc2VyXCIpLFxuICBhcHAgPSBleHByZXNzKCkudXNlKGJvZHlQYXJzZXIuanNvbigpKTsgLy8gY3JlYXRlcyBleHByZXNzIGh0dHAgc2VydmVyXG5jb25zdCByZXF1ZXN0ID0gcmVxdWlyZShcInJlcXVlc3RcIik7XG5jb25zdCBkb3RlbnYgPSByZXF1aXJlKCdkb3RlbnYnKTtcbmNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xuY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuZG90ZW52LmNvbmZpZygpO1xuXG4vLyBHZXQgcGFnZSBhY2Nlc3MgdG9rZW5cbmNvbnN0IFBBR0VfQUNDRVNTX1RPS0VOID0gcHJvY2Vzcy5lbnYuUEFHRV9BQ0NFU1NfVE9LRU47XG5cbi8vIFNldHVwIHRvIGNvbm5lY3QgdG8gREJcbmNvbnN0IERCX1BBU1NXT1JEID0gcHJvY2Vzcy5lbnYuREJfUEFTU1dPUkQ7XG5tb25nb29zZS5jb25uZWN0KCdtb25nb2RiK3NydjovL21vbmdvYWRtaW46JysgREJfUEFTU1dPUkQgKydAZmItaGFjay1jaGF0Ym90LWNldm5rLm1vbmdvZGIubmV0L2ZibXNnJyx7dXNlTmV3VXJsUGFyc2VyOiB0cnVlLHVzZUNyZWF0ZUluZGV4OiB0cnVlLCB1c2VGaW5kQW5kTW9kaWZ5OiBmYWxzZX0pLnRoZW4oKCkgPT4gY29uc29sZS5sb2coXCJEQiBDb25uZWN0aW9uIHN1Y2Nlc3NmdWxcIikpO1xubW9uZ29vc2UuUHJvbWlzZSA9IGdsb2JhbC5Qcm9taXNlO1xuXG5pbXBvcnQgeyBnZXRBbGxQcm9kdWN0cywgZ2V0UHJvZHVjdHNCeVR5cGUsIGdldFByb2R1Y3RCeUlELCBnZXRQcm9kdWN0UHJpY2UsIGdldFByb2R1Y3REZXNjLCBnZXRQcm9kdWN0c0J5TmFtZSwgZ2V0UHJvZHVjdEJ5TmFtZVZhciwgY2hlY2tVc2VyLCBjcmVhdGVVc2VyIH0gZnJvbSAnLi9EQkNvbm4nO1xuaW1wb3J0IHsgZ2V0TmFtZSwgZ2V0UHJvZHVjdERldGFpbHMgfSBmcm9tICcuL2ZiaGVscGVyJztcblxuLy8gR2V0IHBhZ2UgYWNjZXNzIHRva2VuXG5jb25zdCBGQl9BUFBfU0VDUkVUID0gcHJvY2Vzcy5lbnYuRkJfQVBQX1NFQ1JFVDtcbmNvbnN0IGFwcHNlY3JldF9wcm9vZiA9IGNyeXB0by5jcmVhdGVIbWFjKCdzaGEyNTYnLEZCX0FQUF9TRUNSRVQpLnVwZGF0ZShQQUdFX0FDQ0VTU19UT0tFTikuZGlnZXN0KCdoZXgnKVxuXG4vLyBTZXRzIHNlcnZlciBwb3J0IGFuZCBsb2dzIG1lc3NhZ2Ugb24gc3VjY2Vzc1xuYXBwLmxpc3RlbigzMDAwLCAoKSA9PiBjb25zb2xlLmxvZyhcIndlYmhvb2sgaXMgbGlzdGVuaW5nXCIpKTtcblxuLy8gQWRkcyBzdXBwb3J0IGZvciBHRVQgcmVxdWVzdHMgdG8gb3VyIHdlYmhvb2tcbmFwcC5nZXQoXCIvd2ViaG9va1wiLCAocmVxLCByZXMpID0+IHtcbiAgbGV0IFZFUklGWV9UT0tFTiA9IHByb2Nlc3MuZW52LlZFUklGWV9UT0tFTjtcblxuICAvLyBQYXJzZSB0aGUgcXVlcnkgcGFyYW1zXG4gIGxldCBtb2RlID0gcmVxLnF1ZXJ5W1wiaHViLm1vZGVcIl07XG4gIGxldCB0b2tlbiA9IHJlcS5xdWVyeVtcImh1Yi52ZXJpZnlfdG9rZW5cIl07XG4gIGxldCBjaGFsbGVuZ2UgPSByZXEucXVlcnlbXCJodWIuY2hhbGxlbmdlXCJdO1xuXG4gIC8vIENoZWNrcyBpZiBhIHRva2VuIGFuZCBtb2RlIGlzIGluIHRoZSBxdWVyeSBzdHJpbmcgb2YgdGhlIHJlcXVlc3RcbiAgaWYgKG1vZGUgJiYgdG9rZW4pIHtcbiAgICAvLyBDaGVja3MgdGhlIG1vZGUgYW5kIHRva2VuIHNlbnQgaXMgY29ycmVjdFxuICAgIGlmIChtb2RlID09PSBcInN1YnNjcmliZVwiICYmIHRva2VuID09PSBWRVJJRllfVE9LRU4pIHtcbiAgICAgIC8vIFJlc3BvbmRzIHdpdGggdGhlIGNoYWxsZW5nZSB0b2tlbiBmcm9tIHRoZSByZXF1ZXN0XG4gICAgICBjb25zb2xlLmxvZyhcIldFQkhPT0tfVkVSSUZJRURcIik7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChjaGFsbGVuZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZXNwb25kcyB3aXRoICc0MDMgRm9yYmlkZGVuJyBpZiB2ZXJpZnkgdG9rZW5zIGRvIG5vdCBtYXRjaFxuICAgICAgcmVzLnNlbmRTdGF0dXMoNDAzKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vLyBGb3IgdGVzdGluZyBlbmRwb2ludHNcbmFwcC5nZXQoXCIvdGVzdFwiLCAocmVxLHJlcykgPT57XG4gICAgbGV0IGJvZHkgPSByZXEuYm9keTtcbiAgICAvLyBnZXRBbGxQcm9kdWN0cygpLnRoZW4oZnVuY3Rpb24ocHJvZHVjdHMpe1xuICAgIC8vIGNvbnNvbGUubG9nKHByb2R1Y3RzKTtcbiAgICAvLyB9KTtcbiAgICAvLyBnZXRQcm9kdWN0QnlUeXBlKFwiQmFrZXJcIikudGhlbihmdW5jdGlvbihwcm9kdWN0cyl7XG4gICAgLy8gY29uc29sZS5sb2cocHJvZHVjdHMpO1xuICAgIC8vIH0pO1xuICAgIC8vIGdldFByb2R1Y3RCeUlEKCczMDYwNzI0Njk3MzUyMTk2JykudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgLy8gY29uc29sZS5sb2cocHJvZCk7XG4gICAgLy8gfSk7XG4gICAgLy8gZ2V0UHJvZHVjdFByaWNlKCczMDYwNzI0Njk3MzUyMTk2JykudGhlbihmdW5jdGlvbihwcmljZSl7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHByaWNlKTtcbiAgICAvLyB9KTtcbiAgICAvLyBnZXRQcm9kdWN0RGVzYygnMzA2MDcyNDY5NzM1MjE5NicpLnRoZW4oZnVuY3Rpb24oZGVzY3JpcHRpb24pe1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhkZXNjcmlwdGlvbik7XG4gICAgLy8gfSk7XG4gICAgLy8gZ2V0UHJvZHVjdHNCeU5hbWUoJ0VhcmwgR3JleSBTdW5mbG93ZXIgU2VlZHMgQ29va2llcycpLnRoZW4oZnVuY3Rpb24ocHJvZCl7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2QpO1xuICAgIC8vIH0pO1xuICAgIC8vIGdldFByb2R1Y3RCeU5hbWVWYXIoJ0VhcmwgR3JleSBTdW5mbG93ZXIgU2VlZHMgQ29va2llcycsJ0dpZnQgYm94JykudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAvLyAgICAgY29uc29sZS5sb2cocHJvZCk7XG4gICAgLy8gfSk7XG4gICAgcmVzLnN0YXR1cygyMDApLnNlbmQoXCJTdWNjZXNzXCIpO1xuICAgIFxufSk7XG5cbi8vIENyZWF0ZXMgdGhlIGVuZHBvaW50IGZvciBvdXIgd2ViaG9va1xuYXBwLnBvc3QoXCIvd2ViaG9va1wiLCAocmVxLCByZXMpID0+IHtcbiAgbGV0IGJvZHkgPSByZXEuYm9keTtcblxuICAvLyBDaGVja3MgdGhpcyBpcyBhbiBldmVudCBmcm9tIGEgcGFnZSBzdWJzY3JpcHRpb25cbiAgaWYgKGJvZHkub2JqZWN0ID09PSBcInBhZ2VcIikge1xuICAgIC8vIEl0ZXJhdGVzIG92ZXIgZWFjaCBlbnRyeSAtIHRoZXJlIG1heSBiZSBtdWx0aXBsZSBpZiBiYXRjaGVkXG4gICAgYm9keS5lbnRyeS5mb3JFYWNoKGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAvLyBHZXRzIHRoZSBtZXNzYWdlLiBlbnRyeS5tZXNzYWdpbmcgaXMgYW4gYXJyYXksIGJ1dFxuICAgICAgLy8gd2lsbCBvbmx5IGV2ZXIgY29udGFpbiBvbmUgbWVzc2FnZSwgc28gd2UgZ2V0IGluZGV4IDBcbiAgICAgIGxldCB3ZWJob29rX2V2ZW50ID0gZW50cnkubWVzc2FnaW5nWzBdO1xuICAgICAgLy8gY29uc29sZS5sb2cod2ViaG9va19ldmVudCk7XG5cbiAgICAgIC8vIEdldCB0aGUgc2VuZGVyIFBTSURcbiAgICAgIGxldCBzZW5kZXJfcHNpZCA9IHdlYmhvb2tfZXZlbnQuc2VuZGVyLmlkO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJTZW5kZXIgUFNJRDogXCIgKyBzZW5kZXJfcHNpZCk7XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSBldmVudCBpcyBhIG1lc3NhZ2Ugb3IgcG9zdGJhY2sgYW5kXG4gICAgICAvLyBwYXNzIHRoZSBldmVudCB0byB0aGUgYXBwcm9wcmlhdGUgaGFuZGxlciBmdW5jdGlvblxuICAgICAgaWYgKHdlYmhvb2tfZXZlbnQubWVzc2FnZSkge1xuICAgICAgICBpZiAod2ViaG9va19ldmVudC5tZXNzYWdlLnF1aWNrX3JlcGx5KSB7XG4gICAgICAgICAgaGFuZGxlUG9zdGJhY2soc2VuZGVyX3BzaWQsIHdlYmhvb2tfZXZlbnQubWVzc2FnZS5xdWlja19yZXBseSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaGFuZGxlTWVzc2FnZShzZW5kZXJfcHNpZCwgd2ViaG9va19ldmVudC5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZ2V0TmFtZShQQUdFX0FDQ0VTU19UT0tFTixzZW5kZXJfcHNpZCwgZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgY2hlY2tVc2VyKHNlbmRlcl9wc2lkLHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uKHVzZXIpe1xuICAgICAgICAgICAgICAgIGlmICh1c2VyLmxlbmd0aCA9PSAwKXtcbiAgICAgICAgICAgICAgICAgICAgY3JlYXRlVXNlcihzZW5kZXJfcHNpZCxyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICB9IGVsc2UgaWYgKHdlYmhvb2tfZXZlbnQucG9zdGJhY2spIHtcbiAgICAgICAgaGFuZGxlUG9zdGJhY2soc2VuZGVyX3BzaWQsIHdlYmhvb2tfZXZlbnQucG9zdGJhY2spO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUmV0dXJucyBhICcyMDAgT0snIHJlc3BvbnNlIHRvIGFsbCByZXF1ZXN0c1xuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKFwiRVZFTlRfUkVDRUlWRURcIik7XG4gIH0gZWxzZSB7XG4gICAgLy8gUmV0dXJucyBhICc0MDQgTm90IEZvdW5kJyBpZiBldmVudCBpcyBub3QgZnJvbSBhIHBhZ2Ugc3Vic2NyaXB0aW9uXG4gICAgcmVzLnNlbmRTdGF0dXMoNDA0KTtcbiAgfVxufSk7XG5cbmxldCBkZWZhdWx0UmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gIFwiV2UgY291bGQgbm90IHVuZGVyc3RhbmQgeW91ciBtZXNzYWdlLiBLaW5kbHkgcmVwaHJhc2UgeW91ciBtZXNzYWdlIGFuZCBzZW5kIHVzIGFnYWluLlwiXG4pO1xuXG4vLyBBZGRzIHN1cHBvcnQgZm9yIEdFVCByZXF1ZXN0cyB0byBvdXIgd2ViaG9va1xuYXBwLmdldChcIi93ZWJob29rXCIsIChyZXEsIHJlcykgPT4ge1xuICBsZXQgVkVSSUZZX1RPS0VOID0gcHJvY2Vzcy5lbnYuVkVSSUZZX1RPS0VOO1xuXG4gIC8vIFBhcnNlIHRoZSBxdWVyeSBwYXJhbXNcbiAgbGV0IG1vZGUgPSByZXEucXVlcnlbXCJodWIubW9kZVwiXTtcbiAgbGV0IHRva2VuID0gcmVxLnF1ZXJ5W1wiaHViLnZlcmlmeV90b2tlblwiXTtcbiAgbGV0IGNoYWxsZW5nZSA9IHJlcS5xdWVyeVtcImh1Yi5jaGFsbGVuZ2VcIl07XG5cbiAgLy8gQ2hlY2tzIGlmIGEgdG9rZW4gYW5kIG1vZGUgaXMgaW4gdGhlIHF1ZXJ5IHN0cmluZyBvZiB0aGUgcmVxdWVzdFxuICBpZiAobW9kZSAmJiB0b2tlbikge1xuICAgIC8vIENoZWNrcyB0aGUgbW9kZSBhbmQgdG9rZW4gc2VudCBpcyBjb3JyZWN0XG4gICAgaWYgKG1vZGUgPT09IFwic3Vic2NyaWJlXCIgJiYgdG9rZW4gPT09IFZFUklGWV9UT0tFTikge1xuICAgICAgLy8gUmVzcG9uZHMgd2l0aCB0aGUgY2hhbGxlbmdlIHRva2VuIGZyb20gdGhlIHJlcXVlc3RcbiAgICAgIGNvbnNvbGUubG9nKFwiV0VCSE9PS19WRVJJRklFRFwiKTtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKGNoYWxsZW5nZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlc3BvbmRzIHdpdGggJzQwMyBGb3JiaWRkZW4nIGlmIHZlcmlmeSB0b2tlbnMgZG8gbm90IG1hdGNoXG4gICAgICByZXMuc2VuZFN0YXR1cyg0MDMpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vIEhhbmRsZXMgbWVzc2FnZXMgZXZlbnRzXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlKHNlbmRlcl9wc2lkLCByZWNlaXZlZF9tZXNzYWdlKSB7XG4gIGxldCByZXNwb25zZTtcblxuICAvLyBDaGVjayBpZiB0aGUgbWVzc2FnZSBjb250YWlucyB0ZXh0XG4gIGlmIChyZWNlaXZlZF9tZXNzYWdlLnRleHQpIHtcbiAgICBjb25zb2xlLmxvZyhgUmVjZWl2ZWQgbWVzc2FnZTogXCIke3JlY2VpdmVkX21lc3NhZ2UudGV4dH1cImApO1xuXG4gICAgcmVzcG9uc2UgPSBhd2FpdCBwcm9jZXNzTWVzc2FnZShzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfbWVzc2FnZSk7XG4gICAgLy8gRGVmYXVsdCByZXNwb25zZSAoZm9yIGRlYnVnZ2luZylcbiAgICAvLyBDcmVhdGUgdGhlIHBheWxvYWQgZm9yIGEgYmFzaWMgdGV4dCBtZXNzYWdlXG4gICAgLy8gcmVzcG9uc2UgPSB7XG4gICAgLy8gICB0ZXh0OiBgWW91IHNlbnQgdGhlIG1lc3NhZ2U6IFwiJHtyZWNlaXZlZF9tZXNzYWdlLnRleHR9XCIuYFxuICAgIC8vIH07XG4gIH0gZWxzZSB7XG4gICAgcmVzcG9uc2UgPSBkZWZhdWx0UmVzcG9uc2U7XG4gICAgLy8gICAgIC8vIEdldHMgdGhlIFVSTCBvZiB0aGUgbWVzc2FnZSBhdHRhY2htZW50XG4gICAgLy8gICAgIGxldCBhdHRhY2htZW50X3VybCA9IHJlY2VpdmVkX21lc3NhZ2UuYXR0YWNobWVudHNbMF0ucGF5bG9hZC51cmw7XG4gIH1cblxuICAvLyBTZW5kcyB0aGUgcmVzcG9uc2UgbWVzc2FnZVxuICBjYWxsU2VuZEFQSShzZW5kZXJfcHNpZCwgcmVzcG9uc2UpO1xufVxuXG4vLyBIYW5kbGVzIG1lc3NhZ2luZ19wb3N0YmFja3MgZXZlbnRzXG5mdW5jdGlvbiBoYW5kbGVQb3N0YmFjayhzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfcG9zdGJhY2spIHtcbiAgbGV0IHJlc3BvbnNlO1xuXG4gIC8vIEdldCB0aGUgcGF5bG9hZCBmb3IgdGhlIHBvc3RiYWNrXG4gIGxldCBwYXlsb2FkID0gcmVjZWl2ZWRfcG9zdGJhY2sucGF5bG9hZDtcbiAgY29uc29sZS5sb2coYFJlY2VpdmVkIHBvc3RiYWNrOiBcIiR7cGF5bG9hZH1cImApO1xuXG4gIGxldCBwb3N0YmFja19pbnRlbnQgPSBwYXlsb2FkLnNwbGl0KFwiIFwiKVswXTtcbiAgbGV0IHBvc3RiYWNrX2NvbnRlbnQgPSBwYXlsb2FkLnN1YnN0cmluZyhcbiAgICBwYXlsb2FkLmluZGV4T2YoXCIgXCIpICsgMSxcbiAgICBwYXlsb2FkLmxlbmd0aFxuICApO1xuICBcbiAgLy8gU2V0IHRoZSByZXNwb25zZSBiYXNlZCBvbiB0aGUgcG9zdGJhY2sgaW50ZW50XG4gIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiY2FydF9hZGRcIikge1xuICAgIC8vIEFkZCB0byBjYXJ0XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZUFkZENhcnRSZXNwb25zZShzZW5kZXJfcHNpZCwgcG9zdGJhY2tfY29udGVudCwgMSk7XG4gIH0gZWxzZSBpZiAocG9zdGJhY2tfaW50ZW50ID09PSBcImNhcnRfdmlld1wiKSB7XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpO1xuICB9IGVsc2UgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJlbnF1aXJ5X3Byb2R1Y3RcIikge1xuICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgYFdoYXQgd291bGQgeW91IGxpa2UgdG8ga25vdyBhYm91dCBvdXIgJHtwb3N0YmFja19jb250ZW50fT9gXG4gICAgKTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiZW5xdWlyeV9wcm9kdWN0X2F0dHJpYnV0ZVwiKSB7XG4gICAgbGV0IGF0dHJpYnV0ZSA9IHBvc3RiYWNrX2NvbnRlbnQuc3Vic3RyaW5nKDAsIHBvc3RiYWNrX2NvbnRlbnQuaW5kZXhPZihcIiBcIikgKyAxKTtcbiAgICBsZXQgcHJvZHVjdCA9IHBvc3RiYWNrX2NvbnRlbnQuc3Vic3RyaW5nKFxuICAgICAgcG9zdGJhY2tfY29udGVudC5pbmRleE9mKFwiIFwiKSArIDEsXG4gICAgICBwb3N0YmFja19jb250ZW50Lmxlbmd0aFxuICAgICk7XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVByb2R1Y3RFbnF1aXJ5UmVzcG9uc2UocHJvZHVjdCwgYXR0cmlidXRlKTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiY2hlY2tvdXRcIikge1xuICAgIHJlc3BvbnNlID0ge1xuICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImJ1dHRvblwiLFxuICAgICAgICAgIHRleHQ6IFwiQ2xpY2sgb24gdGhlIGJ1dHRvbiBiZWxvdyB0byBwYXkuXCIsXG4gICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBcIlBheVwiLFxuICAgICAgICAgICAgICBwYXlsb2FkOiBcInBhaWRcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gIH0gZWxzZSBpZiAocG9zdGJhY2tfaW50ZW50ID09PSBcInBhaWRcIikge1xuICAgIHJlc3BvbnNlID0ge1xuICAgICAgYXR0YWNobWVudDoge1xuICAgICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImJ1dHRvblwiLFxuICAgICAgICAgIHRleHQ6IFwiWW91ciBvcmRlciAob3JkZXIgbm8uKSBpcyBjb25maXJtZWQuXCIsXG4gICAgICAgICAgYnV0dG9uczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiBcIlZpZXcgUmVjZWlwdFwiLFxuICAgICAgICAgICAgICBwYXlsb2FkOiBcInJlY2VpcHRfdmlld1wiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwicmVjZWlwdF92aWV3XCIpIHtcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlKHNlbmRlcl9wc2lkKTtcbiAgfVxuXG4gIGlmIChyZXNwb25zZSA9PSBudWxsKSB7XG4gICAgcmVzcG9uc2UgPSBkZWZhdWx0UmVzcG9uc2UoKTtcbiAgfVxuXG4gIC8vIFNlbmQgdGhlIG1lc3NhZ2UgdG8gYWNrbm93bGVkZ2UgdGhlIHBvc3RiYWNrXG4gIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSk7XG59XG5cbi8vIFNlbmRzIHJlc3BvbnNlIG1lc3NhZ2VzIHZpYSB0aGUgU2VuZCBBUElcbmZ1bmN0aW9uIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSkge1xuICAvLyBVbmNvbW1lbnQgdG8gbG9nIHJlc3BvbnNlIG9iamVjdFxuICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cbiAgLy8gQ29uc3RydWN0IHRoZSBtZXNzYWdlIGJvZHlcbiAgbGV0IHJlcXVlc3RfYm9keSA9IHtcbiAgICByZWNpcGllbnQ6IHtcbiAgICAgIGlkOiBzZW5kZXJfcHNpZFxuICAgIH0sXG4gICAgbWVzc2FnZTogcmVzcG9uc2VcbiAgfTtcblxuICAvLyBTZW5kIHRoZSBIVFRQIHJlcXVlc3QgdG8gdGhlIE1lc3NlbmdlciBQbGF0Zm9ybVxuICByZXF1ZXN0KFxuICAgIHtcbiAgICAgIHVyaTogXCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92Mi42L21lL21lc3NhZ2VzXCIsXG4gICAgICBxczogeyBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOIH0sXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAganNvbjogcmVxdWVzdF9ib2R5XG4gICAgfSxcbiAgICAoZXJyLCByZXMsIGJvZHkpID0+IHtcbiAgICAgIGlmICghZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWVzc2FnZSBzZW50IVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gc2VuZCBtZXNzYWdlOlwiICsgZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5cbi8vIFByb2Nlc3MgdGV4dCBtZXNzYWdlIGFuZCByZXR1cm5zIHJlc3BvbnNlIG9iamVjdCB0byBoYW5kbGVNZXNzYWdlKClcbmZ1bmN0aW9uIHByb2Nlc3NNZXNzYWdlKHNlbmRlcl9wc2lkLCBtZXNzYWdlKSB7XG4gIC8vIE5MUDogaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9idWlsdC1pbi1ubHBcbiAgbGV0IGVudGl0aWVzID0gbWVzc2FnZS5ubHBbXCJlbnRpdGllc1wiXTtcblxuICAvLyBVbmNvbW1lbnQgdG8gdmlldyBhbGwgZW50aXRpZXMgYW5kIHRoZWlyIHhhbHVlc1xuICBPYmplY3Qua2V5cyhlbnRpdGllcykuZm9yRWFjaChrZXkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwiRW50aXR5OiBcIiArIGtleSk7XG4gICAgY29uc29sZS5sb2coZW50aXRpZXNba2V5XSk7XG4gIH0pO1xuXG4gIC8vIENoZWNrIGdyZWV0aW5nXG4gIGxldCBpc19ncmVldGluZyA9XG4gICAgZW50aXRpZXNbXCJncmVldGluZ3NcIl0gIT0gbnVsbCAmJlxuICAgIGVudGl0aWVzW1wiZ3JlZXRpbmdzXCJdWzBdW1wiY29uZmlkZW5jZVwiXSA+IDAuODsgLy8gR3JlZXRpbmcgdGhyZXNob2xkIHNldCB0byAwLjggKHN0cmljdGVyKVxuXG4gIC8vIFJldHJpZXZlIGZpcnN0IGludGVudCBvYmplY3RcbiAgbGV0IGludGVudCA9IGVudGl0aWVzW1wiaW50ZW50XCJdWzBdO1xuXG4gIGlmIChpbnRlbnRbXCJjb25maWRlbmNlXCJdID4gMC41KSB7XG4gICAgLy8gUHJvY2VzcyBpbnRlbnRcbiAgICBsZXQgaW50ZW50X3BhcnRzID0gaW50ZW50W1widmFsdWVcIl0uc3BsaXQoXCJfXCIpO1xuICAgIGxldCBpbnRlbnRfY2F0ZWdvcnkgPSBpbnRlbnRfcGFydHNbMF07XG4gICAgbGV0IGludGVudF9zdWJjYXRlZ29yeSA9IGludGVudF9wYXJ0cy5sZW5ndGggPiAxID8gaW50ZW50X3BhcnRzWzFdIDogbnVsbDtcbiAgICBsZXQgcmVzcG9uc2UgPSBudWxsO1xuXG4gICAgc3dpdGNoIChpbnRlbnRfY2F0ZWdvcnkpIHtcbiAgICAgIGNhc2UgXCJyZWNvbW1lbmRhdGlvblwiOlxuICAgICAgICAvLyBIYW5kbGUgcmVjb21tZW5kYXRpb25cbiAgICAgICAgLy8gcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgIC8vICAgXCJNZXNzYWdlIHJlY2VpdmVkIGlzIGEgcmVjb21tZW5kYXRpb24gbWVzc2FnZS5cIlxuICAgICAgICAvLyApO1xuXG4gICAgICAgIGxldCBwcm9kdWN0X3R5cGVzID0gW107XG4gICAgICAgIGlmIChlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUHJvY2Vzc2luZyBwcm9kdWN0IHR5cGVzXCIpO1xuICAgICAgICAgIHByb2R1Y3RfdHlwZXMgPSBlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXVxuICAgICAgICAgICAgLmZpbHRlcihvYmogPT4gb2JqW1wiY29uZmlkZW5jZVwiXSA+IDAuNSlcbiAgICAgICAgICAgIC5tYXAob2JqID0+IG9ialtcInZhbHVlXCJdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZShwcm9kdWN0X3R5cGVzKTtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImVucXVpcnlcIjpcbiAgICAgICAgLy8gSGFuZGxlIGVucXVpcnlcbiAgICAgICAgLy8gcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgIC8vICAgXCJNZXNzYWdlIHJlY2VpdmVkIGlzIGFuIGVucXVpcnkgbWVzc2FnZS5cIlxuICAgICAgICAvLyApO1xuXG4gICAgICAgIGlmIChpbnRlbnRfc3ViY2F0ZWdvcnkgPT09IFwicHJvZHVjdFwiKSB7XG4gICAgICAgICAgLy8gUmV0cmlldmUgcHJvZHVjdCBhbmQgYXR0cmlidXRlIGZyb20gZW50aXRpZXMgb2JqZWN0XG4gICAgICAgICAgaWYgKGVudGl0aWVzW1wicHJvZHVjdFwiXSAmJiBlbnRpdGllc1tcInByb2R1Y3RfYXR0cmlidXRlXCJdKSB7XG4gICAgICAgICAgICBsZXQgcHJvZHVjdCA9IGVudGl0aWVzW1wicHJvZHVjdFwiXVswXVtcInZhbHVlXCJdO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZSA9IGVudGl0aWVzW1wicHJvZHVjdF9hdHRyaWJ1dGVcIl1bMF1bXCJ2YWx1ZVwiXTtcbiAgICAgICAgICAgIC8vIEhhbmRsZSBwcm9kdWN0IGVucXVpcnlcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVQcm9kdWN0RW5xdWlyeVJlc3BvbnNlKHByb2R1Y3QsIGF0dHJpYnV0ZSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXSAmJiBlbnRpdGllc1tcInByb2R1Y3RfYXR0cmlidXRlXCJdKSB7XG4gICAgICAgICAgICAvLyBIYW5kbGUgcHJvZHVjdCB0eXBlIGVucXVpcnlcbiAgICAgICAgICAgIGxldCBwcm9kdWN0X3R5cGUgPSBlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXVswXVtcInZhbHVlXCJdO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZSA9IGVudGl0aWVzW1wicHJvZHVjdF9hdHRyaWJ1dGVcIl1bMF1bXCJ2YWx1ZVwiXTtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVQcm9kdWN0VHlwZUVucXVpcnlSZXNwb25zZShwcm9kdWN0X3R5cGUsIGF0dHJpYnV0ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZGVmYXVsdFJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChpbnRlbnRfc3ViY2F0ZWdvcnkgPT09IFwiZ2VuZXJhbFwiKSB7XG4gICAgICAgICAgbGV0IG1lc3NhZ2VzID0ge1xuICAgICAgICAgICAgcHJvZml0OlxuICAgICAgICAgICAgICBcIkFsbCBuZXQgcmV2ZW51ZSBlYXJuZWQgZnJvbSB0aGUgc2FsZSBvZiBvdXIgcHJvZHVjdHMgYW5kIHNlcnZpY2VzIGdvIHRvd2FyZHMgcGF5aW5nIGEgbW9udGhseSBhbGxvd2FuY2UgZm9yIG91ciBjbGllbnRzJyB3b3JrLCBhcyB3ZWxsIGFzIHRoZWlyIGx1bmNoIGV4cGVuc2VzIHdoaWxlIHVuZGVyZ29pbmcgdHJhaW5pbmcuXCIsXG4gICAgICAgICAgICBtYW51ZmFjdHVyZXI6XG4gICAgICAgICAgICAgIFwiV2Ugc3VwcG9ydCBhZHVsdHMgd2l0aCBpbnRlbGxlY3R1YWwgZGlzYWJpbGl0aWVzLiBXZSBzdGFydGVkIGEgcmFuZ2Ugb2Ygc29jaWFsIGVudGVycHJpc2UgcHJvamVjdHMgdG8gcHJvdmlkZSBhbHRlcm5hdGl2ZSB3b3JrIGVuZ2FnZW1lbnQgZm9yIG91ciBhZHVsdCB0cmFpbmVlcy5cIixcbiAgICAgICAgICAgIHByb2R1Y3RzOiBcIldlIHNlbGwgY3JhZnQgYW5kIGJha2VyIGdvb2RzLlwiXG4gICAgICAgICAgfTtcbiAgICAgICAgICAvLyBMb29wIHRocm91Z2ggbWVzc2FnZSBrZXlzIChlbnRpdHkpIGFuZCBmaW5kIGlmIGVudGl0eSBpcyBpbiBlbnRpdGllc1xuICAgICAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VzKS5mb3JFYWNoKGVudGl0eSA9PiB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UgPT0gbnVsbCAmJiBlbnRpdGllc1tlbnRpdHldKSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKG1lc3NhZ2VzW2VudGl0eV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJkZWxpdmVyeVwiKSB7XG4gICAgICAgICAgaWYgKGVudGl0aWVzW1wic3RhdHVzXCJdKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBPcmRlciBzdGF0dXNcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAgICAgICBcIllvdXIgbGF0ZXN0IG9yZGVyIGlzIDxzdGF0dXM+LlwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZW50aXRpZXNbXCJlc3RpbWF0ZWRfYXJyaXZhbFwiXSkge1xuICAgICAgICAgICAgLy8gVE9ETzogT3JkZXIgZXN0aW1hdGVkIGFycml2YWxcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAgICAgICBcIlRoZSBhdmVyYWdlIGRlbGl2ZXJ5IHRpbWUgdGFrZXMgNS03IHdvcmtpbmcgZGF5cy4gWW91ciBvcmRlcmVkIHdhcyBzZW50IG9uIDxkYXRlPi4gSXQgaXMgZXN0aW1hdGVkIHRvIGFycml2ZSBvbiA8ZGF0ZSArIDcgd29ya2luZyBkYXlzPi5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVudGl0aWVzW1wiY29zdFwiXSkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiSXQgaXMgYSBmbGF0IGZlZSBvZiAkMiBmb3IgZXZlcnkgb3JkZXIuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAgICAgICBcIldlIGRlbGl2ZXIgaXNsYW5kd2lkZS4gVGhlIGF2ZXJhZ2UgZGVsaXZlcnkgdGltZSB0YWtlcyA1LTcgd29ya2luZyBkYXlzLlwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBcImNhcnRcIjpcbiAgICAgICAgLy8gSGFuZGxlIHNob3BwaW5nIGNhcnRcbiAgICAgICAgLy8gcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgIC8vICAgXCJNZXNzYWdlIHJlY2VpdmVkIGlzIGEgY2FydCBtZXNzYWdlLlwiXG4gICAgICAgIC8vICk7XG5cbiAgICAgICAgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJhZGRcIiAmJiBlbnRpdGllc1tcInByb2R1Y3RcIl0pIHtcbiAgICAgICAgICBsZXQgcHJvZHVjdF9uYW1lID0gZW50aXRpZXNbXCJwcm9kdWN0XCJdWzBdW1widmFsdWVcIl07XG4gICAgICAgICAgbGV0IHF1YW50aXR5ID0gZW50aXRpZXNbXCJudW1iZXJcIl1cbiAgICAgICAgICAgID8gZW50aXRpZXNbXCJudW1iZXJcIl1bMF1bXCJ2YWx1ZVwiXVxuICAgICAgICAgICAgOiAxO1xuICAgICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVBZGRDYXJ0UmVzcG9uc2UoXG4gICAgICAgICAgICBzZW5kZXJfcHNpZCxcbiAgICAgICAgICAgIHByb2R1Y3RfbmFtZSxcbiAgICAgICAgICAgIHF1YW50aXR5XG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChpbnRlbnRfc3ViY2F0ZWdvcnkgPT09IFwidmlld1wiKSB7XG4gICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXNwb25zZSA9IGRlZmF1bHRSZXNwb25zZTtcbiAgICB9XG5cbiAgICByZXNwb25zZSA9IHJlc3BvbnNlID09IG51bGwgPyBkZWZhdWx0UmVzcG9uc2UgOiByZXNwb25zZTtcbiAgICByZXR1cm4gcmVzcG9uc2U7XG4gIH0gZWxzZSBpZiAoaXNfZ3JlZXRpbmcpIHtcbiAgICAvLyBNZXNzYWdlIGhhcyBubyBpbnRlbnQsIGp1c3QgZ3JlZXRpbmdcbiAgICAvLyBUT0RPOiBBZGQgcXVpY2sgcmVwbGllcyBvZiBjaGF0Ym90IGZ1bmN0aW9uYWxpdGllcyAocmVjb21tZW5kYXRpb25zLCBjaGVjayBvcmRlciBzdGF0dXMsIGV0Yy4pXG4gICAgcmV0dXJuIGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgIFwiSGkgdGhlcmUhIFdlbGNvbWUgdG8gQnJpZ2h0LiBIb3cgY2FuIEkgaGVscCB5b3U/XCJcbiAgICApO1xuICB9XG5cbiAgLy8gTm8gaW50ZW50IG5vciBncmVldGluZ1xuICByZXR1cm4gZGVmYXVsdFJlc3BvbnNlO1xufVxuXG4vLyBXcmFwcGVyIG1ldGhvZCB0byBjb252ZXJ0IHRleHQgbWVzc2FnZSBzdHJpbmcgdG8gcmVzcG9uc2Ugb2JqZWN0XG5mdW5jdGlvbiBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UobWVzc2FnZSkge1xuICByZXR1cm4ge1xuICAgIHRleHQ6IG1lc3NhZ2VcbiAgfTtcbn1cblxuLy8gUmVzcG9uc2Ugb24gZ2VuZXJpYyB0ZW1wbGF0ZSBjYXJvdXNlbCBmb3IgcmVjb21tZW5kYXRpb25zXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVJlY29tbWVuZGF0aW9uc1Jlc3BvbnNlKHByb2R1Y3RfdHlwZXMpIHtcbiAgLy8gUmV0cmlldmUgcHJvZHVjdHMgdG8gcmVjb21tZW5kIGJhc2VkIG9uIGxpc3Qgb2YgcHJvZHVjdCB0eXBlcy4gSWYgcHJvZHVjdCB0eXBlcyBpcyBhbiBlbXB0eSBhcnJheSwgcmVjb21tZW5kIHByb2R1Y3RzIG9mIHZhcmlvdXMgdHlwZXNcbiAgbGV0IHByb2R1Y3RzO1xuICBcbiAgaWYgKHByb2R1Y3RfdHlwZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcHJvZHVjdHMgPSBhd2FpdCBnZXRBbGxQcm9kdWN0cygpO1xuICB9IGVsc2Uge1xuICAgIHByb2R1Y3RzID0gYXdhaXQgZ2V0UHJvZHVjdHNCeVR5cGUocHJvZHVjdF90eXBlc1swXSk7XG4gIH1cbiAgXG4gIGxldCByZXNwb25zZSA9IHtcbiAgICBhdHRhY2htZW50OiB7XG4gICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIHRlbXBsYXRlX3R5cGU6IFwiZ2VuZXJpY1wiLFxuICAgICAgICBlbGVtZW50czogcHJvZHVjdHMubWFwKHByb2R1Y3QgPT4ge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0aXRsZTogcHJvZHVjdFtcInRpdGxlXCJdLFxuICAgICAgICAgICAgc3VidGl0bGU6IGAkJHtwcm9kdWN0W1wicHJpY2VcIl19YCxcbiAgICAgICAgICAgIGltYWdlX3VybDogcHJvZHVjdFtcImltYWdlX2xpbmtcIl0sXG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiTGVhcm4gTW9yZVwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBlbnF1aXJ5X3Byb2R1Y3QgJHtwcm9kdWN0W1widGl0bGVcIl19YFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdHlwZTogXCJwb3N0YmFja1wiLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBcIkFkZCB0byBDYXJ0XCIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogYGNhcnRfYWRkICR7cHJvZHVjdFtcInRpdGxlXCJdfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIGNvbmZpcm1hdGlvbiBvZiBwcm9kdWN0IGFkZGVkIHRvIGNhcnQgYW5kIHF1aWNrIHJlcGxpZXNcbmZ1bmN0aW9uIGdlbmVyYXRlQWRkQ2FydFJlc3BvbnNlKHNlbmRlcl9wc2lkLCBwcm9kdWN0X25hbWUsIHF1YW50aXR5KSB7XG4gIC8vIFRPRE86IEFkZCBwcm9kdWN0IHRvIGNhcnQgaW4gZGJcblxuICByZXR1cm4ge1xuICAgIHRleHQ6IGBBZGRlZCAke3F1YW50aXR5fSAke3Byb2R1Y3RfbmFtZX0gdG8gY2FydC5gLFxuICAgIHF1aWNrX3JlcGxpZXM6IFtcbiAgICAgIHtcbiAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgdGl0bGU6IFwiVmlldyBDYXJ0XCIsXG4gICAgICAgIHBheWxvYWQ6IGBjYXJ0X3ZpZXdgXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICB0aXRsZTogXCJDaGVja291dFwiLFxuICAgICAgICBwYXlsb2FkOiBgY2hlY2tvdXRgXG4gICAgICB9XG4gICAgXVxuICB9O1xufVxuXG4vLyBSZXNwb25zZSBvbiBnZW5lcmljIHRlbXBsYXRlIGNhcm91c2VsIGZvciBjYXJ0XG5mdW5jdGlvbiBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpIHtcbiAgLy8gVE9ETzogR2V0IGNhcnQgZnJvbSBkYlxuICBsZXQgcHJvZHVjdHMgPSBbXG4gICAge1xuICAgICAgaWQ6IDEsXG4gICAgICBuYW1lOiBcIkRhcmsgQ2hvY29sYXRlIE9hdG1lYWwgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAyLFxuICAgICAgbmFtZTogXCJDcmFuYmVycnkgU3dlZXRoZWFydCBDb29raWVzIChFZ2dsZXNzKVwiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIixcbiAgICAgIHF1YW50aXR5OiAxXG4gICAgfVxuICBdO1xuICBsZXQgcmVzcG9uc2UgPSB7XG4gICAgYXR0YWNobWVudDoge1xuICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImdlbmVyaWNcIixcbiAgICAgICAgZWxlbWVudHM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IHByb2R1Y3RbXCJuYW1lXCJdLFxuICAgICAgICAgICAgc3VidGl0bGU6IGBRdHk6ICR7cHJvZHVjdFtcInF1YW50aXR5XCJdfSAoJCR7cHJvZHVjdFtcInByaWNlXCJdfSBlYWNoKWAsXG4gICAgICAgICAgICBpbWFnZV91cmw6IHByb2R1Y3RbXCJ1cmxcIl0sXG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQWRkIDFcIixcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiBgY2FydF9hZGQgJHtwcm9kdWN0W1wibmFtZVwiXX1gXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiUmVtb3ZlIEFsbFwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBjYXJ0X3JlbW92ZSAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIHJlY2VpcHQgdGVtcGxhdGUgZm9yIGxhdGVzdCBjb25maXJtZWQgb3JkZXJcbmZ1bmN0aW9uIGdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlKHNlbmRlcl9wc2lkKSB7XG4gIC8vIFRPRE86IEdldCBsYXRlc3Qgb3JkZXIgZnJvbSBkYXRhYmFzZVxuICBsZXQgcHJvZHVjdHMgPSBbXG4gICAge1xuICAgICAgaWQ6IDEsXG4gICAgICBuYW1lOiBcIkRhcmsgQ2hvY29sYXRlIE9hdG1lYWwgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAyLFxuICAgICAgbmFtZTogXCJDcmFuYmVycnkgU3dlZXRoZWFydCBDb29raWVzIChFZ2dsZXNzKVwiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIixcbiAgICAgIHF1YW50aXR5OiAxXG4gICAgfVxuICBdO1xuXG4gIGxldCByZXNwb25zZSA9IHtcbiAgICBhdHRhY2htZW50OiB7XG4gICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIHRlbXBsYXRlX3R5cGU6IFwicmVjZWlwdFwiLFxuICAgICAgICByZWNpcGllbnRfbmFtZTogXCI8Q1VTVE9NRVJfTkFNRT5cIiwgLy8gTWFuZGF0b3J5IGZpZWxkXG4gICAgICAgIG9yZGVyX251bWJlcjogXCI8T1JERVJfTlVNQkVSPlwiLCAvLyBNYW5kYXRvcnkgZmllbGRcbiAgICAgICAgY3VycmVuY3k6IFwiU0dEXCIsXG4gICAgICAgIHBheW1lbnRfbWV0aG9kOiBcIlBheVBhbFwiLFxuICAgICAgICBvcmRlcl91cmw6IFwiXCIsXG4gICAgICAgIGFkZHJlc3M6IHtcbiAgICAgICAgICBzdHJlZXRfMTogXCI5IFN0cmFpdHMgVmlld1wiLCAvLyBNYW5kYXRvcnkgZmllbGRcbiAgICAgICAgICBjaXR5OiBcIlNpbmdhcG9yZVwiLFxuICAgICAgICAgIHBvc3RhbF9jb2RlOiBcIjAxODkzN1wiLFxuICAgICAgICAgIHN0YXRlOiBcIlNHXCIsXG4gICAgICAgICAgY291bnRyeTogXCJTR1wiXG4gICAgICAgIH0sXG4gICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICBzdWJ0b3RhbDogMTAsXG4gICAgICAgICAgc2hpcHBpbmdfY29zdDogNSxcbiAgICAgICAgICB0b3RhbF90YXg6IDIsXG4gICAgICAgICAgdG90YWxfY29zdDogMTVcbiAgICAgICAgfSxcbiAgICAgICAgZWxlbWVudHM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IGAke3Byb2R1Y3RbXCJuYW1lXCJdfWAsXG4gICAgICAgICAgICBzdWJ0aXRsZTogXCJcIixcbiAgICAgICAgICAgIHF1YW50aXR5OiBwcm9kdWN0W1wicXVhbnRpdHlcIl0sXG4gICAgICAgICAgICBwcmljZTogcHJvZHVjdFtcInByaWNlXCJdLFxuICAgICAgICAgICAgY3VycmVuY3k6IFwiU0dEXCIsXG4gICAgICAgICAgICBpbWFnZV91cmw6IHByb2R1Y3RbXCJ1cmxcIl1cbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIHByb2RvZHVjdCBlbnF1aXJ5XG5mdW5jdGlvbiBnZW5lcmF0ZVByb2R1Y3RFbnF1aXJ5UmVzcG9uc2UocHJvZHVjdCwgYXR0cmlidXRlKSB7XG4gIC8vIFRPRE86IEdldCBwcm9kdWN0IGZyb20gZGIsIGNyZWF0ZSBtZXNzYWdlIGFuZCBnZW5lcmF0ZSByZXNwb25zZVxuICByZXR1cm4gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFwiWW91IGFyZSBlbnF1aXJpbmcgYWJvdXQgdGhlIFwiICsgYXR0cmlidXRlICsgXCIgb2YgXCIgKyBwcm9kdWN0KTtcbn1cblxuLy8gUmVzcG9uc2Ugb24gcHJvZG9kdWN0IGVucXVpcnlcbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUHJvZHVjdFR5cGVFbnF1aXJ5UmVzcG9uc2UocHJvZHVjdF90eXBlLCBhdHRyaWJ1dGUpIHtcbiAgLy8gVE9ETzogR2V0IHByb2R1Y3QgZnJvbSBkYiwgY3JlYXRlIG1lc3NhZ2UgYW5kIGdlbmVyYXRlIHJlc3BvbnNlXG4gIGxldCBwcm9kdWN0cyA9IGF3YWl0IGdldFByb2R1Y3RzQnlUeXBlKHByb2R1Y3RfdHlwZSk7XG4gIHJldHVybiB7XG4gICAgdGV4dDogYFdoaWNoIHByb2R1Y3QgYXJlIHlvdSBlbnF1aXJpbmcgYWJvdXQgaXRzICR7YXR0cmlidXRlfT9gLFxuICAgIHF1aWNrX3JlcGxpZXM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIHRpdGxlOiBwcm9kdWN0LnRpdGxlLFxuICAgICAgICBwYXlsb2FkOiBgZW5xdWlyeV9wcm9kdWN0X2F0dHJpYnV0ZSAke2F0dHJpYnV0ZX0gJHtwcm9kdWN0LnRpdGxlfWBcbiAgICAgIH1cbiAgICB9KVxuICB9O1xufVxuIl19",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "express",
        "require",
        "bodyParser",
        "app",
        "use",
        "json",
        "request",
        "dotenv",
        "crypto",
        "mongoose",
        "config",
        "PAGE_ACCESS_TOKEN",
        "process",
        "env",
        "DB_PASSWORD",
        "connect",
        "useNewUrlParser",
        "useCreateIndex",
        "useFindAndModify",
        "then",
        "console",
        "log",
        "Promise",
        "global",
        "FB_APP_SECRET",
        "appsecret_proof",
        "createHmac",
        "update",
        "digest",
        "listen",
        "get",
        "req",
        "res",
        "VERIFY_TOKEN",
        "mode",
        "query",
        "token",
        "challenge",
        "status",
        "send",
        "sendStatus",
        "body",
        "post",
        "object",
        "entry",
        "forEach",
        "webhook_event",
        "messaging",
        "sender_psid",
        "sender",
        "id",
        "message",
        "quick_reply",
        "handlePostback",
        "handleMessage",
        "response",
        "user",
        "length",
        "postback",
        "defaultResponse",
        "generateResponseFromMessage",
        "received_message",
        "text",
        "processMessage",
        "callSendAPI",
        "received_postback",
        "payload",
        "postback_intent",
        "split",
        "postback_content",
        "substring",
        "indexOf",
        "generateAddCartResponse",
        "generateViewCartResponse",
        "attribute",
        "product",
        "generateProductEnquiryResponse",
        "attachment",
        "type",
        "template_type",
        "buttons",
        "title",
        "generateReceiptResponse",
        "request_body",
        "recipient",
        "uri",
        "qs",
        "access_token",
        "method",
        "err",
        "error",
        "entities",
        "nlp",
        "Object",
        "keys",
        "key",
        "is_greeting",
        "intent",
        "intent_parts",
        "intent_category",
        "intent_subcategory",
        "product_types",
        "filter",
        "obj",
        "map",
        "generateRecommendationsResponse",
        "product_type",
        "generateProductTypeEnquiryResponse",
        "messages",
        "profit",
        "manufacturer",
        "products",
        "entity",
        "product_name",
        "quantity",
        "elements",
        "subtitle",
        "image_url",
        "quick_replies",
        "content_type",
        "name",
        "price",
        "url",
        "recipient_name",
        "order_number",
        "currency",
        "payment_method",
        "order_url",
        "address",
        "street_1",
        "city",
        "postal_code",
        "state",
        "country",
        "summary",
        "subtotal",
        "shipping_cost",
        "total_tax",
        "total_cost"
      ],
      "mappings": "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",
      "file": "index.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\nconst express = require(\"express\"),\n  bodyParser = require(\"body-parser\"),\n  app = express().use(bodyParser.json()); // creates express http server\nconst request = require(\"request\");\nconst dotenv = require('dotenv');\nconst crypto = require('crypto');\nconst mongoose = require('mongoose');\ndotenv.config();\n\n// Get page access token\nconst PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Setup to connect to DB\nconst DB_PASSWORD = process.env.DB_PASSWORD;\nmongoose.connect('mongodb+srv://mongoadmin:'+ DB_PASSWORD +'@fb-hack-chatbot-cevnk.mongodb.net/fbmsg',{useNewUrlParser: true,useCreateIndex: true, useFindAndModify: false}).then(() => console.log(\"DB Connection successful\"));\nmongoose.Promise = global.Promise;\n\nimport { getAllProducts, getProductsByType, getProductByID, getProductPrice, getProductDesc, getProductsByName, getProductByNameVar, checkUser, createUser } from './DBConn';\nimport { getName, getProductDetails } from './fbhelper';\n\n// Get page access token\nconst FB_APP_SECRET = process.env.FB_APP_SECRET;\nconst appsecret_proof = crypto.createHmac('sha256',FB_APP_SECRET).update(PAGE_ACCESS_TOKEN).digest('hex')\n\n// Sets server port and logs message on success\napp.listen(3000, () => console.log(\"webhook is listening\"));\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", (req, res) => {\n  let VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  let mode = req.query[\"hub.mode\"];\n  let token = req.query[\"hub.verify_token\"];\n  let challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// For testing endpoints\napp.get(\"/test\", (req,res) =>{\n    let body = req.body;\n    // getAllProducts().then(function(products){\n    // console.log(products);\n    // });\n    // getProductByType(\"Baker\").then(function(products){\n    // console.log(products);\n    // });\n    // getProductByID('3060724697352196').then(function(prod){\n        // console.log(prod);\n    // });\n    // getProductPrice('3060724697352196').then(function(price){\n        // console.log(price);\n    // });\n    // getProductDesc('3060724697352196').then(function(description){\n        // console.log(description);\n    // });\n    // getProductsByName('Earl Grey Sunflower Seeds Cookies').then(function(prod){\n        // console.log(prod);\n    // });\n    // getProductByNameVar('Earl Grey Sunflower Seeds Cookies','Gift box').then(function(prod){\n    //     console.log(prod);\n    // });\n    res.status(200).send(\"Success\");\n    \n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", (req, res) => {\n  let body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function(entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      let webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      let sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        if (webhook_event.message.quick_reply) {\n          handlePostback(sender_psid, webhook_event.message.quick_reply);\n        } else {\n          handleMessage(sender_psid, webhook_event.message);\n        }\n        \n        getName(PAGE_ACCESS_TOKEN,sender_psid, function(response){\n            checkUser(sender_psid,response).then(function(user){\n                if (user.length == 0){\n                    createUser(sender_psid,response);\n                }\n            });\n        });\n\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\nlet defaultResponse = generateResponseFromMessage(\n  \"We could not understand your message. Kindly rephrase your message and send us again.\"\n);\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", (req, res) => {\n  let VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  let mode = req.query[\"hub.mode\"];\n  let token = req.query[\"hub.verify_token\"];\n  let challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Handles messages events\nasync function handleMessage(sender_psid, received_message) {\n  let response;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(`Received message: \"${received_message.text}\"`);\n\n    response = await processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  let response;\n\n  // Get the payload for the postback\n  let payload = received_postback.payload;\n  console.log(`Received postback: \"${payload}\"`);\n\n  let postback_intent = payload.split(\" \")[0];\n  let postback_content = payload.substring(\n    payload.indexOf(\" \") + 1,\n    payload.length\n  );\n  \n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\n      `What would you like to know about our ${postback_content}?`\n    );\n  } else if (postback_intent === \"enquiry_product_attribute\") {\n    let attribute = postback_content.substring(0, postback_content.indexOf(\" \") + 1);\n    let product = postback_content.substring(\n      postback_content.indexOf(\" \") + 1,\n      postback_content.length\n    );\n    response = generateProductEnquiryResponse(product, attribute);\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [\n            {\n              type: \"postback\",\n              title: \"Pay\",\n              payload: \"paid\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [\n            {\n              type: \"postback\",\n              title: \"View Receipt\",\n              payload: \"receipt_view\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  let request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request(\n    {\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    },\n    (err, res, body) => {\n      if (!err) {\n        console.log(\"Message sent!\");\n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    }\n  );\n}\n\n// Process text message and returns response object to handleMessage()\nfunction processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  let entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  Object.keys(entities).forEach(key => {\n    console.log(\"Entity: \" + key);\n    console.log(entities[key]);\n  });\n\n  // Check greeting\n  let is_greeting =\n    entities[\"greetings\"] != null &&\n    entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  let intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    let intent_parts = intent[\"value\"].split(\"_\");\n    let intent_category = intent_parts[0];\n    let intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    let response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        let product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"]\n            .filter(obj => obj[\"confidence\"] > 0.5)\n            .map(obj => obj[\"value\"]);\n        }\n\n        response = generateRecommendationsResponse(product_types);\n        console.log(response);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"product_attribute\"]) {\n            let product = entities[\"product\"][0][\"value\"];\n            let attribute = entities[\"product_attribute\"][0][\"value\"];\n            // Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else if (entities[\"product_type\"] && entities[\"product_attribute\"]) {\n            // Handle product type enquiry\n            let product_type = entities[\"product_type\"][0][\"value\"];\n            let attribute = entities[\"product_attribute\"][0][\"value\"];\n            response = generateProductTypeEnquiryResponse(product_type, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          let messages = {\n            profit:\n              \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer:\n              \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(entity => {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\n              \"Your latest order is <status>.\"\n            );\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\n              \"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\"\n            );\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\n              \"It is a flat fee of $2 for every order.\"\n            );\n          } else {\n            response = generateResponseFromMessage(\n              \"We deliver islandwide. The average delivery time takes 5-7 working days.\"\n            );\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          let product_name = entities[\"product\"][0][\"value\"];\n          let quantity = entities[\"number\"]\n            ? entities[\"number\"][0][\"value\"]\n            : 1;\n          response = generateAddCartResponse(\n            sender_psid,\n            product_name,\n            quantity\n          );\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\n      \"Hi there! Welcome to Bright. How can I help you?\"\n    );\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nasync function generateRecommendationsResponse(product_types) {\n  // Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  let products;\n  \n  if (product_types.length === 0) {\n    products = await getAllProducts();\n  } else {\n    products = await getProductsByType(product_types[0]);\n  }\n  \n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"title\"],\n            subtitle: `$${product[\"price\"]}`,\n            image_url: product[\"image_link\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Learn More\",\n                payload: `enquiry_product ${product[\"title\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Add to Cart\",\n                payload: `cart_add ${product[\"title\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: `Added ${quantity} ${product_name} to cart.`,\n    quick_replies: [\n      {\n        content_type: \"text\",\n        title: \"View Cart\",\n        payload: `cart_view`\n      },\n      {\n        content_type: \"text\",\n        title: \"Checkout\",\n        payload: `checkout`\n      }\n    ]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"name\"],\n            subtitle: `Qty: ${product[\"quantity\"]} ($${product[\"price\"]} each)`,\n            image_url: product[\"url\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Add 1\",\n                payload: `cart_add ${product[\"name\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Remove All\",\n                payload: `cart_remove ${product[\"name\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<CUSTOMER_NAME>\", // Mandatory field\n        order_number: \"<ORDER_NUMBER>\", // Mandatory field\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        order_url: \"\",\n        address: {\n          street_1: \"9 Straits View\", // Mandatory field\n          city: \"Singapore\",\n          postal_code: \"018937\",\n          state: \"SG\",\n          country: \"SG\"\n        },\n        summary: {\n          subtotal: 10,\n          shipping_cost: 5,\n          total_tax: 2,\n          total_cost: 15\n        },\n        elements: products.map(product => {\n          return {\n            title: `${product[\"name\"]}`,\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return generateResponseFromMessage(\"You are enquiring about the \" + attribute + \" of \" + product);\n}\n\n// Response on prododuct enquiry\nasync function generateProductTypeEnquiryResponse(product_type, attribute) {\n  // TODO: Get product from db, create message and generate response\n  let products = await getProductsByType(product_type);\n  return {\n    text: `Which product are you enquiring about its ${attribute}?`,\n    quick_replies: products.map(product => {\n      return {\n        content_type: \"text\",\n        title: product.title,\n        payload: `enquiry_product_attribute ${attribute} ${product.title}`\n      }\n    })\n  };\n}\n"
      ]
    },
    "mtime": 1592564013000
  },
  "{\"filename\":\"/app/DBConn.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [
            "getAllProducts",
            "getProductsByType",
            "getProductByID",
            "getProductPrice",
            "getProductDesc",
            "getProductsByName",
            "getProductByNameVar",
            "checkUser",
            "createUser"
          ],
          "specifiers": [
            {
              "kind": "local",
              "local": "getAllProducts",
              "exported": "getAllProducts"
            },
            {
              "kind": "local",
              "local": "getProductsByType",
              "exported": "getProductsByType"
            },
            {
              "kind": "local",
              "local": "getProductByID",
              "exported": "getProductByID"
            },
            {
              "kind": "local",
              "local": "getProductPrice",
              "exported": "getProductPrice"
            },
            {
              "kind": "local",
              "local": "getProductDesc",
              "exported": "getProductDesc"
            },
            {
              "kind": "local",
              "local": "getProductsByName",
              "exported": "getProductsByName"
            },
            {
              "kind": "local",
              "local": "getProductByNameVar",
              "exported": "getProductByNameVar"
            },
            {
              "kind": "local",
              "local": "checkUser",
              "exported": "checkUser"
            },
            {
              "kind": "local",
              "local": "createUser",
              "exported": "createUser"
            }
          ]
        }
      }
    },
    "options": {
      "filename": "/app/DBConn.js",
      "filenameRelative": "/app/DBConn.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "DBConn.js",
      "sourceFileName": "DBConn.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "DBConn"
    },
    "ignored": false,
    "code": "'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nvar mongoose = require('mongoose');\n\nvar userSchema = new mongoose.Schema({\n    id: String,\n    name: String\n});\n\nvar productsSchema = new mongoose.Schema({\n    id: String,\n    pid: String,\n    title: String,\n    description: String,\n    availability: String,\n    inventory: String,\n    condition: String,\n    price: String,\n    link: String,\n    image_link: String,\n    brand: String,\n    item_group_id: String,\n    color: String,\n    pattern: String,\n    product_type: String,\n    allergens: String\n});\n\nvar cartSchema = new mongoose.Schema({\n    uid: String,\n    pid: String,\n    quantity: Number,\n    price: Number\n});\n\nvar ordersSchema = new mongoose.Schema({\n    uid: String,\n    trackingNum: Number,\n    orderStatus: Number,\n    orderDateTime: Date,\n    orderDetails: [{ name: String, pid: String, quantity: Number, price: Number }]\n    // Are we able to find a way to use Double/Float for datatypes?\n});\n\nvar User = mongoose.model('users', userSchema);\nvar Product = mongoose.model('products', productsSchema);\nvar Cart = mongoose.model('cart', cartSchema);\nvar Order = mongoose.model('orders', ordersSchema);\n\n// Create user if user not found in database\nfunction createUser(fbid, name) {\n    var newUser = new User({\n        id: fbid,\n        name: name\n    });\n    newUser.save().then(function (doc) {\n        return console.log(doc);\n    }).catch(function (err) {\n        return console.log(err);\n    });\n}\n\nfunction checkUser(fbid) {\n    return User.find({ 'id': fbid }).then(function (user) {\n        return user;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Get all products\nfunction getAllProducts() {\n    return Product.find({}).then(function (products) {\n        return products;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Get product by type\nfunction getProductsByType(typeValue) {\n    return Product.find({ 'product_type': typeValue }).then(function (products) {\n        return products;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Get product by ID\nfunction getProductByID(pid) {\n    return Product.find({ 'pid': pid }).then(function (prod) {\n        return prod;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// Get product Price by ID\nfunction getProductPrice(pid) {\n    return Product.find({ 'pid': pid }).then(function (prod) {\n        return prod[0].price;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// get product Desc by ID\nfunction getProductDesc(pid) {\n    return Product.find({ 'pid': pid }).then(function (prod) {\n        return prod[0].description;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// get products with all the differnt variations by Name\nfunction getProductsByName(name) {\n    return Product.find({ 'title': name }).then(function (prod) {\n        return prod;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n// get product by name and variation\nfunction getProductByNameVar(name, variation) {\n    return Product.find({ 'title': name, 'pattern': variation }).then(function (prod) {\n        return prod;\n    }).catch(function (err) {\n        console.log(err);\n    });\n}\n\n//Check if user has an active shopping cart\nfunction checkCart(userID, products, quantity) {\n    pool.query('SELECT * FROM cart where uid=$1', [userID], function (error, results) {\n        if (error) {\n            throw error;\n        }\n        rowCount = results.rowCount;\n        console.log(results);\n        if (rowCount == 0) {\n            createCart(userID, products, quantity);\n        } else {\n            products += results.something;\n            quantity += results.something;\n            updateCart(userID, products, quantity);\n        }\n    });\n}\n\n// Initial creation of a fresh cart\nfunction createCart(userID, products, quantity) {\n    pool.query('INSERT INTO cart(uid,products,quantity) VALUES ($1,$2,$3)', [userID, products, quantity], function (error, reuslts) {\n        if (error) {\n            throw error;\n        }\n        console.log(results.insertId);\n    });\n}\n\n// Update cart if user has an active cart\nfunction updateCart(userID, products, quantity) {\n    pool.query('UPDATE cart SET products=$1, quantity=$2 WHERE uid=$3', [products, quantity, userID], function (error, results) {\n        if (error) {\n            throw error;\n        }\n        console.log(results.insertId);\n    });\n}\n\nexports.getAllProducts = getAllProducts;\nexports.getProductsByType = getProductsByType;\nexports.getProductByID = getProductByID;\nexports.getProductPrice = getProductPrice;\nexports.getProductDesc = getProductDesc;\nexports.getProductsByName = getProductsByName;\nexports.getProductByNameVar = getProductByNameVar;\nexports.checkUser = checkUser;\nexports.createUser = createUser;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRCQ29ubi5qcyJdLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJ1c2VyU2NoZW1hIiwiU2NoZW1hIiwiaWQiLCJTdHJpbmciLCJuYW1lIiwicHJvZHVjdHNTY2hlbWEiLCJwaWQiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwiYXZhaWxhYmlsaXR5IiwiaW52ZW50b3J5IiwiY29uZGl0aW9uIiwicHJpY2UiLCJsaW5rIiwiaW1hZ2VfbGluayIsImJyYW5kIiwiaXRlbV9ncm91cF9pZCIsImNvbG9yIiwicGF0dGVybiIsInByb2R1Y3RfdHlwZSIsImFsbGVyZ2VucyIsImNhcnRTY2hlbWEiLCJ1aWQiLCJxdWFudGl0eSIsIk51bWJlciIsIm9yZGVyc1NjaGVtYSIsInRyYWNraW5nTnVtIiwib3JkZXJTdGF0dXMiLCJvcmRlckRhdGVUaW1lIiwiRGF0ZSIsIm9yZGVyRGV0YWlscyIsIlVzZXIiLCJtb2RlbCIsIlByb2R1Y3QiLCJDYXJ0IiwiT3JkZXIiLCJjcmVhdGVVc2VyIiwiZmJpZCIsIm5ld1VzZXIiLCJzYXZlIiwidGhlbiIsImNvbnNvbGUiLCJsb2ciLCJkb2MiLCJjYXRjaCIsImVyciIsImNoZWNrVXNlciIsImZpbmQiLCJ1c2VyIiwiZ2V0QWxsUHJvZHVjdHMiLCJwcm9kdWN0cyIsImdldFByb2R1Y3RzQnlUeXBlIiwidHlwZVZhbHVlIiwiZ2V0UHJvZHVjdEJ5SUQiLCJwcm9kIiwiZ2V0UHJvZHVjdFByaWNlIiwiZ2V0UHJvZHVjdERlc2MiLCJnZXRQcm9kdWN0c0J5TmFtZSIsImdldFByb2R1Y3RCeU5hbWVWYXIiLCJ2YXJpYXRpb24iLCJjaGVja0NhcnQiLCJ1c2VySUQiLCJwb29sIiwicXVlcnkiLCJlcnJvciIsInJlc3VsdHMiLCJyb3dDb3VudCIsImNyZWF0ZUNhcnQiLCJzb21ldGhpbmciLCJ1cGRhdGVDYXJ0IiwicmV1c2x0cyIsImluc2VydElkIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBLElBQU1BLFdBQVdDLFFBQVEsVUFBUixD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Q29ubi5qcyIsInNvdXJjZVJvb3QiOiIvYXBwIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xuXG5jb25zdCB1c2VyU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gICAgaWQ6IFN0cmluZyxcbiAgICBuYW1lOiBTdHJpbmdcbn0pO1xuXG5jb25zdCBwcm9kdWN0c1NjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgIGlkOiBTdHJpbmcsXG4gICAgcGlkOiBTdHJpbmcsXG4gICAgdGl0bGU6IFN0cmluZyxcbiAgICBkZXNjcmlwdGlvbjogU3RyaW5nLFxuICAgIGF2YWlsYWJpbGl0eTogU3RyaW5nLFxuICAgIGludmVudG9yeTogU3RyaW5nLFxuICAgIGNvbmRpdGlvbjogU3RyaW5nLFxuICAgIHByaWNlOiBTdHJpbmcsXG4gICAgbGluazogU3RyaW5nLFxuICAgIGltYWdlX2xpbms6IFN0cmluZyxcbiAgICBicmFuZDogU3RyaW5nLFxuICAgIGl0ZW1fZ3JvdXBfaWQ6IFN0cmluZyxcbiAgICBjb2xvcjogU3RyaW5nLFxuICAgIHBhdHRlcm46IFN0cmluZyxcbiAgICBwcm9kdWN0X3R5cGU6IFN0cmluZyxcbiAgICBhbGxlcmdlbnM6IFN0cmluZ1xufSk7XG5cbmNvbnN0IGNhcnRTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgICB1aWQ6IFN0cmluZyxcbiAgICBwaWQ6IFN0cmluZyxcbiAgICBxdWFudGl0eTogTnVtYmVyLFxuICAgIHByaWNlOiBOdW1iZXJcbn0pXG5cbmNvbnN0IG9yZGVyc1NjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICAgIHVpZDogU3RyaW5nLFxuICAgIHRyYWNraW5nTnVtOiBOdW1iZXIsXG4gICAgb3JkZXJTdGF0dXM6IE51bWJlcixcbiAgICBvcmRlckRhdGVUaW1lOiBEYXRlLFxuICAgIG9yZGVyRGV0YWlsczogW3tuYW1lOlN0cmluZyxwaWQ6U3RyaW5nLHF1YW50aXR5Ok51bWJlcixwcmljZTpOdW1iZXJ9XSBcbiAgICAvLyBBcmUgd2UgYWJsZSB0byBmaW5kIGEgd2F5IHRvIHVzZSBEb3VibGUvRmxvYXQgZm9yIGRhdGF0eXBlcz9cbn0pXG5cbmNvbnN0IFVzZXIgPSBtb25nb29zZS5tb2RlbCgndXNlcnMnLHVzZXJTY2hlbWEpO1xuY29uc3QgUHJvZHVjdCA9IG1vbmdvb3NlLm1vZGVsKCdwcm9kdWN0cycscHJvZHVjdHNTY2hlbWEpO1xuY29uc3QgQ2FydCA9IG1vbmdvb3NlLm1vZGVsKCdjYXJ0JyxjYXJ0U2NoZW1hKTtcbmNvbnN0IE9yZGVyID0gbW9uZ29vc2UubW9kZWwoJ29yZGVycycsb3JkZXJzU2NoZW1hKTtcblxuLy8gQ3JlYXRlIHVzZXIgaWYgdXNlciBub3QgZm91bmQgaW4gZGF0YWJhc2VcbmZ1bmN0aW9uIGNyZWF0ZVVzZXIoZmJpZCxuYW1lKXtcbiAgICB2YXIgbmV3VXNlciA9IG5ldyBVc2VyKHtcbiAgICAgICAgaWQ6ZmJpZCxcbiAgICAgICAgbmFtZTpuYW1lXG4gICAgfSk7XG4gICAgbmV3VXNlci5zYXZlKCkudGhlbihkb2MgPT4gY29uc29sZS5sb2coZG9jKSkuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpO1xufVxuXG5mdW5jdGlvbiBjaGVja1VzZXIoZmJpZCl7XG4gICAgcmV0dXJuIFVzZXIuZmluZCh7J2lkJzpmYmlkfSkudGhlbihmdW5jdGlvbih1c2VyKXtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KTtcbn1cblxuLy9HZXQgYWxsIHByb2R1Y3RzXG5mdW5jdGlvbiBnZXRBbGxQcm9kdWN0cygpe1xuICAgIHJldHVybiBQcm9kdWN0LmZpbmQoe30pLnRoZW4oZnVuY3Rpb24ocHJvZHVjdHMpe1xuICAgICAgICByZXR1cm4gcHJvZHVjdHM7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KTtcbn1cblxuLy9HZXQgcHJvZHVjdCBieSB0eXBlXG5mdW5jdGlvbiBnZXRQcm9kdWN0c0J5VHlwZSh0eXBlVmFsdWUpe1xuICAgIHJldHVybiBQcm9kdWN0LmZpbmQoeydwcm9kdWN0X3R5cGUnOnR5cGVWYWx1ZX0pLnRoZW4oZnVuY3Rpb24ocHJvZHVjdHMpe1xuICAgICAgICByZXR1cm4gcHJvZHVjdHM7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICB9KTtcbn1cblxuLy9HZXQgcHJvZHVjdCBieSBJRFxuZnVuY3Rpb24gZ2V0UHJvZHVjdEJ5SUQocGlkKXtcbiAgICByZXR1cm4gUHJvZHVjdC5maW5kKHsncGlkJzpwaWR9KS50aGVuKGZ1bmN0aW9uKHByb2Qpe1xuICAgICAgICByZXR1cm4gcHJvZDtcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgIGNvbnNvbGUubG9nKGVycikgXG4gICAgfSk7XG59XG5cbi8vIEdldCBwcm9kdWN0IFByaWNlIGJ5IElEXG5mdW5jdGlvbiBnZXRQcm9kdWN0UHJpY2UocGlkKXtcbiAgICByZXR1cm4gUHJvZHVjdC5maW5kKHsncGlkJzpwaWR9KS50aGVuKGZ1bmN0aW9uKHByb2Qpe1xuICAgICAgICByZXR1cm4gcHJvZFswXS5wcmljZTtcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuICAgICAgIGNvbnNvbGUubG9nKGVycikgXG4gICAgfSk7XG59XG5cbi8vIGdldCBwcm9kdWN0IERlc2MgYnkgSURcbmZ1bmN0aW9uIGdldFByb2R1Y3REZXNjKHBpZCl7XG4gICAgcmV0dXJuIFByb2R1Y3QuZmluZCh7J3BpZCc6cGlkfSkudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgcmV0dXJuIHByb2RbMF0uZGVzY3JpcHRpb247XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICBjb25zb2xlLmxvZyhlcnIpIFxuICAgIH0pO1xufVxuXG4vLyBnZXQgcHJvZHVjdHMgd2l0aCBhbGwgdGhlIGRpZmZlcm50IHZhcmlhdGlvbnMgYnkgTmFtZVxuZnVuY3Rpb24gZ2V0UHJvZHVjdHNCeU5hbWUobmFtZSl7XG4gICAgcmV0dXJuIFByb2R1Y3QuZmluZCh7J3RpdGxlJzpuYW1lfSkudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgcmV0dXJuIHByb2Q7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICBjb25zb2xlLmxvZyhlcnIpIFxuICAgIH0pO1xufVxuXG4vLyBnZXQgcHJvZHVjdCBieSBuYW1lIGFuZCB2YXJpYXRpb25cbmZ1bmN0aW9uIGdldFByb2R1Y3RCeU5hbWVWYXIobmFtZSx2YXJpYXRpb24pe1xuICAgIHJldHVybiBQcm9kdWN0LmZpbmQoeyd0aXRsZSc6bmFtZSwncGF0dGVybic6dmFyaWF0aW9ufSkudGhlbihmdW5jdGlvbihwcm9kKXtcbiAgICAgICAgcmV0dXJuIHByb2Q7XG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcbiAgICAgICBjb25zb2xlLmxvZyhlcnIpIFxuICAgIH0pO1xufVxuXG4vL0NoZWNrIGlmIHVzZXIgaGFzIGFuIGFjdGl2ZSBzaG9wcGluZyBjYXJ0XG5mdW5jdGlvbiBjaGVja0NhcnQodXNlcklELHByb2R1Y3RzLHF1YW50aXR5KXtcbiAgICBwb29sLnF1ZXJ5KCdTRUxFQ1QgKiBGUk9NIGNhcnQgd2hlcmUgdWlkPSQxJyxbdXNlcklEXSwoZXJyb3IsIHJlc3VsdHMpID0+e1xuICAgIGlmIChlcnJvcil7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgICByb3dDb3VudCA9IHJlc3VsdHMucm93Q291bnQ7XG4gICAgY29uc29sZS5sb2cocmVzdWx0cylcbiAgICBpZiAocm93Q291bnQgPT0gMCl7XG4gICAgICAgIGNyZWF0ZUNhcnQodXNlcklELHByb2R1Y3RzLHF1YW50aXR5KTtcbiAgICB9XG4gICAgZWxzZXtcbiAgICAgICAgcHJvZHVjdHMgKz0gcmVzdWx0cy5zb21ldGhpbmc7XG4gICAgICAgIHF1YW50aXR5ICs9IHJlc3VsdHMuc29tZXRoaW5nO1xuICAgICAgICB1cGRhdGVDYXJ0KHVzZXJJRCxwcm9kdWN0cyxxdWFudGl0eSk7XG4gICAgfX0pXG59XG5cbi8vIEluaXRpYWwgY3JlYXRpb24gb2YgYSBmcmVzaCBjYXJ0XG5mdW5jdGlvbiBjcmVhdGVDYXJ0KHVzZXJJRCxwcm9kdWN0cyxxdWFudGl0eSl7XG4gICAgcG9vbC5xdWVyeSgnSU5TRVJUIElOVE8gY2FydCh1aWQscHJvZHVjdHMscXVhbnRpdHkpIFZBTFVFUyAoJDEsJDIsJDMpJyxbdXNlcklELHByb2R1Y3RzLHF1YW50aXR5XSwoZXJyb3IscmV1c2x0cyk9PntcbiAgICAgICAgaWYgKGVycm9yKXtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMuaW5zZXJ0SWQpO1xuICAgIH0pXG59XG5cbi8vIFVwZGF0ZSBjYXJ0IGlmIHVzZXIgaGFzIGFuIGFjdGl2ZSBjYXJ0XG5mdW5jdGlvbiB1cGRhdGVDYXJ0KHVzZXJJRCxwcm9kdWN0cyxxdWFudGl0eSl7XG4gICAgcG9vbC5xdWVyeSgnVVBEQVRFIGNhcnQgU0VUIHByb2R1Y3RzPSQxLCBxdWFudGl0eT0kMiBXSEVSRSB1aWQ9JDMnLFtwcm9kdWN0cyxxdWFudGl0eSx1c2VySURdLChlcnJvcixyZXN1bHRzKT0+IHtcbiAgICAgICAgaWYgKGVycm9yKXtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdHMuaW5zZXJ0SWQpO1xuICAgIH0pXG59XG5cbmV4cG9ydCB7IGdldEFsbFByb2R1Y3RzLCBnZXRQcm9kdWN0c0J5VHlwZSwgZ2V0UHJvZHVjdEJ5SUQsIGdldFByb2R1Y3RQcmljZSwgZ2V0UHJvZHVjdERlc2MsIGdldFByb2R1Y3RzQnlOYW1lLCBnZXRQcm9kdWN0QnlOYW1lVmFyLCBjaGVja1VzZXIsIGNyZWF0ZVVzZXIgfTtcbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "DBConn.js"
      ],
      "names": [
        "mongoose",
        "require",
        "userSchema",
        "Schema",
        "id",
        "String",
        "name",
        "productsSchema",
        "pid",
        "title",
        "description",
        "availability",
        "inventory",
        "condition",
        "price",
        "link",
        "image_link",
        "brand",
        "item_group_id",
        "color",
        "pattern",
        "product_type",
        "allergens",
        "cartSchema",
        "uid",
        "quantity",
        "Number",
        "ordersSchema",
        "trackingNum",
        "orderStatus",
        "orderDateTime",
        "Date",
        "orderDetails",
        "User",
        "model",
        "Product",
        "Cart",
        "Order",
        "createUser",
        "fbid",
        "newUser",
        "save",
        "then",
        "console",
        "log",
        "doc",
        "catch",
        "err",
        "checkUser",
        "find",
        "user",
        "getAllProducts",
        "products",
        "getProductsByType",
        "typeValue",
        "getProductByID",
        "prod",
        "getProductPrice",
        "getProductDesc",
        "getProductsByName",
        "getProductByNameVar",
        "variation",
        "checkCart",
        "userID",
        "pool",
        "query",
        "error",
        "results",
        "rowCount",
        "createCart",
        "something",
        "updateCart",
        "reuslts",
        "insertId"
      ],
      "mappings": "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",
      "file": "DBConn.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "const mongoose = require('mongoose');\n\nconst userSchema = new mongoose.Schema({\n    id: String,\n    name: String\n});\n\nconst productsSchema = new mongoose.Schema({\n    id: String,\n    pid: String,\n    title: String,\n    description: String,\n    availability: String,\n    inventory: String,\n    condition: String,\n    price: String,\n    link: String,\n    image_link: String,\n    brand: String,\n    item_group_id: String,\n    color: String,\n    pattern: String,\n    product_type: String,\n    allergens: String\n});\n\nconst cartSchema = new mongoose.Schema({\n    uid: String,\n    pid: String,\n    quantity: Number,\n    price: Number\n})\n\nconst ordersSchema = new mongoose.Schema({\n    uid: String,\n    trackingNum: Number,\n    orderStatus: Number,\n    orderDateTime: Date,\n    orderDetails: [{name:String,pid:String,quantity:Number,price:Number}] \n    // Are we able to find a way to use Double/Float for datatypes?\n})\n\nconst User = mongoose.model('users',userSchema);\nconst Product = mongoose.model('products',productsSchema);\nconst Cart = mongoose.model('cart',cartSchema);\nconst Order = mongoose.model('orders',ordersSchema);\n\n// Create user if user not found in database\nfunction createUser(fbid,name){\n    var newUser = new User({\n        id:fbid,\n        name:name\n    });\n    newUser.save().then(doc => console.log(doc)).catch(err => console.log(err));\n}\n\nfunction checkUser(fbid){\n    return User.find({'id':fbid}).then(function(user){\n        return user;\n    }).catch(function(err){\n        console.log(err);\n    });\n}\n\n//Get all products\nfunction getAllProducts(){\n    return Product.find({}).then(function(products){\n        return products;\n    }).catch(function(err){\n        console.log(err);\n    });\n}\n\n//Get product by type\nfunction getProductsByType(typeValue){\n    return Product.find({'product_type':typeValue}).then(function(products){\n        return products;\n    }).catch(function(err){\n        console.log(err);\n    });\n}\n\n//Get product by ID\nfunction getProductByID(pid){\n    return Product.find({'pid':pid}).then(function(prod){\n        return prod;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// Get product Price by ID\nfunction getProductPrice(pid){\n    return Product.find({'pid':pid}).then(function(prod){\n        return prod[0].price;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// get product Desc by ID\nfunction getProductDesc(pid){\n    return Product.find({'pid':pid}).then(function(prod){\n        return prod[0].description;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// get products with all the differnt variations by Name\nfunction getProductsByName(name){\n    return Product.find({'title':name}).then(function(prod){\n        return prod;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n// get product by name and variation\nfunction getProductByNameVar(name,variation){\n    return Product.find({'title':name,'pattern':variation}).then(function(prod){\n        return prod;\n    }).catch(function(err){\n       console.log(err) \n    });\n}\n\n//Check if user has an active shopping cart\nfunction checkCart(userID,products,quantity){\n    pool.query('SELECT * FROM cart where uid=$1',[userID],(error, results) =>{\n    if (error){\n        throw error;\n    }\n    rowCount = results.rowCount;\n    console.log(results)\n    if (rowCount == 0){\n        createCart(userID,products,quantity);\n    }\n    else{\n        products += results.something;\n        quantity += results.something;\n        updateCart(userID,products,quantity);\n    }})\n}\n\n// Initial creation of a fresh cart\nfunction createCart(userID,products,quantity){\n    pool.query('INSERT INTO cart(uid,products,quantity) VALUES ($1,$2,$3)',[userID,products,quantity],(error,reuslts)=>{\n        if (error){\n            throw error;\n        }\n        console.log(results.insertId);\n    })\n}\n\n// Update cart if user has an active cart\nfunction updateCart(userID,products,quantity){\n    pool.query('UPDATE cart SET products=$1, quantity=$2 WHERE uid=$3',[products,quantity,userID],(error,results)=> {\n        if (error){\n            throw error;\n        }\n        console.log(results.insertId);\n    })\n}\n\nexport { getAllProducts, getProductsByType, getProductByID, getProductPrice, getProductDesc, getProductsByName, getProductByNameVar, checkUser, createUser };\n"
      ]
    },
    "mtime": 1592497258000
  },
  "{\"filename\":\"/app/fbhelper.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [
            "getName",
            "getAllProducts",
            "getProductDetails"
          ],
          "specifiers": [
            {
              "kind": "local",
              "local": "getName",
              "exported": "getName"
            },
            {
              "kind": "local",
              "local": "getAllProducts",
              "exported": "getAllProducts"
            },
            {
              "kind": "local",
              "local": "getProductDetails",
              "exported": "getProductDetails"
            }
          ]
        }
      }
    },
    "options": {
      "filename": "/app/fbhelper.js",
      "filenameRelative": "/app/fbhelper.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "fbhelper.js",
      "sourceFileName": "fbhelper.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "fbhelper"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n//Gets users name from facebook graph api\nvar request = require(\"request\");\nvar CATLOG_ID = process.env.CATLOG_ID;\nvar fields = \"currency,availability,condition,id,inventory,image_url,name,price,retailer_id,retailer_product_group_id,description,custom_label_0,pattern,product_type,color,url,product_group\";\nvar uri = \"https://graph.facebook.com/v7.0/\";\n\nfunction getName(PAGE_ACCESS_TOKEN, sender_psid, callback) {\n    var name = \"Empty\";\n    request({\n        url: uri + sender_psid,\n        qs: {\n            access_token: PAGE_ACCESS_TOKEN,\n            fields: \"first_name\"\n        },\n        method: \"GET\"\n    }, function (error, response, body) {\n        if (error) {\n            console.log(error);\n        } else {\n            var bodyObj = JSON.parse(body);\n            name = bodyObj.first_name;\n            console.log(\"Name: \" + name);\n            return callback(name);\n        }\n    });\n    return name;\n}\n\n//Get all products with their ID from Facebook\nfunction getAllProducts(PAGE_ACCESS_TOKEN, appsecret_proof) {\n    request({\n        url: uri + CATLOG_ID,\n        qs: {\n            access_token: PAGE_ACCESS_TOKEN,\n            appsecret_proof: appsecret_proof\n        },\n        method: \"GET\"\n    }, function (error, response, body) {\n        if (error) {\n            console.log(error);\n        } else {\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj);\n        }\n    });\n}\n\n//Gets product details from Facebook\nfunction getProductDetails(productID, callback) {\n    request({\n        url: uri + productID,\n        qs: {\n            access_token: PAGE_ACCESS_TOKEN,\n            fields: reqFields\n        },\n        method: \"GET\"\n    }, function (error, response, body) {\n        if (error) {\n            console.log(error);\n        } else {\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj);\n            return callback(bodyObj);\n        }\n    });\n}\n\nexports.getName = getName;\nexports.getAllProducts = getAllProducts;\nexports.getProductDetails = getProductDetails;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZiaGVscGVyLmpzIl0sIm5hbWVzIjpbInJlcXVlc3QiLCJyZXF1aXJlIiwiQ0FUTE9HX0lEIiwicHJvY2VzcyIsImVudiIsImZpZWxkcyIsInVyaSIsImdldE5hbWUiLCJQQUdFX0FDQ0VTU19UT0tFTiIsInNlbmRlcl9wc2lkIiwiY2FsbGJhY2siLCJuYW1lIiwidXJsIiwicXMiLCJhY2Nlc3NfdG9rZW4iLCJtZXRob2QiLCJlcnJvciIsInJlc3BvbnNlIiwiYm9keSIsImNvbnNvbGUiLCJsb2ciLCJib2R5T2JqIiwiSlNPTiIsInBhcnNlIiwiZmlyc3RfbmFtZSIsImdldEFsbFByb2R1Y3RzIiwiYXBwc2VjcmV0X3Byb29mIiwiZ2V0UHJvZHVjdERldGFpbHMiLCJwcm9kdWN0SUQiLCJyZXFGaWVsZHMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQSxJQUFNQSxVQUFVQyxRQUFRLFNBQVIsQ0FBaEI7QUFDQSxJQUFNQyxZQUFZQyxRQUFRQyxHQUFSLENBQVlGLFNBQTlCO0FBQ0EsSUFBTUcsU0FBUyxpTEFBZjtBQUNBLElBQU1DLE1BQU0sa0NBQVo7O0FBRUEsU0FBU0MsT0FBVCxDQUFpQkMsaUJBQWpCLEVBQW1DQyxXQUFuQyxFQUErQ0MsUUFBL0MsRUFBd0Q7QUFDcEQsUUFBSUMsT0FBTyxPQUFYO0FBQ0FYLFlBQVE7QUFDSlksYUFBSU4sTUFBTUcsV0FETjtBQUVKSSxZQUFHO0FBQ0NDLDBCQUFjTixpQkFEZjtBQUVDSCxvQkFBUTtBQUZULFNBRkM7QUFNSlUsZ0JBQU87QUFOSCxLQUFSLEVBT0csVUFBU0MsS0FBVCxFQUFlQyxRQUFmLEVBQXdCQyxJQUF4QixFQUE2QjtBQUM1QixZQUFJRixLQUFKLEVBQVU7QUFDTkcsb0JBQVFDLEdBQVIsQ0FBWUosS0FBWjtBQUNILFNBRkQsTUFFSztBQUNELGdCQUFJSyxVQUFVQyxLQUFLQyxLQUFMLENBQVdMLElBQVgsQ0FBZDtBQUNBUCxtQkFBT1UsUUFBUUcsVUFBZjtBQUNBTCxvQkFBUUMsR0FBUixDQUFZLFdBQVdULElBQXZCO0FBQ0EsbUJBQU9ELFNBQVNDLElBQVQsQ0FBUDtBQUNIO0FBQ0osS0FoQkQ7QUFpQkEsV0FBT0EsSUFBUDtBQUNIOztBQUVEO0FBQ0EsU0FBU2MsY0FBVCxDQUF3QmpCLGlCQUF4QixFQUEwQ2tCLGVBQTFDLEVBQTBEO0FBQ3REMUIsWUFBUTtBQUNKWSxhQUFLTixNQUFNSixTQURQO0FBRUpXLFlBQUc7QUFDQ0MsMEJBQWNOLGlCQURmO0FBRUNrQiw2QkFBaUJBO0FBRmxCLFNBRkM7QUFNSlgsZ0JBQU87QUFOSCxLQUFSLEVBT0csVUFBU0MsS0FBVCxFQUFlQyxRQUFmLEVBQXdCQyxJQUF4QixFQUE2QjtBQUM1QixZQUFJRixLQUFKLEVBQVU7QUFDTkcsb0JBQVFDLEdBQVIsQ0FBWUosS0FBWjtBQUNILFNBRkQsTUFFSztBQUNELGdCQUFJSyxVQUFVQyxLQUFLQyxLQUFMLENBQVdMLElBQVgsQ0FBZDtBQUNBQyxvQkFBUUMsR0FBUixDQUFZQyxPQUFaO0FBQ0g7QUFDSixLQWREO0FBZUg7O0FBR0Q7QUFDQSxTQUFTTSxpQkFBVCxDQUEyQkMsU0FBM0IsRUFBcUNsQixRQUFyQyxFQUE4QztBQUMxQ1YsWUFBUTtBQUNKWSxhQUFJTixNQUFNc0IsU0FETjtBQUVKZixZQUFHO0FBQ0NDLDBCQUFjTixpQkFEZjtBQUVDSCxvQkFBT3dCO0FBRlIsU0FGQztBQU1KZCxnQkFBTztBQU5ILEtBQVIsRUFPRyxVQUFTQyxLQUFULEVBQWVDLFFBQWYsRUFBd0JDLElBQXhCLEVBQTZCO0FBQ2hDLFlBQUlGLEtBQUosRUFBVTtBQUNGRyxvQkFBUUMsR0FBUixDQUFZSixLQUFaO0FBQ0gsU0FGTCxNQUVTO0FBQ0QsZ0JBQUlLLFVBQVVDLEtBQUtDLEtBQUwsQ0FBV0wsSUFBWCxDQUFkO0FBQ0FDLG9CQUFRQyxHQUFSLENBQVlDLE9BQVo7QUFDQSxtQkFBT1gsU0FBU1csT0FBVCxDQUFQO0FBQ0g7QUFDSixLQWZEO0FBZ0JIOztRQUlRZCxPLEdBQUFBLE87UUFBU2tCLGMsR0FBQUEsYztRQUFnQkUsaUIsR0FBQUEsaUIiLCJmaWxlIjoiZmJoZWxwZXIuanMiLCJzb3VyY2VSb290IjoiL2FwcCIsInNvdXJjZXNDb250ZW50IjpbIi8vR2V0cyB1c2VycyBuYW1lIGZyb20gZmFjZWJvb2sgZ3JhcGggYXBpXG5jb25zdCByZXF1ZXN0ID0gcmVxdWlyZShcInJlcXVlc3RcIik7XG5jb25zdCBDQVRMT0dfSUQgPSBwcm9jZXNzLmVudi5DQVRMT0dfSUQ7XG5jb25zdCBmaWVsZHMgPSBcImN1cnJlbmN5LGF2YWlsYWJpbGl0eSxjb25kaXRpb24saWQsaW52ZW50b3J5LGltYWdlX3VybCxuYW1lLHByaWNlLHJldGFpbGVyX2lkLHJldGFpbGVyX3Byb2R1Y3RfZ3JvdXBfaWQsZGVzY3JpcHRpb24sY3VzdG9tX2xhYmVsXzAscGF0dGVybixwcm9kdWN0X3R5cGUsY29sb3IsdXJsLHByb2R1Y3RfZ3JvdXBcIjtcbmNvbnN0IHVyaSA9IFwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjcuMC9cIlxuXG5mdW5jdGlvbiBnZXROYW1lKFBBR0VfQUNDRVNTX1RPS0VOLHNlbmRlcl9wc2lkLGNhbGxiYWNrKXtcbiAgICB2YXIgbmFtZSA9IFwiRW1wdHlcIjtcbiAgICByZXF1ZXN0KHtcbiAgICAgICAgdXJsOnVyaSArIHNlbmRlcl9wc2lkLFxuICAgICAgICBxczp7XG4gICAgICAgICAgICBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOLFxuICAgICAgICAgICAgZmllbGRzOiBcImZpcnN0X25hbWVcIixcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOlwiR0VUXCJcbiAgICB9LCBmdW5jdGlvbihlcnJvcixyZXNwb25zZSxib2R5KXtcbiAgICAgICAgaWYgKGVycm9yKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHZhciBib2R5T2JqID0gSlNPTi5wYXJzZShib2R5KTtcbiAgICAgICAgICAgIG5hbWUgPSBib2R5T2JqLmZpcnN0X25hbWU7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk5hbWU6IFwiICsgbmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobmFtZSlcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBuYW1lO1xufVxuXG4vL0dldCBhbGwgcHJvZHVjdHMgd2l0aCB0aGVpciBJRCBmcm9tIEZhY2Vib29rXG5mdW5jdGlvbiBnZXRBbGxQcm9kdWN0cyhQQUdFX0FDQ0VTU19UT0tFTixhcHBzZWNyZXRfcHJvb2Ype1xuICAgIHJlcXVlc3Qoe1xuICAgICAgICB1cmw6IHVyaSArIENBVExPR19JRCxcbiAgICAgICAgcXM6e1xuICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiBQQUdFX0FDQ0VTU19UT0tFTixcbiAgICAgICAgICAgIGFwcHNlY3JldF9wcm9vZjogYXBwc2VjcmV0X3Byb29mXG4gICAgICAgIH0sXG4gICAgICAgIG1ldGhvZDpcIkdFVFwiXG4gICAgfSwgZnVuY3Rpb24oZXJyb3IscmVzcG9uc2UsYm9keSl7XG4gICAgICAgIGlmIChlcnJvcil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB2YXIgYm9keU9iaiA9IEpTT04ucGFyc2UoYm9keSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhib2R5T2JqKVxuICAgICAgICB9XG4gICAgfSk7XG59XG5cblxuLy9HZXRzIHByb2R1Y3QgZGV0YWlscyBmcm9tIEZhY2Vib29rXG5mdW5jdGlvbiBnZXRQcm9kdWN0RGV0YWlscyhwcm9kdWN0SUQsY2FsbGJhY2spe1xuICAgIHJlcXVlc3Qoe1xuICAgICAgICB1cmw6dXJpICsgcHJvZHVjdElELFxuICAgICAgICBxczp7XG4gICAgICAgICAgICBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOLFxuICAgICAgICAgICAgZmllbGRzOnJlcUZpZWxkcyxcbiAgICAgICAgfSxcbiAgICAgICAgbWV0aG9kOlwiR0VUXCJcbiAgICB9LCBmdW5jdGlvbihlcnJvcixyZXNwb25zZSxib2R5KXtcbiAgICBpZiAoZXJyb3Ipe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIGJvZHlPYmogPSBKU09OLnBhcnNlKGJvZHkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYm9keU9iailcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhib2R5T2JqKVxuICAgICAgICB9XG4gICAgfSk7XG59XG5cblxuXG5leHBvcnQgeyBnZXROYW1lLCBnZXRBbGxQcm9kdWN0cywgZ2V0UHJvZHVjdERldGFpbHMgfTsiXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "fbhelper.js"
      ],
      "names": [
        "request",
        "require",
        "CATLOG_ID",
        "process",
        "env",
        "fields",
        "uri",
        "getName",
        "PAGE_ACCESS_TOKEN",
        "sender_psid",
        "callback",
        "name",
        "url",
        "qs",
        "access_token",
        "method",
        "error",
        "response",
        "body",
        "console",
        "log",
        "bodyObj",
        "JSON",
        "parse",
        "first_name",
        "getAllProducts",
        "appsecret_proof",
        "getProductDetails",
        "productID",
        "reqFields"
      ],
      "mappings": ";;;;;AAAA;AACA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,YAAYC,QAAQC,GAAR,CAAYF,SAA9B;AACA,IAAMG,SAAS,iLAAf;AACA,IAAMC,MAAM,kCAAZ;;AAEA,SAASC,OAAT,CAAiBC,iBAAjB,EAAmCC,WAAnC,EAA+CC,QAA/C,EAAwD;AACpD,QAAIC,OAAO,OAAX;AACAX,YAAQ;AACJY,aAAIN,MAAMG,WADN;AAEJI,YAAG;AACCC,0BAAcN,iBADf;AAECH,oBAAQ;AAFT,SAFC;AAMJU,gBAAO;AANH,KAAR,EAOG,UAASC,KAAT,EAAeC,QAAf,EAAwBC,IAAxB,EAA6B;AAC5B,YAAIF,KAAJ,EAAU;AACNG,oBAAQC,GAAR,CAAYJ,KAAZ;AACH,SAFD,MAEK;AACD,gBAAIK,UAAUC,KAAKC,KAAL,CAAWL,IAAX,CAAd;AACAP,mBAAOU,QAAQG,UAAf;AACAL,oBAAQC,GAAR,CAAY,WAAWT,IAAvB;AACA,mBAAOD,SAASC,IAAT,CAAP;AACH;AACJ,KAhBD;AAiBA,WAAOA,IAAP;AACH;;AAED;AACA,SAASc,cAAT,CAAwBjB,iBAAxB,EAA0CkB,eAA1C,EAA0D;AACtD1B,YAAQ;AACJY,aAAKN,MAAMJ,SADP;AAEJW,YAAG;AACCC,0BAAcN,iBADf;AAECkB,6BAAiBA;AAFlB,SAFC;AAMJX,gBAAO;AANH,KAAR,EAOG,UAASC,KAAT,EAAeC,QAAf,EAAwBC,IAAxB,EAA6B;AAC5B,YAAIF,KAAJ,EAAU;AACNG,oBAAQC,GAAR,CAAYJ,KAAZ;AACH,SAFD,MAEK;AACD,gBAAIK,UAAUC,KAAKC,KAAL,CAAWL,IAAX,CAAd;AACAC,oBAAQC,GAAR,CAAYC,OAAZ;AACH;AACJ,KAdD;AAeH;;AAGD;AACA,SAASM,iBAAT,CAA2BC,SAA3B,EAAqClB,QAArC,EAA8C;AAC1CV,YAAQ;AACJY,aAAIN,MAAMsB,SADN;AAEJf,YAAG;AACCC,0BAAcN,iBADf;AAECH,oBAAOwB;AAFR,SAFC;AAMJd,gBAAO;AANH,KAAR,EAOG,UAASC,KAAT,EAAeC,QAAf,EAAwBC,IAAxB,EAA6B;AAChC,YAAIF,KAAJ,EAAU;AACFG,oBAAQC,GAAR,CAAYJ,KAAZ;AACH,SAFL,MAES;AACD,gBAAIK,UAAUC,KAAKC,KAAL,CAAWL,IAAX,CAAd;AACAC,oBAAQC,GAAR,CAAYC,OAAZ;AACA,mBAAOX,SAASW,OAAT,CAAP;AACH;AACJ,KAfD;AAgBH;;QAIQd,O,GAAAA,O;QAASkB,c,GAAAA,c;QAAgBE,iB,GAAAA,iB",
      "file": "fbhelper.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "//Gets users name from facebook graph api\nconst request = require(\"request\");\nconst CATLOG_ID = process.env.CATLOG_ID;\nconst fields = \"currency,availability,condition,id,inventory,image_url,name,price,retailer_id,retailer_product_group_id,description,custom_label_0,pattern,product_type,color,url,product_group\";\nconst uri = \"https://graph.facebook.com/v7.0/\"\n\nfunction getName(PAGE_ACCESS_TOKEN,sender_psid,callback){\n    var name = \"Empty\";\n    request({\n        url:uri + sender_psid,\n        qs:{\n            access_token: PAGE_ACCESS_TOKEN,\n            fields: \"first_name\",\n        },\n        method:\"GET\"\n    }, function(error,response,body){\n        if (error){\n            console.log(error)\n        }else{\n            var bodyObj = JSON.parse(body);\n            name = bodyObj.first_name;\n            console.log(\"Name: \" + name);\n            return callback(name)\n        }\n    });\n    return name;\n}\n\n//Get all products with their ID from Facebook\nfunction getAllProducts(PAGE_ACCESS_TOKEN,appsecret_proof){\n    request({\n        url: uri + CATLOG_ID,\n        qs:{\n            access_token: PAGE_ACCESS_TOKEN,\n            appsecret_proof: appsecret_proof\n        },\n        method:\"GET\"\n    }, function(error,response,body){\n        if (error){\n            console.log(error)\n        }else{\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj)\n        }\n    });\n}\n\n\n//Gets product details from Facebook\nfunction getProductDetails(productID,callback){\n    request({\n        url:uri + productID,\n        qs:{\n            access_token: PAGE_ACCESS_TOKEN,\n            fields:reqFields,\n        },\n        method:\"GET\"\n    }, function(error,response,body){\n    if (error){\n            console.log(error)\n        }else{\n            var bodyObj = JSON.parse(body);\n            console.log(bodyObj)\n            return callback(bodyObj)\n        }\n    });\n}\n\n\n\nexport { getName, getAllProducts, getProductDetails };"
      ]
    },
    "mtime": 1592484869000
  }
}
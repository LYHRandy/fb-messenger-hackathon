{
  "{\"filename\":\"/app/index.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.3": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/index.js",
      "filenameRelative": "/app/index.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "index.js",
      "sourceFileName": "index.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "index"
    },
    "ignored": false,
    "code": "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\n\nvar express = require(\"express\"),\n    bodyParser = require(\"body-parser\"),\n    app = express().use(bodyParser.json()); // creates express http server\nvar request = require(\"request\");\n\n// import { checkUser, createUser } from './DBConn';\n\n// Get page access token\nvar PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Sets server port and logs message on success\napp.listen(3000, function () {\n  return console.log(\"webhook is listening\");\n});\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", function (req, res) {\n  var VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  var mode = req.query[\"hub.mode\"];\n  var token = req.query[\"hub.verify_token\"];\n  var challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", function (req, res) {\n  var body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function (entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      var webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      var sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        // getName(sender_psid, function(response){\n        //     checkUser(sender_psid,response);\n        // });\n        handleMessage(sender_psid, webhook_event.message);\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\n// Gets users name from facebook graph api\n// function getName(sender_psid,callback){\n//     var name = \"Empty\";\n//     request({\n//         url:\"https://graph.facebook.com/v3.3/\" + sender_psid,\n//         qs:{\n//             access_token: PAGE_ACCESS_TOKEN,\n//             fields: \"first_name\",\n//         },\n//         method:\"GET\"\n//     }, function(error,response,body){\n//         if (error){\n//             console.log(error)\n//         }else{\n//             var bodyObj = JSON.parse(body);\n//             name = bodyObj.first_name;\n//             console.log(\"Name: \" + name);\n//             return callback(name)\n//         }\n//     });\n//     return name;\n// }\n\nvar defaultResponse = generateResponseFromMessage(\"We could not understand your message. Kindly rephrase your message and send us again.\");\n\n// Handles messages events\nfunction handleMessage(sender_psid, received_message) {\n  var response = void 0;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(\"Received message: \\\"\" + received_message.text + \"\\\"\");\n\n    response = processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  var response = void 0;\n\n  // Get the payload for the postback\n  var payload = received_postback.payload;\n  console.log(\"Received postback: \\\"\" + payload + \"\\\"\");\n\n  var postback_intent = payload.split(\" \")[0];\n  var postback_content = payload.substring(payload.indexOf(\" \") + 1, payload.length);\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\"What would you like to know about our \" + postback_content + \"?\");\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [{\n            type: \"postback\",\n            text: \"Pay\",\n            payload: \"paid\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [{\n            type: \"postback\",\n            text: \"View Receipt\",\n            payload: \"receipt_view\"\n          }]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  var request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request({\n    uri: \"https://graph.facebook.com/v2.6/me/messages\",\n    qs: { access_token: PAGE_ACCESS_TOKEN },\n    method: \"POST\",\n    json: request_body\n  }, function (err, res, body) {\n    if (!err) {\n      console.log(\"Message sent!\");\n    } else {\n      console.error(\"Unable to send message:\" + err);\n    }\n  });\n}\n\n// Process text message and returns response object to handleMessage()\nfunction processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  var entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  // Object.keys(entities).forEach(key => {\n  //   console.log(\"Entity: \" + key);\n  //   console.log(entities[key]);\n  // });\n\n  // Check greeting\n  var is_greeting = entities[\"greetings\"] != null && entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  var intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    var intent_parts = intent[\"value\"].split(\"_\");\n    var intent_category = intent_parts[0];\n    var intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    var response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        var product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"].filter(function (obj) {\n            return obj[\"confidence\"] > 0.5;\n          }).map(function (obj) {\n            return obj[\"value\"];\n          });\n        }\n\n        response = generateRecommendationsResponse(product_types);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"attribute\"]) {\n            var product = entities[\"product\"][0];\n            var attribute = entities[\"attribute\"][0];\n            // TODO: Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          var messages = {\n            profit: \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer: \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(function (entity) {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\"Your latest order is <status>.\");\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\");\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\"It is a flat fee of $2 for every order.\");\n          } else {\n            response = generateResponseFromMessage(\"We deliver islandwide. The average delivery time takes 5-7 working days.\");\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          var product_name = entities[\"product\"][0][\"value\"];\n          var quantity = entities[\"number\"] ? entities[\"number\"][0][\"value\"] : 1;\n          response = generateAddCartResponse(sender_psid, product_name, quantity);\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\"Hi there! Welcome to MINDS. How can I help you?\");\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nfunction generateRecommendationsResponse(product_types) {\n  // TODO: Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    attribute: {\n      allegens: [\"eggs\", \"nut\"],\n      colour: null\n    }\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n  }];\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"name\"],\n            subtitle: \"$\" + product[\"price\"],\n            image_url: product[\"url\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Learn More\",\n              payload: \"enquiry_product \" + product[\"name\"]\n            }, {\n              type: \"postback\",\n              title: \"Add to Cart\",\n              payload: \"cart_add \" + product[\"name\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: \"Added \" + quantity + \" \" + product_name + \" to cart.\",\n    quick_replies: [{\n      content_type: \"text\",\n      title: \"View Cart\",\n      payload: \"cart_view\"\n    }, {\n      content_type: \"text\",\n      title: \"Checkout\",\n      payload: \"checkout\"\n    }]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(function (product) {\n          return {\n            title: product[\"name\"],\n            subtitle: \"Qty: \" + product[\"quantity\"] + \" ($\" + product[\"price\"] + \" each)\",\n            image_url: product[\"url\"],\n            buttons: [{\n              type: \"postback\",\n              title: \"Add 1\",\n              payload: \"cart_add \" + product[\"name\"]\n            }, {\n              type: \"postback\",\n              title: \"Remove All\",\n              payload: \"cart_remove \" + product[\"name\"]\n            }]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  var products = [{\n    id: 1,\n    name: \"Dark Chocolate Oatmeal Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }, {\n    id: 2,\n    name: \"Cranberry Sweetheart Cookies (Eggless)\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 2\n  }, {\n    id: 3,\n    name: \"Earl Grey Sunflower Seeds Cookies\",\n    price: 3.5,\n    url: \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n    quantity: 1\n  }];\n\n  var response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<name>\",\n        order_number: \"<order_number>\",\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        // \"order_url\":\"http://petersapparel.parseapp.com/order?order_id=123456\",\n        // \"timestamp\":\"1428444852\",\n        // \"address\":{\n        //   \"street_1\":\"1 Hacker Way\",\n        //   \"street_2\":\"\",\n        //   \"city\":\"Menlo Park\",\n        //   \"postal_code\":\"94025\",\n        //   \"state\":\"CA\",\n        //   \"country\":\"US\"\n        // },\n        summary: {\n          subtotal: 75.0 //,\n          // \"shipping_cost\":4.95,\n          // \"total_tax\":6.19,\n          // \"total_cost\":56.14\n        },\n        elements: products.map(function (product) {\n          return {\n            title: \"\" + product[\"name\"],\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return defaultResponse;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYm9keVBhcnNlciIsImFwcCIsInVzZSIsImpzb24iLCJyZXF1ZXN0IiwiUEFHRV9BQ0NFU1NfVE9LRU4iLCJwcm9jZXNzIiwiZW52IiwibGlzdGVuIiwiY29uc29sZSIsImxvZyIsImdldCIsInJlcSIsInJlcyIsIlZFUklGWV9UT0tFTiIsIm1vZGUiLCJxdWVyeSIsInRva2VuIiwiY2hhbGxlbmdlIiwic3RhdHVzIiwic2VuZCIsInNlbmRTdGF0dXMiLCJwb3N0IiwiYm9keSIsIm9iamVjdCIsImVudHJ5IiwiZm9yRWFjaCIsIndlYmhvb2tfZXZlbnQiLCJtZXNzYWdpbmciLCJzZW5kZXJfcHNpZCIsInNlbmRlciIsImlkIiwibWVzc2FnZSIsImhhbmRsZU1lc3NhZ2UiLCJwb3N0YmFjayIsImhhbmRsZVBvc3RiYWNrIiwiZGVmYXVsdFJlc3BvbnNlIiwiZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlIiwicmVjZWl2ZWRfbWVzc2FnZSIsInJlc3BvbnNlIiwidGV4dCIsInByb2Nlc3NNZXNzYWdlIiwiY2FsbFNlbmRBUEkiLCJyZWNlaXZlZF9wb3N0YmFjayIsInBheWxvYWQiLCJwb3N0YmFja19pbnRlbnQiLCJzcGxpdCIsInBvc3RiYWNrX2NvbnRlbnQiLCJzdWJzdHJpbmciLCJpbmRleE9mIiwibGVuZ3RoIiwiZ2VuZXJhdGVBZGRDYXJ0UmVzcG9uc2UiLCJnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2UiLCJhdHRhY2htZW50IiwidHlwZSIsInRlbXBsYXRlX3R5cGUiLCJidXR0b25zIiwiZ2VuZXJhdGVSZWNlaXB0UmVzcG9uc2UiLCJyZXF1ZXN0X2JvZHkiLCJyZWNpcGllbnQiLCJ1cmkiLCJxcyIsImFjY2Vzc190b2tlbiIsIm1ldGhvZCIsImVyciIsImVycm9yIiwiZW50aXRpZXMiLCJubHAiLCJpc19ncmVldGluZyIsImludGVudCIsImludGVudF9wYXJ0cyIsImludGVudF9jYXRlZ29yeSIsImludGVudF9zdWJjYXRlZ29yeSIsInByb2R1Y3RfdHlwZXMiLCJmaWx0ZXIiLCJvYmoiLCJtYXAiLCJnZW5lcmF0ZVJlY29tbWVuZGF0aW9uc1Jlc3BvbnNlIiwicHJvZHVjdCIsImF0dHJpYnV0ZSIsImdlbmVyYXRlUHJvZHVjdEVucXVpcnlSZXNwb25zZSIsIm1lc3NhZ2VzIiwicHJvZml0IiwibWFudWZhY3R1cmVyIiwicHJvZHVjdHMiLCJPYmplY3QiLCJrZXlzIiwiZW50aXR5IiwicHJvZHVjdF9uYW1lIiwicXVhbnRpdHkiLCJuYW1lIiwicHJpY2UiLCJ1cmwiLCJhbGxlZ2VucyIsImNvbG91ciIsImVsZW1lbnRzIiwidGl0bGUiLCJzdWJ0aXRsZSIsImltYWdlX3VybCIsInF1aWNrX3JlcGxpZXMiLCJjb250ZW50X3R5cGUiLCJyZWNpcGllbnRfbmFtZSIsIm9yZGVyX251bWJlciIsImN1cnJlbmN5IiwicGF5bWVudF9tZXRob2QiLCJzdW1tYXJ5Iiwic3VidG90YWwiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFDQSxJQUFNQSxVQUFVQyxRQUFRLFNBQVIsQ0FBaEI7QUFBQSxJQUNFQyxhQUFhRCxRQUFRLGFBQVIsQ0FEZjtBQUFBLElBRUVFLE1BQU1ILFVBQVVJLEdBQVYsQ0FBY0YsV0FBV0csSUFBWCxFQUFkLENBRlIsQyxDQUUwQztBQUMxQyxJQUFNQyxVQUFVTCxRQUFRLFNBQVIsQ0FBaEI7O0FBRUE7O0FBRUE7QUFDQSxJQUFNTSxvQkFBb0JDLFFBQVFDLEdBQVIsQ0FBWUYsaUJBQXRDOztBQUVBO0FBQ0FKLElBQUlPLE1BQUosQ0FBVyxJQUFYLEVBQWlCO0FBQUEsU0FBTUMsUUFBUUMsR0FBUixDQUFZLHNCQUFaLENBQU47QUFBQSxDQUFqQjs7QUFFQTtBQUNBVCxJQUFJVSxHQUFKLENBQVEsVUFBUixFQUFvQixVQUFDQyxHQUFELEVBQU1DLEdBQU4sRUFBYztBQUNoQyxNQUFJQyxlQUFlUixRQUFRQyxHQUFSLENBQVlPLFlB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LG1CQUFXO0FBQ2hDLGlCQUFPO0FBQ0xvQix3QkFBVWxCLFFBQVEsTUFBUixDQURMO0FBRUxtQixzQkFBVSxFQUZMO0FBR0xSLHNCQUFVWCxRQUFRLFVBQVIsQ0FITDtBQUlMYSxtQkFBT2IsUUFBUSxPQUFSLENBSkY7QUFLTHlCLHNCQUFVLEtBTEw7QUFNTEwsdUJBQVdwQixRQUFRLEtBQVI7QUFOTixXQUFQO0FBUUQsU0FUUztBQXRCSDtBQUZDO0FBREMsR0FBZjs7QUF1Q0EsU0FBT3ZDLFFBQVA7QUFDRDs7QUFFRDtBQUNBLFNBQVN5Qyw4QkFBVCxDQUF3Q0YsT0FBeEMsRUFBaURDLFNBQWpELEVBQTREO0FBQzFEO0FBQ0EsU0FBTzNDLGVBQVA7QUFDRCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZVJvb3QiOiIvYXBwIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9nZXR0aW5nLXN0YXJ0ZWQvd2ViaG9vay1zZXR1cC9cbi8vIGh0dHBzOi8vZGV2ZWxvcGVycy5mYWNlYm9vay5jb20vZG9jcy9tZXNzZW5nZXItcGxhdGZvcm0vZ2V0dGluZy1zdGFydGVkL2FwcC1zZXR1cFxuLy8gaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9nZXR0aW5nLXN0YXJ0ZWQvcXVpY2stc3RhcnRcblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vIEltcG9ydHMgZGVwZW5kZW5jaWVzIGFuZCBzZXQgdXAgaHR0cCBzZXJ2ZXJcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKFwiZXhwcmVzc1wiKSxcbiAgYm9keVBhcnNlciA9IHJlcXVpcmUoXCJib2R5LXBhcnNlclwiKSxcbiAgYXBwID0gZXhwcmVzcygpLnVzZShib2R5UGFyc2VyLmpzb24oKSk7IC8vIGNyZWF0ZXMgZXhwcmVzcyBodHRwIHNlcnZlclxuY29uc3QgcmVxdWVzdCA9IHJlcXVpcmUoXCJyZXF1ZXN0XCIpO1xuXG4vLyBpbXBvcnQgeyBjaGVja1VzZXIsIGNyZWF0ZVVzZXIgfSBmcm9tICcuL0RCQ29ubic7XG5cbi8vIEdldCBwYWdlIGFjY2VzcyB0b2tlblxuY29uc3QgUEFHRV9BQ0NFU1NfVE9LRU4gPSBwcm9jZXNzLmVudi5QQUdFX0FDQ0VTU19UT0tFTjtcblxuLy8gU2V0cyBzZXJ2ZXIgcG9ydCBhbmQgbG9ncyBtZXNzYWdlIG9uIHN1Y2Nlc3NcbmFwcC5saXN0ZW4oMzAwMCwgKCkgPT4gY29uc29sZS5sb2coXCJ3ZWJob29rIGlzIGxpc3RlbmluZ1wiKSk7XG5cbi8vIEFkZHMgc3VwcG9ydCBmb3IgR0VUIHJlcXVlc3RzIHRvIG91ciB3ZWJob29rXG5hcHAuZ2V0KFwiL3dlYmhvb2tcIiwgKHJlcSwgcmVzKSA9PiB7XG4gIGxldCBWRVJJRllfVE9LRU4gPSBwcm9jZXNzLmVudi5WRVJJRllfVE9LRU47XG5cbiAgLy8gUGFyc2UgdGhlIHF1ZXJ5IHBhcmFtc1xuICBsZXQgbW9kZSA9IHJlcS5xdWVyeVtcImh1Yi5tb2RlXCJdO1xuICBsZXQgdG9rZW4gPSByZXEucXVlcnlbXCJodWIudmVyaWZ5X3Rva2VuXCJdO1xuICBsZXQgY2hhbGxlbmdlID0gcmVxLnF1ZXJ5W1wiaHViLmNoYWxsZW5nZVwiXTtcblxuICAvLyBDaGVja3MgaWYgYSB0b2tlbiBhbmQgbW9kZSBpcyBpbiB0aGUgcXVlcnkgc3RyaW5nIG9mIHRoZSByZXF1ZXN0XG4gIGlmIChtb2RlICYmIHRva2VuKSB7XG4gICAgLy8gQ2hlY2tzIHRoZSBtb2RlIGFuZCB0b2tlbiBzZW50IGlzIGNvcnJlY3RcbiAgICBpZiAobW9kZSA9PT0gXCJzdWJzY3JpYmVcIiAmJiB0b2tlbiA9PT0gVkVSSUZZX1RPS0VOKSB7XG4gICAgICAvLyBSZXNwb25kcyB3aXRoIHRoZSBjaGFsbGVuZ2UgdG9rZW4gZnJvbSB0aGUgcmVxdWVzdFxuICAgICAgY29uc29sZS5sb2coXCJXRUJIT09LX1ZFUklGSUVEXCIpO1xuICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoY2hhbGxlbmdlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUmVzcG9uZHMgd2l0aCAnNDAzIEZvcmJpZGRlbicgaWYgdmVyaWZ5IHRva2VucyBkbyBub3QgbWF0Y2hcbiAgICAgIHJlcy5zZW5kU3RhdHVzKDQwMyk7XG4gICAgfVxuICB9XG59KTtcblxuLy8gQ3JlYXRlcyB0aGUgZW5kcG9pbnQgZm9yIG91ciB3ZWJob29rXG5hcHAucG9zdChcIi93ZWJob29rXCIsIChyZXEsIHJlcykgPT4ge1xuICBsZXQgYm9keSA9IHJlcS5ib2R5O1xuXG4gIC8vIENoZWNrcyB0aGlzIGlzIGFuIGV2ZW50IGZyb20gYSBwYWdlIHN1YnNjcmlwdGlvblxuICBpZiAoYm9keS5vYmplY3QgPT09IFwicGFnZVwiKSB7XG4gICAgLy8gSXRlcmF0ZXMgb3ZlciBlYWNoIGVudHJ5IC0gdGhlcmUgbWF5IGJlIG11bHRpcGxlIGlmIGJhdGNoZWRcbiAgICBib2R5LmVudHJ5LmZvckVhY2goZnVuY3Rpb24oZW50cnkpIHtcbiAgICAgIC8vIEdldHMgdGhlIG1lc3NhZ2UuIGVudHJ5Lm1lc3NhZ2luZyBpcyBhbiBhcnJheSwgYnV0XG4gICAgICAvLyB3aWxsIG9ubHkgZXZlciBjb250YWluIG9uZSBtZXNzYWdlLCBzbyB3ZSBnZXQgaW5kZXggMFxuICAgICAgbGV0IHdlYmhvb2tfZXZlbnQgPSBlbnRyeS5tZXNzYWdpbmdbMF07XG4gICAgICAvLyBjb25zb2xlLmxvZyh3ZWJob29rX2V2ZW50KTtcblxuICAgICAgLy8gR2V0IHRoZSBzZW5kZXIgUFNJRFxuICAgICAgbGV0IHNlbmRlcl9wc2lkID0gd2ViaG9va19ldmVudC5zZW5kZXIuaWQ7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIlNlbmRlciBQU0lEOiBcIiArIHNlbmRlcl9wc2lkKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGV2ZW50IGlzIGEgbWVzc2FnZSBvciBwb3N0YmFjayBhbmRcbiAgICAgIC8vIHBhc3MgdGhlIGV2ZW50IHRvIHRoZSBhcHByb3ByaWF0ZSBoYW5kbGVyIGZ1bmN0aW9uXG4gICAgICBpZiAod2ViaG9va19ldmVudC5tZXNzYWdlKSB7XG4gICAgICAgIC8vIGdldE5hbWUoc2VuZGVyX3BzaWQsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgLy8gICAgIGNoZWNrVXNlcihzZW5kZXJfcHNpZCxyZXNwb25zZSk7XG4gICAgICAgIC8vIH0pO1xuICAgICAgICBoYW5kbGVNZXNzYWdlKHNlbmRlcl9wc2lkLCB3ZWJob29rX2V2ZW50Lm1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIGlmICh3ZWJob29rX2V2ZW50LnBvc3RiYWNrKSB7XG4gICAgICAgIGhhbmRsZVBvc3RiYWNrKHNlbmRlcl9wc2lkLCB3ZWJob29rX2V2ZW50LnBvc3RiYWNrKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFJldHVybnMgYSAnMjAwIE9LJyByZXNwb25zZSB0byBhbGwgcmVxdWVzdHNcbiAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChcIkVWRU5UX1JFQ0VJVkVEXCIpO1xuICB9IGVsc2Uge1xuICAgIC8vIFJldHVybnMgYSAnNDA0IE5vdCBGb3VuZCcgaWYgZXZlbnQgaXMgbm90IGZyb20gYSBwYWdlIHN1YnNjcmlwdGlvblxuICAgIHJlcy5zZW5kU3RhdHVzKDQwNCk7XG4gIH1cbn0pO1xuXG4vLyBHZXRzIHVzZXJzIG5hbWUgZnJvbSBmYWNlYm9vayBncmFwaCBhcGlcbi8vIGZ1bmN0aW9uIGdldE5hbWUoc2VuZGVyX3BzaWQsY2FsbGJhY2spe1xuLy8gICAgIHZhciBuYW1lID0gXCJFbXB0eVwiO1xuLy8gICAgIHJlcXVlc3Qoe1xuLy8gICAgICAgICB1cmw6XCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92My4zL1wiICsgc2VuZGVyX3BzaWQsXG4vLyAgICAgICAgIHFzOntcbi8vICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogUEFHRV9BQ0NFU1NfVE9LRU4sXG4vLyAgICAgICAgICAgICBmaWVsZHM6IFwiZmlyc3RfbmFtZVwiLFxuLy8gICAgICAgICB9LFxuLy8gICAgICAgICBtZXRob2Q6XCJHRVRcIlxuLy8gICAgIH0sIGZ1bmN0aW9uKGVycm9yLHJlc3BvbnNlLGJvZHkpe1xuLy8gICAgICAgICBpZiAoZXJyb3Ipe1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpXG4vLyAgICAgICAgIH1lbHNle1xuLy8gICAgICAgICAgICAgdmFyIGJvZHlPYmogPSBKU09OLnBhcnNlKGJvZHkpO1xuLy8gICAgICAgICAgICAgbmFtZSA9IGJvZHlPYmouZmlyc3RfbmFtZTtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTmFtZTogXCIgKyBuYW1lKTtcbi8vICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuYW1lKVxuLy8gICAgICAgICB9XG4vLyAgICAgfSk7XG4vLyAgICAgcmV0dXJuIG5hbWU7XG4vLyB9XG5cbmxldCBkZWZhdWx0UmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gIFwiV2UgY291bGQgbm90IHVuZGVyc3RhbmQgeW91ciBtZXNzYWdlLiBLaW5kbHkgcmVwaHJhc2UgeW91ciBtZXNzYWdlIGFuZCBzZW5kIHVzIGFnYWluLlwiXG4pO1xuXG4vLyBIYW5kbGVzIG1lc3NhZ2VzIGV2ZW50c1xuZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfbWVzc2FnZSkge1xuICBsZXQgcmVzcG9uc2U7XG5cbiAgLy8gQ2hlY2sgaWYgdGhlIG1lc3NhZ2UgY29udGFpbnMgdGV4dFxuICBpZiAocmVjZWl2ZWRfbWVzc2FnZS50ZXh0KSB7XG4gICAgY29uc29sZS5sb2coYFJlY2VpdmVkIG1lc3NhZ2U6IFwiJHtyZWNlaXZlZF9tZXNzYWdlLnRleHR9XCJgKTtcblxuICAgIHJlc3BvbnNlID0gcHJvY2Vzc01lc3NhZ2Uoc2VuZGVyX3BzaWQsIHJlY2VpdmVkX21lc3NhZ2UpO1xuICAgIC8vIERlZmF1bHQgcmVzcG9uc2UgKGZvciBkZWJ1Z2dpbmcpXG4gICAgLy8gQ3JlYXRlIHRoZSBwYXlsb2FkIGZvciBhIGJhc2ljIHRleHQgbWVzc2FnZVxuICAgIC8vIHJlc3BvbnNlID0ge1xuICAgIC8vICAgdGV4dDogYFlvdSBzZW50IHRoZSBtZXNzYWdlOiBcIiR7cmVjZWl2ZWRfbWVzc2FnZS50ZXh0fVwiLmBcbiAgICAvLyB9O1xuICB9IGVsc2Uge1xuICAgIHJlc3BvbnNlID0gZGVmYXVsdFJlc3BvbnNlO1xuICAgIC8vICAgICAvLyBHZXRzIHRoZSBVUkwgb2YgdGhlIG1lc3NhZ2UgYXR0YWNobWVudFxuICAgIC8vICAgICBsZXQgYXR0YWNobWVudF91cmwgPSByZWNlaXZlZF9tZXNzYWdlLmF0dGFjaG1lbnRzWzBdLnBheWxvYWQudXJsO1xuICB9XG5cbiAgLy8gU2VuZHMgdGhlIHJlc3BvbnNlIG1lc3NhZ2VcbiAgY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKTtcbn1cblxuLy8gSGFuZGxlcyBtZXNzYWdpbmdfcG9zdGJhY2tzIGV2ZW50c1xuZnVuY3Rpb24gaGFuZGxlUG9zdGJhY2soc2VuZGVyX3BzaWQsIHJlY2VpdmVkX3Bvc3RiYWNrKSB7XG4gIGxldCByZXNwb25zZTtcblxuICAvLyBHZXQgdGhlIHBheWxvYWQgZm9yIHRoZSBwb3N0YmFja1xuICBsZXQgcGF5bG9hZCA9IHJlY2VpdmVkX3Bvc3RiYWNrLnBheWxvYWQ7XG4gIGNvbnNvbGUubG9nKGBSZWNlaXZlZCBwb3N0YmFjazogXCIke3BheWxvYWR9XCJgKTtcblxuICBsZXQgcG9zdGJhY2tfaW50ZW50ID0gcGF5bG9hZC5zcGxpdChcIiBcIilbMF07XG4gIGxldCBwb3N0YmFja19jb250ZW50ID0gcGF5bG9hZC5zdWJzdHJpbmcoXG4gICAgcGF5bG9hZC5pbmRleE9mKFwiIFwiKSArIDEsXG4gICAgcGF5bG9hZC5sZW5ndGhcbiAgKTtcblxuICAvLyBTZXQgdGhlIHJlc3BvbnNlIGJhc2VkIG9uIHRoZSBwb3N0YmFjayBpbnRlbnRcbiAgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJjYXJ0X2FkZFwiKSB7XG4gICAgLy8gQWRkIHRvIGNhcnRcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlQWRkQ2FydFJlc3BvbnNlKHNlbmRlcl9wc2lkLCBwb3N0YmFja19jb250ZW50LCAxKTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwiY2FydF92aWV3XCIpIHtcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlVmlld0NhcnRSZXNwb25zZShzZW5kZXJfcHNpZCk7XG4gIH0gZWxzZSBpZiAocG9zdGJhY2tfaW50ZW50ID09PSBcImVucXVpcnlfcHJvZHVjdFwiKSB7XG4gICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICBgV2hhdCB3b3VsZCB5b3UgbGlrZSB0byBrbm93IGFib3V0IG91ciAke3Bvc3RiYWNrX2NvbnRlbnR9P2BcbiAgICApO1xuICB9IGVsc2UgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJjaGVja291dFwiKSB7XG4gICAgcmVzcG9uc2UgPSB7XG4gICAgICBhdHRhY2htZW50OiB7XG4gICAgICAgIHR5cGU6IFwidGVtcGxhdGVcIixcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIHRlbXBsYXRlX3R5cGU6IFwiYnV0dG9uXCIsXG4gICAgICAgICAgdGV4dDogXCJDbGljayBvbiB0aGUgYnV0dG9uIGJlbG93IHRvIHBheS5cIixcbiAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgdGV4dDogXCJQYXlcIixcbiAgICAgICAgICAgICAgcGF5bG9hZDogXCJwYWlkXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9IGVsc2UgaWYgKHBvc3RiYWNrX2ludGVudCA9PT0gXCJwYWlkXCIpIHtcbiAgICByZXNwb25zZSA9IHtcbiAgICAgIGF0dGFjaG1lbnQ6IHtcbiAgICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgICBwYXlsb2FkOiB7XG4gICAgICAgICAgdGVtcGxhdGVfdHlwZTogXCJidXR0b25cIixcbiAgICAgICAgICB0ZXh0OiBcIllvdXIgb3JkZXIgKG9yZGVyIG5vLikgaXMgY29uZmlybWVkLlwiLFxuICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJwb3N0YmFja1wiLFxuICAgICAgICAgICAgICB0ZXh0OiBcIlZpZXcgUmVjZWlwdFwiLFxuICAgICAgICAgICAgICBwYXlsb2FkOiBcInJlY2VpcHRfdmlld1wiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfSBlbHNlIGlmIChwb3N0YmFja19pbnRlbnQgPT09IFwicmVjZWlwdF92aWV3XCIpIHtcbiAgICByZXNwb25zZSA9IGdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlKHNlbmRlcl9wc2lkKTtcbiAgfVxuXG4gIGlmIChyZXNwb25zZSA9PSBudWxsKSB7XG4gICAgcmVzcG9uc2UgPSBkZWZhdWx0UmVzcG9uc2UoKTtcbiAgfVxuXG4gIC8vIFNlbmQgdGhlIG1lc3NhZ2UgdG8gYWNrbm93bGVkZ2UgdGhlIHBvc3RiYWNrXG4gIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSk7XG59XG5cbi8vIFNlbmRzIHJlc3BvbnNlIG1lc3NhZ2VzIHZpYSB0aGUgU2VuZCBBUElcbmZ1bmN0aW9uIGNhbGxTZW5kQVBJKHNlbmRlcl9wc2lkLCByZXNwb25zZSkge1xuICAvLyBVbmNvbW1lbnQgdG8gbG9nIHJlc3BvbnNlIG9iamVjdFxuICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cbiAgLy8gQ29uc3RydWN0IHRoZSBtZXNzYWdlIGJvZHlcbiAgbGV0IHJlcXVlc3RfYm9keSA9IHtcbiAgICByZWNpcGllbnQ6IHtcbiAgICAgIGlkOiBzZW5kZXJfcHNpZFxuICAgIH0sXG4gICAgbWVzc2FnZTogcmVzcG9uc2VcbiAgfTtcblxuICAvLyBTZW5kIHRoZSBIVFRQIHJlcXVlc3QgdG8gdGhlIE1lc3NlbmdlciBQbGF0Zm9ybVxuICByZXF1ZXN0KFxuICAgIHtcbiAgICAgIHVyaTogXCJodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS92Mi42L21lL21lc3NhZ2VzXCIsXG4gICAgICBxczogeyBhY2Nlc3NfdG9rZW46IFBBR0VfQUNDRVNTX1RPS0VOIH0sXG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAganNvbjogcmVxdWVzdF9ib2R5XG4gICAgfSxcbiAgICAoZXJyLCByZXMsIGJvZHkpID0+IHtcbiAgICAgIGlmICghZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiTWVzc2FnZSBzZW50IVwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gc2VuZCBtZXNzYWdlOlwiICsgZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG5cbi8vIFByb2Nlc3MgdGV4dCBtZXNzYWdlIGFuZCByZXR1cm5zIHJlc3BvbnNlIG9iamVjdCB0byBoYW5kbGVNZXNzYWdlKClcbmZ1bmN0aW9uIHByb2Nlc3NNZXNzYWdlKHNlbmRlcl9wc2lkLCBtZXNzYWdlKSB7XG4gIC8vIE5MUDogaHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL21lc3Nlbmdlci1wbGF0Zm9ybS9idWlsdC1pbi1ubHBcbiAgbGV0IGVudGl0aWVzID0gbWVzc2FnZS5ubHBbXCJlbnRpdGllc1wiXTtcblxuICAvLyBVbmNvbW1lbnQgdG8gdmlldyBhbGwgZW50aXRpZXMgYW5kIHRoZWlyIHhhbHVlc1xuICAvLyBPYmplY3Qua2V5cyhlbnRpdGllcykuZm9yRWFjaChrZXkgPT4ge1xuICAvLyAgIGNvbnNvbGUubG9nKFwiRW50aXR5OiBcIiArIGtleSk7XG4gIC8vICAgY29uc29sZS5sb2coZW50aXRpZXNba2V5XSk7XG4gIC8vIH0pO1xuXG4gIC8vIENoZWNrIGdyZWV0aW5nXG4gIGxldCBpc19ncmVldGluZyA9XG4gICAgZW50aXRpZXNbXCJncmVldGluZ3NcIl0gIT0gbnVsbCAmJlxuICAgIGVudGl0aWVzW1wiZ3JlZXRpbmdzXCJdWzBdW1wiY29uZmlkZW5jZVwiXSA+IDAuODsgLy8gR3JlZXRpbmcgdGhyZXNob2xkIHNldCB0byAwLjggKHN0cmljdGVyKVxuXG4gIC8vIFJldHJpZXZlIGZpcnN0IGludGVudCBvYmplY3RcbiAgbGV0IGludGVudCA9IGVudGl0aWVzW1wiaW50ZW50XCJdWzBdO1xuXG4gIGlmIChpbnRlbnRbXCJjb25maWRlbmNlXCJdID4gMC41KSB7XG4gICAgLy8gUHJvY2VzcyBpbnRlbnRcbiAgICBsZXQgaW50ZW50X3BhcnRzID0gaW50ZW50W1widmFsdWVcIl0uc3BsaXQoXCJfXCIpO1xuICAgIGxldCBpbnRlbnRfY2F0ZWdvcnkgPSBpbnRlbnRfcGFydHNbMF07XG4gICAgbGV0IGludGVudF9zdWJjYXRlZ29yeSA9IGludGVudF9wYXJ0cy5sZW5ndGggPiAxID8gaW50ZW50X3BhcnRzWzFdIDogbnVsbDtcbiAgICBsZXQgcmVzcG9uc2UgPSBudWxsO1xuXG4gICAgc3dpdGNoIChpbnRlbnRfY2F0ZWdvcnkpIHtcbiAgICAgIGNhc2UgXCJyZWNvbW1lbmRhdGlvblwiOlxuICAgICAgICAvLyBIYW5kbGUgcmVjb21tZW5kYXRpb25cbiAgICAgICAgLy8gcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgIC8vICAgXCJNZXNzYWdlIHJlY2VpdmVkIGlzIGEgcmVjb21tZW5kYXRpb24gbWVzc2FnZS5cIlxuICAgICAgICAvLyApO1xuXG4gICAgICAgIGxldCBwcm9kdWN0X3R5cGVzID0gW107XG4gICAgICAgIGlmIChlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUHJvY2Vzc2luZyBwcm9kdWN0IHR5cGVzXCIpO1xuICAgICAgICAgIHByb2R1Y3RfdHlwZXMgPSBlbnRpdGllc1tcInByb2R1Y3RfdHlwZVwiXVxuICAgICAgICAgICAgLmZpbHRlcihvYmogPT4gb2JqW1wiY29uZmlkZW5jZVwiXSA+IDAuNSlcbiAgICAgICAgICAgIC5tYXAob2JqID0+IG9ialtcInZhbHVlXCJdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc3BvbnNlID0gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZShwcm9kdWN0X3R5cGVzKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgXCJlbnF1aXJ5XCI6XG4gICAgICAgIC8vIEhhbmRsZSBlbnF1aXJ5XG4gICAgICAgIC8vIHJlc3BvbnNlID0gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgICAvLyAgIFwiTWVzc2FnZSByZWNlaXZlZCBpcyBhbiBlbnF1aXJ5IG1lc3NhZ2UuXCJcbiAgICAgICAgLy8gKTtcblxuICAgICAgICBpZiAoaW50ZW50X3N1YmNhdGVnb3J5ID09PSBcInByb2R1Y3RcIikge1xuICAgICAgICAgIC8vIFJldHJpZXZlIHByb2R1Y3QgYW5kIGF0dHJpYnV0ZSBmcm9tIGVudGl0aWVzIG9iamVjdFxuICAgICAgICAgIGlmIChlbnRpdGllc1tcInByb2R1Y3RcIl0gJiYgZW50aXRpZXNbXCJhdHRyaWJ1dGVcIl0pIHtcbiAgICAgICAgICAgIGxldCBwcm9kdWN0ID0gZW50aXRpZXNbXCJwcm9kdWN0XCJdWzBdO1xuICAgICAgICAgICAgbGV0IGF0dHJpYnV0ZSA9IGVudGl0aWVzW1wiYXR0cmlidXRlXCJdWzBdO1xuICAgICAgICAgICAgLy8gVE9ETzogSGFuZGxlIHByb2R1Y3QgZW5xdWlyeVxuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVByb2R1Y3RFbnF1aXJ5UmVzcG9uc2UocHJvZHVjdCwgYXR0cmlidXRlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBkZWZhdWx0UmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJnZW5lcmFsXCIpIHtcbiAgICAgICAgICBsZXQgbWVzc2FnZXMgPSB7XG4gICAgICAgICAgICBwcm9maXQ6XG4gICAgICAgICAgICAgIFwiQWxsIG5ldCByZXZlbnVlIGVhcm5lZCBmcm9tIHRoZSBzYWxlIG9mIG91ciBwcm9kdWN0cyBhbmQgc2VydmljZXMgZ28gdG93YXJkcyBwYXlpbmcgYSBtb250aGx5IGFsbG93YW5jZSBmb3Igb3VyIGNsaWVudHMnIHdvcmssIGFzIHdlbGwgYXMgdGhlaXIgbHVuY2ggZXhwZW5zZXMgd2hpbGUgdW5kZXJnb2luZyB0cmFpbmluZy5cIixcbiAgICAgICAgICAgIG1hbnVmYWN0dXJlcjpcbiAgICAgICAgICAgICAgXCJXZSBzdXBwb3J0IGFkdWx0cyB3aXRoIGludGVsbGVjdHVhbCBkaXNhYmlsaXRpZXMuIFdlIHN0YXJ0ZWQgYSByYW5nZSBvZiBzb2NpYWwgZW50ZXJwcmlzZSBwcm9qZWN0cyB0byBwcm92aWRlIGFsdGVybmF0aXZlIHdvcmsgZW5nYWdlbWVudCBmb3Igb3VyIGFkdWx0IHRyYWluZWVzLlwiLFxuICAgICAgICAgICAgcHJvZHVjdHM6IFwiV2Ugc2VsbCBjcmFmdCBhbmQgYmFrZXIgZ29vZHMuXCJcbiAgICAgICAgICB9O1xuICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBtZXNzYWdlIGtleXMgKGVudGl0eSkgYW5kIGZpbmQgaWYgZW50aXR5IGlzIGluIGVudGl0aWVzXG4gICAgICAgICAgT2JqZWN0LmtleXMobWVzc2FnZXMpLmZvckVhY2goZW50aXR5ID0+IHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PSBudWxsICYmIGVudGl0aWVzW2VudGl0eV0pIHtcbiAgICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UobWVzc2FnZXNbZW50aXR5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoaW50ZW50X3N1YmNhdGVnb3J5ID09PSBcImRlbGl2ZXJ5XCIpIHtcbiAgICAgICAgICBpZiAoZW50aXRpZXNbXCJzdGF0dXNcIl0pIHtcbiAgICAgICAgICAgIC8vIFRPRE86IE9yZGVyIHN0YXR1c1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiWW91ciBsYXRlc3Qgb3JkZXIgaXMgPHN0YXR1cz4uXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIGlmIChlbnRpdGllc1tcImVzdGltYXRlZF9hcnJpdmFsXCJdKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBPcmRlciBlc3RpbWF0ZWQgYXJyaXZhbFxuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiVGhlIGF2ZXJhZ2UgZGVsaXZlcnkgdGltZSB0YWtlcyA1LTcgd29ya2luZyBkYXlzLiBZb3VyIG9yZGVyZWQgd2FzIHNlbnQgb24gPGRhdGU+LiBJdCBpcyBlc3RpbWF0ZWQgdG8gYXJyaXZlIG9uIDxkYXRlICsgNyB3b3JraW5nIGRheXM+LlwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZW50aXRpZXNbXCJjb3N0XCJdKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgICAgICAgICAgXCJJdCBpcyBhIGZsYXQgZmVlIG9mICQyIGZvciBldmVyeSBvcmRlci5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZVJlc3BvbnNlRnJvbU1lc3NhZ2UoXG4gICAgICAgICAgICAgIFwiV2UgZGVsaXZlciBpc2xhbmR3aWRlLiBUaGUgYXZlcmFnZSBkZWxpdmVyeSB0aW1lIHRha2VzIDUtNyB3b3JraW5nIGRheXMuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFwiY2FydFwiOlxuICAgICAgICAvLyBIYW5kbGUgc2hvcHBpbmcgY2FydFxuICAgICAgICAvLyByZXNwb25zZSA9IGdlbmVyYXRlUmVzcG9uc2VGcm9tTWVzc2FnZShcbiAgICAgICAgLy8gICBcIk1lc3NhZ2UgcmVjZWl2ZWQgaXMgYSBjYXJ0IG1lc3NhZ2UuXCJcbiAgICAgICAgLy8gKTtcblxuICAgICAgICBpZiAoaW50ZW50X3N1YmNhdGVnb3J5ID09PSBcImFkZFwiICYmIGVudGl0aWVzW1wicHJvZHVjdFwiXSkge1xuICAgICAgICAgIGxldCBwcm9kdWN0X25hbWUgPSBlbnRpdGllc1tcInByb2R1Y3RcIl1bMF1bXCJ2YWx1ZVwiXTtcbiAgICAgICAgICBsZXQgcXVhbnRpdHkgPSBlbnRpdGllc1tcIm51bWJlclwiXVxuICAgICAgICAgICAgPyBlbnRpdGllc1tcIm51bWJlclwiXVswXVtcInZhbHVlXCJdXG4gICAgICAgICAgICA6IDE7XG4gICAgICAgICAgcmVzcG9uc2UgPSBnZW5lcmF0ZUFkZENhcnRSZXNwb25zZShcbiAgICAgICAgICAgIHNlbmRlcl9wc2lkLFxuICAgICAgICAgICAgcHJvZHVjdF9uYW1lLFxuICAgICAgICAgICAgcXVhbnRpdHlcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGludGVudF9zdWJjYXRlZ29yeSA9PT0gXCJ2aWV3XCIpIHtcbiAgICAgICAgICByZXNwb25zZSA9IGdlbmVyYXRlVmlld0NhcnRSZXNwb25zZShzZW5kZXJfcHNpZCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlc3BvbnNlID0gZGVmYXVsdFJlc3BvbnNlO1xuICAgIH1cblxuICAgIHJlc3BvbnNlID0gcmVzcG9uc2UgPT0gbnVsbCA/IGRlZmF1bHRSZXNwb25zZSA6IHJlc3BvbnNlO1xuICAgIHJldHVybiByZXNwb25zZTtcbiAgfSBlbHNlIGlmIChpc19ncmVldGluZykge1xuICAgIC8vIE1lc3NhZ2UgaGFzIG5vIGludGVudCwganVzdCBncmVldGluZ1xuICAgIC8vIFRPRE86IEFkZCBxdWljayByZXBsaWVzIG9mIGNoYXRib3QgZnVuY3Rpb25hbGl0aWVzIChyZWNvbW1lbmRhdGlvbnMsIGNoZWNrIG9yZGVyIHN0YXR1cywgZXRjLilcbiAgICByZXR1cm4gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKFxuICAgICAgXCJIaSB0aGVyZSEgV2VsY29tZSB0byBNSU5EUy4gSG93IGNhbiBJIGhlbHAgeW91P1wiXG4gICAgKTtcbiAgfVxuXG4gIC8vIE5vIGludGVudCBub3IgZ3JlZXRpbmdcbiAgcmV0dXJuIGRlZmF1bHRSZXNwb25zZTtcbn1cblxuLy8gV3JhcHBlciBtZXRob2QgdG8gY29udmVydCB0ZXh0IG1lc3NhZ2Ugc3RyaW5nIHRvIHJlc3BvbnNlIG9iamVjdFxuZnVuY3Rpb24gZ2VuZXJhdGVSZXNwb25zZUZyb21NZXNzYWdlKG1lc3NhZ2UpIHtcbiAgcmV0dXJuIHtcbiAgICB0ZXh0OiBtZXNzYWdlXG4gIH07XG59XG5cbi8vIFJlc3BvbnNlIG9uIGdlbmVyaWMgdGVtcGxhdGUgY2Fyb3VzZWwgZm9yIHJlY29tbWVuZGF0aW9uc1xuZnVuY3Rpb24gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNSZXNwb25zZShwcm9kdWN0X3R5cGVzKSB7XG4gIC8vIFRPRE86IFJldHJpZXZlIHByb2R1Y3RzIHRvIHJlY29tbWVuZCBiYXNlZCBvbiBsaXN0IG9mIHByb2R1Y3QgdHlwZXMuIElmIHByb2R1Y3QgdHlwZXMgaXMgYW4gZW1wdHkgYXJyYXksIHJlY29tbWVuZCBwcm9kdWN0cyBvZiB2YXJpb3VzIHR5cGVzXG4gIGxldCBwcm9kdWN0cyA9IFtcbiAgICB7XG4gICAgICBpZDogMSxcbiAgICAgIG5hbWU6IFwiRGFyayBDaG9jb2xhdGUgT2F0bWVhbCBDb29raWVzXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCIsXG4gICAgICBhdHRyaWJ1dGU6IHtcbiAgICAgICAgYWxsZWdlbnM6IFtcImVnZ3NcIiwgXCJudXRcIl0sXG4gICAgICAgIGNvbG91cjogbnVsbFxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgaWQ6IDIsXG4gICAgICBuYW1lOiBcIkNyYW5iZXJyeSBTd2VldGhlYXJ0IENvb2tpZXMgKEVnZ2xlc3MpXCIsXG4gICAgICBwcmljZTogMy41LFxuICAgICAgdXJsOlxuICAgICAgICBcImh0dHBzOi8vc3RhdGljLndpeHN0YXRpYy5jb20vbWVkaWEvNzY4OTc5XzNmY2NiMmJiODM3YTQ0Y2FhODBiYjRmYzVkZGRkMTE5fm12Ml9kXzE4MDBfMTgwMF9zXzIuanBnXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIlxuICAgIH1cbiAgXTtcblxuICBsZXQgcmVzcG9uc2UgPSB7XG4gICAgYXR0YWNobWVudDoge1xuICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImdlbmVyaWNcIixcbiAgICAgICAgZWxlbWVudHM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IHByb2R1Y3RbXCJuYW1lXCJdLFxuICAgICAgICAgICAgc3VidGl0bGU6IGAkJHtwcm9kdWN0W1wicHJpY2VcIl19YCxcbiAgICAgICAgICAgIGltYWdlX3VybDogcHJvZHVjdFtcInVybFwiXSxcbiAgICAgICAgICAgIGJ1dHRvbnM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJMZWFybiBNb3JlXCIsXG4gICAgICAgICAgICAgICAgcGF5bG9hZDogYGVucXVpcnlfcHJvZHVjdCAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHR5cGU6IFwicG9zdGJhY2tcIixcbiAgICAgICAgICAgICAgICB0aXRsZTogXCJBZGQgdG8gQ2FydFwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBjYXJ0X2FkZCAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIGNvbmZpcm1hdGlvbiBvZiBwcm9kdWN0IGFkZGVkIHRvIGNhcnQgYW5kIHF1aWNrIHJlcGxpZXNcbmZ1bmN0aW9uIGdlbmVyYXRlQWRkQ2FydFJlc3BvbnNlKHNlbmRlcl9wc2lkLCBwcm9kdWN0X25hbWUsIHF1YW50aXR5KSB7XG4gIC8vIFRPRE86IEFkZCBwcm9kdWN0IHRvIGNhcnQgaW4gZGJcblxuICByZXR1cm4ge1xuICAgIHRleHQ6IGBBZGRlZCAke3F1YW50aXR5fSAke3Byb2R1Y3RfbmFtZX0gdG8gY2FydC5gLFxuICAgIHF1aWNrX3JlcGxpZXM6IFtcbiAgICAgIHtcbiAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgdGl0bGU6IFwiVmlldyBDYXJ0XCIsXG4gICAgICAgIHBheWxvYWQ6IGBjYXJ0X3ZpZXdgXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICB0aXRsZTogXCJDaGVja291dFwiLFxuICAgICAgICBwYXlsb2FkOiBgY2hlY2tvdXRgXG4gICAgICB9XG4gICAgXVxuICB9O1xufVxuXG4vLyBSZXNwb25zZSBvbiBnZW5lcmljIHRlbXBsYXRlIGNhcm91c2VsIGZvciBjYXJ0XG5mdW5jdGlvbiBnZW5lcmF0ZVZpZXdDYXJ0UmVzcG9uc2Uoc2VuZGVyX3BzaWQpIHtcbiAgLy8gVE9ETzogR2V0IGNhcnQgZnJvbSBkYlxuICBsZXQgcHJvZHVjdHMgPSBbXG4gICAge1xuICAgICAgaWQ6IDEsXG4gICAgICBuYW1lOiBcIkRhcmsgQ2hvY29sYXRlIE9hdG1lYWwgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAyLFxuICAgICAgbmFtZTogXCJDcmFuYmVycnkgU3dlZXRoZWFydCBDb29raWVzIChFZ2dsZXNzKVwiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIixcbiAgICAgIHF1YW50aXR5OiAxXG4gICAgfVxuICBdO1xuICBsZXQgcmVzcG9uc2UgPSB7XG4gICAgYXR0YWNobWVudDoge1xuICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgcGF5bG9hZDoge1xuICAgICAgICB0ZW1wbGF0ZV90eXBlOiBcImdlbmVyaWNcIixcbiAgICAgICAgZWxlbWVudHM6IHByb2R1Y3RzLm1hcChwcm9kdWN0ID0+IHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IHByb2R1Y3RbXCJuYW1lXCJdLFxuICAgICAgICAgICAgc3VidGl0bGU6IGBRdHk6ICR7cHJvZHVjdFtcInF1YW50aXR5XCJdfSAoJCR7cHJvZHVjdFtcInByaWNlXCJdfSBlYWNoKWAsXG4gICAgICAgICAgICBpbWFnZV91cmw6IHByb2R1Y3RbXCJ1cmxcIl0sXG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiQWRkIDFcIixcbiAgICAgICAgICAgICAgICBwYXlsb2FkOiBgY2FydF9hZGQgJHtwcm9kdWN0W1wibmFtZVwiXX1gXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInBvc3RiYWNrXCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiUmVtb3ZlIEFsbFwiLFxuICAgICAgICAgICAgICAgIHBheWxvYWQ6IGBjYXJ0X3JlbW92ZSAke3Byb2R1Y3RbXCJuYW1lXCJdfWBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gcmVzcG9uc2U7XG59XG5cbi8vIFJlc3BvbnNlIG9uIHJlY2VpcHQgdGVtcGxhdGUgZm9yIGxhdGVzdCBjb25maXJtZWQgb3JkZXJcbmZ1bmN0aW9uIGdlbmVyYXRlUmVjZWlwdFJlc3BvbnNlKHNlbmRlcl9wc2lkKSB7XG4gIC8vIFRPRE86IEdldCBsYXRlc3Qgb3JkZXIgZnJvbSBkYXRhYmFzZVxuICBsZXQgcHJvZHVjdHMgPSBbXG4gICAge1xuICAgICAgaWQ6IDEsXG4gICAgICBuYW1lOiBcIkRhcmsgQ2hvY29sYXRlIE9hdG1lYWwgQ29va2llc1wiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDFcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAyLFxuICAgICAgbmFtZTogXCJDcmFuYmVycnkgU3dlZXRoZWFydCBDb29raWVzIChFZ2dsZXNzKVwiLFxuICAgICAgcHJpY2U6IDMuNSxcbiAgICAgIHVybDpcbiAgICAgICAgXCJodHRwczovL3N0YXRpYy53aXhzdGF0aWMuY29tL21lZGlhLzc2ODk3OV8zZmNjYjJiYjgzN2E0NGNhYTgwYmI0ZmM1ZGRkZDExOX5tdjJfZF8xODAwXzE4MDBfc18yLmpwZ1wiLFxuICAgICAgcXVhbnRpdHk6IDJcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAzLFxuICAgICAgbmFtZTogXCJFYXJsIEdyZXkgU3VuZmxvd2VyIFNlZWRzIENvb2tpZXNcIixcbiAgICAgIHByaWNlOiAzLjUsXG4gICAgICB1cmw6XG4gICAgICAgIFwiaHR0cHM6Ly9zdGF0aWMud2l4c3RhdGljLmNvbS9tZWRpYS83Njg5NzlfM2ZjY2IyYmI4MzdhNDRjYWE4MGJiNGZjNWRkZGQxMTl+bXYyX2RfMTgwMF8xODAwX3NfMi5qcGdcIixcbiAgICAgIHF1YW50aXR5OiAxXG4gICAgfVxuICBdO1xuXG4gIGxldCByZXNwb25zZSA9IHtcbiAgICBhdHRhY2htZW50OiB7XG4gICAgICB0eXBlOiBcInRlbXBsYXRlXCIsXG4gICAgICBwYXlsb2FkOiB7XG4gICAgICAgIHRlbXBsYXRlX3R5cGU6IFwicmVjZWlwdFwiLFxuICAgICAgICByZWNpcGllbnRfbmFtZTogXCI8bmFtZT5cIixcbiAgICAgICAgb3JkZXJfbnVtYmVyOiBcIjxvcmRlcl9udW1iZXI+XCIsXG4gICAgICAgIGN1cnJlbmN5OiBcIlNHRFwiLFxuICAgICAgICBwYXltZW50X21ldGhvZDogXCJQYXlQYWxcIixcbiAgICAgICAgLy8gXCJvcmRlcl91cmxcIjpcImh0dHA6Ly9wZXRlcnNhcHBhcmVsLnBhcnNlYXBwLmNvbS9vcmRlcj9vcmRlcl9pZD0xMjM0NTZcIixcbiAgICAgICAgLy8gXCJ0aW1lc3RhbXBcIjpcIjE0Mjg0NDQ4NTJcIixcbiAgICAgICAgLy8gXCJhZGRyZXNzXCI6e1xuICAgICAgICAvLyAgIFwic3RyZWV0XzFcIjpcIjEgSGFja2VyIFdheVwiLFxuICAgICAgICAvLyAgIFwic3RyZWV0XzJcIjpcIlwiLFxuICAgICAgICAvLyAgIFwiY2l0eVwiOlwiTWVubG8gUGFya1wiLFxuICAgICAgICAvLyAgIFwicG9zdGFsX2NvZGVcIjpcIjk0MDI1XCIsXG4gICAgICAgIC8vICAgXCJzdGF0ZVwiOlwiQ0FcIixcbiAgICAgICAgLy8gICBcImNvdW50cnlcIjpcIlVTXCJcbiAgICAgICAgLy8gfSxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHN1YnRvdGFsOiA3NS4wIC8vLFxuICAgICAgICAgIC8vIFwic2hpcHBpbmdfY29zdFwiOjQuOTUsXG4gICAgICAgICAgLy8gXCJ0b3RhbF90YXhcIjo2LjE5LFxuICAgICAgICAgIC8vIFwidG90YWxfY29zdFwiOjU2LjE0XG4gICAgICAgIH0sXG4gICAgICAgIGVsZW1lbnRzOiBwcm9kdWN0cy5tYXAocHJvZHVjdCA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRpdGxlOiBgJHtwcm9kdWN0W1wibmFtZVwiXX1gLFxuICAgICAgICAgICAgc3VidGl0bGU6IFwiXCIsXG4gICAgICAgICAgICBxdWFudGl0eTogcHJvZHVjdFtcInF1YW50aXR5XCJdLFxuICAgICAgICAgICAgcHJpY2U6IHByb2R1Y3RbXCJwcmljZVwiXSxcbiAgICAgICAgICAgIGN1cnJlbmN5OiBcIlNHRFwiLFxuICAgICAgICAgICAgaW1hZ2VfdXJsOiBwcm9kdWN0W1widXJsXCJdXG4gICAgICAgICAgfTtcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG4vLyBSZXNwb25zZSBvbiBwcm9kb2R1Y3QgZW5xdWlyeVxuZnVuY3Rpb24gZ2VuZXJhdGVQcm9kdWN0RW5xdWlyeVJlc3BvbnNlKHByb2R1Y3QsIGF0dHJpYnV0ZSkge1xuICAvLyBUT0RPOiBHZXQgcHJvZHVjdCBmcm9tIGRiLCBjcmVhdGUgbWVzc2FnZSBhbmQgZ2VuZXJhdGUgcmVzcG9uc2VcbiAgcmV0dXJuIGRlZmF1bHRSZXNwb25zZTtcbn1cbiJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "express",
        "require",
        "bodyParser",
        "app",
        "use",
        "json",
        "request",
        "PAGE_ACCESS_TOKEN",
        "process",
        "env",
        "listen",
        "console",
        "log",
        "get",
        "req",
        "res",
        "VERIFY_TOKEN",
        "mode",
        "query",
        "token",
        "challenge",
        "status",
        "send",
        "sendStatus",
        "post",
        "body",
        "object",
        "entry",
        "forEach",
        "webhook_event",
        "messaging",
        "sender_psid",
        "sender",
        "id",
        "message",
        "handleMessage",
        "postback",
        "handlePostback",
        "defaultResponse",
        "generateResponseFromMessage",
        "received_message",
        "response",
        "text",
        "processMessage",
        "callSendAPI",
        "received_postback",
        "payload",
        "postback_intent",
        "split",
        "postback_content",
        "substring",
        "indexOf",
        "length",
        "generateAddCartResponse",
        "generateViewCartResponse",
        "attachment",
        "type",
        "template_type",
        "buttons",
        "generateReceiptResponse",
        "request_body",
        "recipient",
        "uri",
        "qs",
        "access_token",
        "method",
        "err",
        "error",
        "entities",
        "nlp",
        "is_greeting",
        "intent",
        "intent_parts",
        "intent_category",
        "intent_subcategory",
        "product_types",
        "filter",
        "obj",
        "map",
        "generateRecommendationsResponse",
        "product",
        "attribute",
        "generateProductEnquiryResponse",
        "messages",
        "profit",
        "manufacturer",
        "products",
        "Object",
        "keys",
        "entity",
        "product_name",
        "quantity",
        "name",
        "price",
        "url",
        "allegens",
        "colour",
        "elements",
        "title",
        "subtitle",
        "image_url",
        "quick_replies",
        "content_type",
        "recipient_name",
        "order_number",
        "currency",
        "payment_method",
        "summary",
        "subtotal"
      ],
      "mappings": "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",
      "file": "index.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "// https://developers.facebook.com/docs/messenger-platform/getting-started/webhook-setup/\n// https://developers.facebook.com/docs/messenger-platform/getting-started/app-setup\n// https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start\n\n\"use strict\";\n\n// Imports dependencies and set up http server\nconst express = require(\"express\"),\n  bodyParser = require(\"body-parser\"),\n  app = express().use(bodyParser.json()); // creates express http server\nconst request = require(\"request\");\n\n// import { checkUser, createUser } from './DBConn';\n\n// Get page access token\nconst PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Sets server port and logs message on success\napp.listen(3000, () => console.log(\"webhook is listening\"));\n\n// Adds support for GET requests to our webhook\napp.get(\"/webhook\", (req, res) => {\n  let VERIFY_TOKEN = process.env.VERIFY_TOKEN;\n\n  // Parse the query params\n  let mode = req.query[\"hub.mode\"];\n  let token = req.query[\"hub.verify_token\"];\n  let challenge = req.query[\"hub.challenge\"];\n\n  // Checks if a token and mode is in the query string of the request\n  if (mode && token) {\n    // Checks the mode and token sent is correct\n    if (mode === \"subscribe\" && token === VERIFY_TOKEN) {\n      // Responds with the challenge token from the request\n      console.log(\"WEBHOOK_VERIFIED\");\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Creates the endpoint for our webhook\napp.post(\"/webhook\", (req, res) => {\n  let body = req.body;\n\n  // Checks this is an event from a page subscription\n  if (body.object === \"page\") {\n    // Iterates over each entry - there may be multiple if batched\n    body.entry.forEach(function(entry) {\n      // Gets the message. entry.messaging is an array, but\n      // will only ever contain one message, so we get index 0\n      let webhook_event = entry.messaging[0];\n      // console.log(webhook_event);\n\n      // Get the sender PSID\n      let sender_psid = webhook_event.sender.id;\n      // console.log(\"Sender PSID: \" + sender_psid);\n\n      // Check if the event is a message or postback and\n      // pass the event to the appropriate handler function\n      if (webhook_event.message) {\n        // getName(sender_psid, function(response){\n        //     checkUser(sender_psid,response);\n        // });\n        handleMessage(sender_psid, webhook_event.message);\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Returns a '200 OK' response to all requests\n    res.status(200).send(\"EVENT_RECEIVED\");\n  } else {\n    // Returns a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\n// Gets users name from facebook graph api\n// function getName(sender_psid,callback){\n//     var name = \"Empty\";\n//     request({\n//         url:\"https://graph.facebook.com/v3.3/\" + sender_psid,\n//         qs:{\n//             access_token: PAGE_ACCESS_TOKEN,\n//             fields: \"first_name\",\n//         },\n//         method:\"GET\"\n//     }, function(error,response,body){\n//         if (error){\n//             console.log(error)\n//         }else{\n//             var bodyObj = JSON.parse(body);\n//             name = bodyObj.first_name;\n//             console.log(\"Name: \" + name);\n//             return callback(name)\n//         }\n//     });\n//     return name;\n// }\n\nlet defaultResponse = generateResponseFromMessage(\n  \"We could not understand your message. Kindly rephrase your message and send us again.\"\n);\n\n// Handles messages events\nfunction handleMessage(sender_psid, received_message) {\n  let response;\n\n  // Check if the message contains text\n  if (received_message.text) {\n    console.log(`Received message: \"${received_message.text}\"`);\n\n    response = processMessage(sender_psid, received_message);\n    // Default response (for debugging)\n    // Create the payload for a basic text message\n    // response = {\n    //   text: `You sent the message: \"${received_message.text}\".`\n    // };\n  } else {\n    response = defaultResponse;\n    //     // Gets the URL of the message attachment\n    //     let attachment_url = received_message.attachments[0].payload.url;\n  }\n\n  // Sends the response message\n  callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  let response;\n\n  // Get the payload for the postback\n  let payload = received_postback.payload;\n  console.log(`Received postback: \"${payload}\"`);\n\n  let postback_intent = payload.split(\" \")[0];\n  let postback_content = payload.substring(\n    payload.indexOf(\" \") + 1,\n    payload.length\n  );\n\n  // Set the response based on the postback intent\n  if (postback_intent === \"cart_add\") {\n    // Add to cart\n    response = generateAddCartResponse(sender_psid, postback_content, 1);\n  } else if (postback_intent === \"cart_view\") {\n    response = generateViewCartResponse(sender_psid);\n  } else if (postback_intent === \"enquiry_product\") {\n    response = generateResponseFromMessage(\n      `What would you like to know about our ${postback_content}?`\n    );\n  } else if (postback_intent === \"checkout\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Click on the button below to pay.\",\n          buttons: [\n            {\n              type: \"postback\",\n              text: \"Pay\",\n              payload: \"paid\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"paid\") {\n    response = {\n      attachment: {\n        type: \"template\",\n        payload: {\n          template_type: \"button\",\n          text: \"Your order (order no.) is confirmed.\",\n          buttons: [\n            {\n              type: \"postback\",\n              text: \"View Receipt\",\n              payload: \"receipt_view\"\n            }\n          ]\n        }\n      }\n    };\n  } else if (postback_intent === \"receipt_view\") {\n    response = generateReceiptResponse(sender_psid);\n  }\n\n  if (response == null) {\n    response = defaultResponse();\n  }\n\n  // Send the message to acknowledge the postback\n  callSendAPI(sender_psid, response);\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  // Uncomment to log response object\n  console.log(response);\n\n  // Construct the message body\n  let request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  // Send the HTTP request to the Messenger Platform\n  request(\n    {\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    },\n    (err, res, body) => {\n      if (!err) {\n        console.log(\"Message sent!\");\n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    }\n  );\n}\n\n// Process text message and returns response object to handleMessage()\nfunction processMessage(sender_psid, message) {\n  // NLP: https://developers.facebook.com/docs/messenger-platform/built-in-nlp\n  let entities = message.nlp[\"entities\"];\n\n  // Uncomment to view all entities and their xalues\n  // Object.keys(entities).forEach(key => {\n  //   console.log(\"Entity: \" + key);\n  //   console.log(entities[key]);\n  // });\n\n  // Check greeting\n  let is_greeting =\n    entities[\"greetings\"] != null &&\n    entities[\"greetings\"][0][\"confidence\"] > 0.8; // Greeting threshold set to 0.8 (stricter)\n\n  // Retrieve first intent object\n  let intent = entities[\"intent\"][0];\n\n  if (intent[\"confidence\"] > 0.5) {\n    // Process intent\n    let intent_parts = intent[\"value\"].split(\"_\");\n    let intent_category = intent_parts[0];\n    let intent_subcategory = intent_parts.length > 1 ? intent_parts[1] : null;\n    let response = null;\n\n    switch (intent_category) {\n      case \"recommendation\":\n        // Handle recommendation\n        // response = generateResponseFromMessage(\n        //   \"Message received is a recommendation message.\"\n        // );\n\n        let product_types = [];\n        if (entities[\"product_type\"]) {\n          console.log(\"Processing product types\");\n          product_types = entities[\"product_type\"]\n            .filter(obj => obj[\"confidence\"] > 0.5)\n            .map(obj => obj[\"value\"]);\n        }\n\n        response = generateRecommendationsResponse(product_types);\n        break;\n\n      case \"enquiry\":\n        // Handle enquiry\n        // response = generateResponseFromMessage(\n        //   \"Message received is an enquiry message.\"\n        // );\n\n        if (intent_subcategory === \"product\") {\n          // Retrieve product and attribute from entities object\n          if (entities[\"product\"] && entities[\"attribute\"]) {\n            let product = entities[\"product\"][0];\n            let attribute = entities[\"attribute\"][0];\n            // TODO: Handle product enquiry\n            response = generateProductEnquiryResponse(product, attribute);\n          } else {\n            response = defaultResponse;\n          }\n        } else if (intent_subcategory === \"general\") {\n          let messages = {\n            profit:\n              \"All net revenue earned from the sale of our products and services go towards paying a monthly allowance for our clients' work, as well as their lunch expenses while undergoing training.\",\n            manufacturer:\n              \"We support adults with intellectual disabilities. We started a range of social enterprise projects to provide alternative work engagement for our adult trainees.\",\n            products: \"We sell craft and baker goods.\"\n          };\n          // Loop through message keys (entity) and find if entity is in entities\n          Object.keys(messages).forEach(entity => {\n            if (response == null && entities[entity]) {\n              response = generateResponseFromMessage(messages[entity]);\n            }\n          });\n        } else if (intent_subcategory === \"delivery\") {\n          if (entities[\"status\"]) {\n            // TODO: Order status\n            response = generateResponseFromMessage(\n              \"Your latest order is <status>.\"\n            );\n          } else if (entities[\"estimated_arrival\"]) {\n            // TODO: Order estimated arrival\n            response = generateResponseFromMessage(\n              \"The average delivery time takes 5-7 working days. Your ordered was sent on <date>. It is estimated to arrive on <date + 7 working days>.\"\n            );\n          } else if (entities[\"cost\"]) {\n            response = generateResponseFromMessage(\n              \"It is a flat fee of $2 for every order.\"\n            );\n          } else {\n            response = generateResponseFromMessage(\n              \"We deliver islandwide. The average delivery time takes 5-7 working days.\"\n            );\n          }\n        }\n        break;\n\n      case \"cart\":\n        // Handle shopping cart\n        // response = generateResponseFromMessage(\n        //   \"Message received is a cart message.\"\n        // );\n\n        if (intent_subcategory === \"add\" && entities[\"product\"]) {\n          let product_name = entities[\"product\"][0][\"value\"];\n          let quantity = entities[\"number\"]\n            ? entities[\"number\"][0][\"value\"]\n            : 1;\n          response = generateAddCartResponse(\n            sender_psid,\n            product_name,\n            quantity\n          );\n        } else if (intent_subcategory === \"view\") {\n          response = generateViewCartResponse(sender_psid);\n        }\n        break;\n\n      default:\n        response = defaultResponse;\n    }\n\n    response = response == null ? defaultResponse : response;\n    return response;\n  } else if (is_greeting) {\n    // Message has no intent, just greeting\n    // TODO: Add quick replies of chatbot functionalities (recommendations, check order status, etc.)\n    return generateResponseFromMessage(\n      \"Hi there! Welcome to MINDS. How can I help you?\"\n    );\n  }\n\n  // No intent nor greeting\n  return defaultResponse;\n}\n\n// Wrapper method to convert text message string to response object\nfunction generateResponseFromMessage(message) {\n  return {\n    text: message\n  };\n}\n\n// Response on generic template carousel for recommendations\nfunction generateRecommendationsResponse(product_types) {\n  // TODO: Retrieve products to recommend based on list of product types. If product types is an empty array, recommend products of various types\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      attribute: {\n        allegens: [\"eggs\", \"nut\"],\n        colour: null\n      }\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\"\n    }\n  ];\n\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"name\"],\n            subtitle: `$${product[\"price\"]}`,\n            image_url: product[\"url\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Learn More\",\n                payload: `enquiry_product ${product[\"name\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Add to Cart\",\n                payload: `cart_add ${product[\"name\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on confirmation of product added to cart and quick replies\nfunction generateAddCartResponse(sender_psid, product_name, quantity) {\n  // TODO: Add product to cart in db\n\n  return {\n    text: `Added ${quantity} ${product_name} to cart.`,\n    quick_replies: [\n      {\n        content_type: \"text\",\n        title: \"View Cart\",\n        payload: `cart_view`\n      },\n      {\n        content_type: \"text\",\n        title: \"Checkout\",\n        payload: `checkout`\n      }\n    ]\n  };\n}\n\n// Response on generic template carousel for cart\nfunction generateViewCartResponse(sender_psid) {\n  // TODO: Get cart from db\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"generic\",\n        elements: products.map(product => {\n          return {\n            title: product[\"name\"],\n            subtitle: `Qty: ${product[\"quantity\"]} ($${product[\"price\"]} each)`,\n            image_url: product[\"url\"],\n            buttons: [\n              {\n                type: \"postback\",\n                title: \"Add 1\",\n                payload: `cart_add ${product[\"name\"]}`\n              },\n              {\n                type: \"postback\",\n                title: \"Remove All\",\n                payload: `cart_remove ${product[\"name\"]}`\n              }\n            ]\n          };\n        })\n      }\n    }\n  };\n  return response;\n}\n\n// Response on receipt template for latest confirmed order\nfunction generateReceiptResponse(sender_psid) {\n  // TODO: Get latest order from database\n  let products = [\n    {\n      id: 1,\n      name: \"Dark Chocolate Oatmeal Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    },\n    {\n      id: 2,\n      name: \"Cranberry Sweetheart Cookies (Eggless)\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 2\n    },\n    {\n      id: 3,\n      name: \"Earl Grey Sunflower Seeds Cookies\",\n      price: 3.5,\n      url:\n        \"https://static.wixstatic.com/media/768979_3fccb2bb837a44caa80bb4fc5dddd119~mv2_d_1800_1800_s_2.jpg\",\n      quantity: 1\n    }\n  ];\n\n  let response = {\n    attachment: {\n      type: \"template\",\n      payload: {\n        template_type: \"receipt\",\n        recipient_name: \"<name>\",\n        order_number: \"<order_number>\",\n        currency: \"SGD\",\n        payment_method: \"PayPal\",\n        // \"order_url\":\"http://petersapparel.parseapp.com/order?order_id=123456\",\n        // \"timestamp\":\"1428444852\",\n        // \"address\":{\n        //   \"street_1\":\"1 Hacker Way\",\n        //   \"street_2\":\"\",\n        //   \"city\":\"Menlo Park\",\n        //   \"postal_code\":\"94025\",\n        //   \"state\":\"CA\",\n        //   \"country\":\"US\"\n        // },\n        summary: {\n          subtotal: 75.0 //,\n          // \"shipping_cost\":4.95,\n          // \"total_tax\":6.19,\n          // \"total_cost\":56.14\n        },\n        elements: products.map(product => {\n          return {\n            title: `${product[\"name\"]}`,\n            subtitle: \"\",\n            quantity: product[\"quantity\"],\n            price: product[\"price\"],\n            currency: \"SGD\",\n            image_url: product[\"url\"]\n          };\n        })\n      }\n    }\n  };\n\n  return response;\n}\n\n// Response on prododuct enquiry\nfunction generateProductEnquiryResponse(product, attribute) {\n  // TODO: Get product from db, create message and generate response\n  return defaultResponse;\n}\n"
      ]
    },
    "mtime": 1592413883000
  }
}